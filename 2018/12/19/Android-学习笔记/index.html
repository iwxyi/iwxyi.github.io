<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
    <meta http-equiv="Content-Language" content="zh-cn">
    <meta charset="utf-8">
    
    
    <link rel="canonical" href="http://blog.iwxyi.com/2018/12/19/Android-学习笔记/">
    
    
    <title>Android-学习笔记 | 云笺 | 一些技术摘要和写作技巧</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
    
    <meta name="theme-color" content="#77AAFF">
    
    
    <meta name="keywords" content="学习笔记,Android">
    
    

    

    <!-- Baidu Push -->
<script>
	(function(){
		var bp = document.createElement('script');
		var curProtocol = window.location.protocol.split(':')[0];
		if (curProtocol === 'https') {
			bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
		}
		else {
			bp.src = 'http://push.zhanzhang.baidu.com/push.js';
		}
		var s = document.getElementsByTagName("script")[0];
		s.parentNode.insertBefore(bp, s);
	})();

	var _hmt = _hmt || [];
</script>



    
    <meta name="description" content="基础工具adb 命令 adb kill-server 杀死模拟器 adb start-server 启动模拟器 cd desktop 进入桌面文件夹 adb install path/x.apk 安装应用 adb uninstall com.xxx 卸载应用 adb shell   进入linux指令（ctrl+C退出） # ls 列出目录下所有文件（夹）清单 adb pull a.txt 从手机">
<meta name="keywords" content="学习笔记,Android">
<meta property="og:type" content="article">
<meta property="og:title" content="Android-学习笔记">
<meta property="og:url" content="http://blog.iwxyi.com/2018/12/19/Android-学习笔记/index.html">
<meta property="og:site_name" content="云笺">
<meta property="og:description" content="基础工具adb 命令 adb kill-server 杀死模拟器 adb start-server 启动模拟器 cd desktop 进入桌面文件夹 adb install path/x.apk 安装应用 adb uninstall com.xxx 卸载应用 adb shell   进入linux指令（ctrl+C退出） # ls 列出目录下所有文件（夹）清单 adb pull a.txt 从手机">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-10-13T02:34:09.949Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android-学习笔记">
<meta name="twitter:description" content="基础工具adb 命令 adb kill-server 杀死模拟器 adb start-server 启动模拟器 cd desktop 进入桌面文件夹 adb install path/x.apk 安装应用 adb uninstall com.xxx 卸载应用 adb shell   进入linux指令（ctrl+C退出） # ls 列出目录下所有文件（夹）清单 adb pull a.txt 从手机">
    
        <link rel="alternate" type="application/atom+xml" title="云笺" href="/atom.xml">
    
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link id="style" rel="stylesheet" href="/css/style.css?v=3.0">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    
            
</head>

<body>
    <div id="loading" class="active"></div>
    <aside id="menu"  class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" >
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg" alt="avatar">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname" id="name">小乂</h5>
          
            <div id="yiyanmotto" class="motto">&nbsp;</div>
          
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
              <li class="waves-block waves-effect">
                  <a href="/"  >
                    <i class="icon icon-lg icon-home"></i>
                    <span>主 页</span><i class="icon icon-lg icon-caret-left"></i>
                  </a>
              </li>
            
              <li class="waves-block waves-effect">
                  <a href="/archives"  >
                    <i class="icon icon-lg icon-archives"></i>
                    <span>归 档</span><i class="icon icon-lg icon-caret-left"></i>
                  </a>
              </li>
            
              <li class="waves-block waves-effect">
                  <a href="/categories"  >
                    <i class="icon icon-lg icon-th-list"></i>
                    <span>分 类</span><i class="icon icon-lg icon-caret-left"></i>
                  </a>
              </li>
            
              <li class="waves-block waves-effect">
                  <a href="/tags"  >
                    <i class="icon icon-lg icon-tags"></i>
                    <span>标 签</span><i class="icon icon-lg icon-caret-left"></i>
                  </a>
              </li>
            
              <li class="waves-block waves-effect">
                  <a href="/about"  >
                    <i class="icon icon-lg icon-link"></i>
                    <span>相 关</span><i class="icon icon-lg icon-caret-left"></i>
                  </a>
              </li>
            
      <div class="nav2">
          
              <a class="nav2item" data-title="Email" href="mailto:wxy@iwxyi.com" target="_parent"title="Email" >
                <i class="icon icon-lg icon-envelope-o envelope-o"></i>
              </a>
          
              <a class="nav2item" data-title="Github" href="https://github.com/iwxyi" target="_blank"title="Github" >
                <i class="icon icon-lg icon-github github"></i>
              </a>
          
              <a class="nav2item" data-title="微博" href="https://weibo.com/u/6065548594" target="_blank"title="微博" >
                <i class="icon icon-lg icon-weibo weibo"></i>
              </a>
          

            </div>

      </ul>

    </div>
  </div>

</aside>


    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Android-学习笔记</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        <a href="../../atom.xml" target="_blank" class="header-icon waves-effect waves-circle waves-light" id="Rss">
            <i class="icon icon-lg icon-rss"></i>
        </a>
    </div>
</header>
<header class="content-header post-header">
    
    
    <div class="container fade-scale">
        <div id="myheader">
            <h1 class="title">
                
            </h1>
            <h5 class="subtitle">
                
                
            </h5>
        </div>
    </div>

</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#基础"><span class="post-toc-number">1.</span> <span class="post-toc-text">基础</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#工具"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">工具</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#adb-命令"><span class="post-toc-number">1.1.1.</span> <span class="post-toc-text">adb 命令</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#简易拨号应用"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">简易拨号应用</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#设置按钮点击事件的四种方式"><span class="post-toc-number">1.2.1.</span> <span class="post-toc-text">设置按钮点击事件的四种方式</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1、内部类"><span class="post-toc-number">1.2.1.1.</span> <span class="post-toc-text">1、内部类</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2、匿名内部类"><span class="post-toc-number">1.2.1.2.</span> <span class="post-toc-text">2、匿名内部类</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3、setOnClickListener-this"><span class="post-toc-number">1.2.1.3.</span> <span class="post-toc-text">3、setOnClickListener(this)</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#4、布局中的-onClick"><span class="post-toc-number">1.2.1.4.</span> <span class="post-toc-text">4、布局中的 onClick</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#获取-EdiText-文本内容"><span class="post-toc-number">1.2.2.</span> <span class="post-toc-text">获取 EdiText 文本内容</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#吐司-Toast"><span class="post-toc-number">1.2.3.</span> <span class="post-toc-text">吐司 Toast</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#意图-Intent"><span class="post-toc-number">1.2.4.</span> <span class="post-toc-text">意图 Intent</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#布局"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">布局</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1、线性布局"><span class="post-toc-number">1.3.1.</span> <span class="post-toc-text">1、线性布局</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2、相对布局"><span class="post-toc-number">1.3.2.</span> <span class="post-toc-text">2、相对布局</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3、帧布局"><span class="post-toc-number">1.3.3.</span> <span class="post-toc-text">3、帧布局</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4、表格布局"><span class="post-toc-number">1.3.4.</span> <span class="post-toc-text">4、表格布局</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#5、绝对布局"><span class="post-toc-number">1.3.5.</span> <span class="post-toc-text">5、绝对布局</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#权重"><span class="post-toc-number">1.3.6.</span> <span class="post-toc-text">权重</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#单位"><span class="post-toc-number">1.3.7.</span> <span class="post-toc-text">单位</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#调试"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">调试</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#单元测试"><span class="post-toc-number">1.4.1.</span> <span class="post-toc-text">单元测试</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#日志猫"><span class="post-toc-number">1.4.2.</span> <span class="post-toc-text">日志猫</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#文件存储操作"><span class="post-toc-number">1.5.</span> <span class="post-toc-text">文件存储操作</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#txt读写例程：绝对路径"><span class="post-toc-number">1.5.1.</span> <span class="post-toc-text">txt读写例程：绝对路径</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#API-获取内部路径"><span class="post-toc-number">1.5.2.</span> <span class="post-toc-text">API 获取内部路径</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#context-获取内部路径"><span class="post-toc-number">1.5.3.</span> <span class="post-toc-text">context 获取内部路径</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Environment-获取SD卡路径"><span class="post-toc-number">1.5.4.</span> <span class="post-toc-text">Environment 获取SD卡路径</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#判断SD卡是否可用"><span class="post-toc-number">1.5.5.</span> <span class="post-toc-text">判断SD卡是否可用</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#获取SD卡的可用空间"><span class="post-toc-number">1.5.6.</span> <span class="post-toc-text">获取SD卡的可用空间</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#文件权限"><span class="post-toc-number">1.5.7.</span> <span class="post-toc-text">文件权限</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#XML"><span class="post-toc-number">1.6.</span> <span class="post-toc-text">XML</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#保存设置文件-SharedPreferences"><span class="post-toc-number">1.6.1.</span> <span class="post-toc-text">保存设置文件 SharedPreferences</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#手动构建-xml-文件"><span class="post-toc-number">1.6.2.</span> <span class="post-toc-text">手动构建 xml 文件</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#xml序列化器-xmlSerializer"><span class="post-toc-number">1.6.3.</span> <span class="post-toc-text">xml序列化器 xmlSerializer</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#xml的解析"><span class="post-toc-number">1.6.4.</span> <span class="post-toc-text">xml的解析</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#数据库"><span class="post-toc-number">1.7.</span> <span class="post-toc-text">数据库</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#sqlite-数据库初始化"><span class="post-toc-number">1.7.1.</span> <span class="post-toc-text">sqlite 数据库初始化</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#SQLiteOpenHelper"><span class="post-toc-number">1.7.1.1.</span> <span class="post-toc-text">SQLiteOpenHelper</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#MainActivity部分"><span class="post-toc-number">1.7.1.2.</span> <span class="post-toc-text">MainActivity部分</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#执行SQL语句"><span class="post-toc-number">1.7.2.</span> <span class="post-toc-text">执行SQL语句</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#execSQL"><span class="post-toc-number">1.7.2.1.</span> <span class="post-toc-text">execSQL</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Cursor"><span class="post-toc-number">1.7.2.2.</span> <span class="post-toc-text">Cursor</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#SQL优缺点"><span class="post-toc-number">1.7.2.3.</span> <span class="post-toc-text">SQL优缺点</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#sqlite3"><span class="post-toc-number">1.7.2.4.</span> <span class="post-toc-text">sqlite3</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#命令行SQL语句"><span class="post-toc-number">1.7.2.4.1.</span> <span class="post-toc-text">命令行SQL语句</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#改变DOS编码"><span class="post-toc-number">1.7.2.4.2.</span> <span class="post-toc-text">改变DOS编码</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#谷歌封装好的数据库API"><span class="post-toc-number">1.7.3.</span> <span class="post-toc-text">谷歌封装好的数据库API</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#数据库的事物"><span class="post-toc-number">1.7.4.</span> <span class="post-toc-text">数据库的事物</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#ListView"><span class="post-toc-number">1.8.</span> <span class="post-toc-text">ListView</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#使用方法"><span class="post-toc-number">1.8.1.</span> <span class="post-toc-text">使用方法</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1、布局：activity-main"><span class="post-toc-number">1.8.1.1.</span> <span class="post-toc-text">1、布局：activity_main</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2、设置Adapter"><span class="post-toc-number">1.8.1.2.</span> <span class="post-toc-text">2、设置Adapter</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3、实现BaseAdapter方法"><span class="post-toc-number">1.8.1.3.</span> <span class="post-toc-text">3、实现BaseAdapter方法</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#错误提示"><span class="post-toc-number">1.8.1.4.</span> <span class="post-toc-text">错误提示</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#结果示例"><span class="post-toc-number">1.8.1.5.</span> <span class="post-toc-text">结果示例</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#显示数据的原理"><span class="post-toc-number">1.8.1.6.</span> <span class="post-toc-text">显示数据的原理</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ListView优化"><span class="post-toc-number">1.8.2.</span> <span class="post-toc-text">ListView优化</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#getView-方法说明"><span class="post-toc-number">1.8.2.1.</span> <span class="post-toc-text">getView() 方法说明</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#convertView-缓存机制"><span class="post-toc-number">1.8.2.2.</span> <span class="post-toc-text">convertView 缓存机制</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#List高度设置"><span class="post-toc-number">1.8.2.3.</span> <span class="post-toc-text">List高度设置</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#复杂的ListView"><span class="post-toc-number">1.8.3.</span> <span class="post-toc-text">复杂的ListView</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1、Layout：activity-main"><span class="post-toc-number">1.8.3.1.</span> <span class="post-toc-text">1、Layout：activity_main</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2、Layout-item（xml）"><span class="post-toc-number">1.8.3.2.</span> <span class="post-toc-text">2、Layout : item（xml）</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3、BaseAdapter：打气筒"><span class="post-toc-number">1.8.3.3.</span> <span class="post-toc-text">3、BaseAdapter：打气筒</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#打气筒的三种写法"><span class="post-toc-number">1.8.3.3.1.</span> <span class="post-toc-text">打气筒的三种写法</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ArrayAdapter"><span class="post-toc-number">1.8.4.</span> <span class="post-toc-text">ArrayAdapter</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#SimpleAdapter"><span class="post-toc-number">1.8.5.</span> <span class="post-toc-text">SimpleAdapter</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#用ListView展示数据库的数据"><span class="post-toc-number">1.8.6.</span> <span class="post-toc-text">用ListView展示数据库的数据</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#网络"><span class="post-toc-number">2.</span> <span class="post-toc-text">网络</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#网页源码查看器"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">网页源码查看器</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#联网权限"><span class="post-toc-number">2.1.1.</span> <span class="post-toc-text">联网权限</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#HttpUrlConnection-类"><span class="post-toc-number">2.1.2.</span> <span class="post-toc-text">HttpUrlConnection 类</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ScrollView"><span class="post-toc-number">2.1.3.</span> <span class="post-toc-text">ScrollView</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#消息机制的写法"><span class="post-toc-number">2.1.4.</span> <span class="post-toc-text">消息机制的写法</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#主线程（UI线程）"><span class="post-toc-number">2.1.4.1.</span> <span class="post-toc-text">主线程（UI线程）</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Handler-使用步骤"><span class="post-toc-number">2.1.5.</span> <span class="post-toc-text">Handler 使用步骤</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#消息机制的原理"><span class="post-toc-number">2.1.6.</span> <span class="post-toc-text">消息机制的原理</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Handler-完善：what"><span class="post-toc-number">2.1.7.</span> <span class="post-toc-text">Handler 完善：what</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#图片查看器"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">图片查看器</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ImageView-显示网络图片"><span class="post-toc-number">2.2.1.</span> <span class="post-toc-text">ImageView 显示网络图片</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#图片缓存到本地"><span class="post-toc-number">2.2.2.</span> <span class="post-toc-text">图片缓存到本地</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#使用缓存图片"><span class="post-toc-number">2.2.3.</span> <span class="post-toc-text">使用缓存图片</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#对图片进行加密"><span class="post-toc-number">2.2.4.</span> <span class="post-toc-text">对图片进行加密</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#cache-和-filedir-区别"><span class="post-toc-number">2.2.5.</span> <span class="post-toc-text">cache 和 filedir 区别</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#写出文件示例"><span class="post-toc-number">2.2.5.1.</span> <span class="post-toc-text">写出文件示例</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Thread-API"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">Thread API</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#runOnUiThread-写法"><span class="post-toc-number">2.3.1.</span> <span class="post-toc-text">runOnUiThread 写法</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Handler-API"><span class="post-toc-number">2.3.2.</span> <span class="post-toc-text">Handler API</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#定时器-Timer"><span class="post-toc-number">2.3.3.</span> <span class="post-toc-text">定时器 Timer</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#网络基础"><span class="post-toc-number">2.4.</span> <span class="post-toc-text">网络基础</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#网络图片-SmartImageView"><span class="post-toc-number">2.4.1.</span> <span class="post-toc-text">网络图片 SmartImageView</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#GitHub-开源项目"><span class="post-toc-number">2.4.1.1.</span> <span class="post-toc-text">GitHub 开源项目</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#HttpURLConnextion"><span class="post-toc-number">2.4.2.</span> <span class="post-toc-text">HttpURLConnextion</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#封装-toast-方法"><span class="post-toc-number">2.4.2.1.</span> <span class="post-toc-text">封装 toast 方法</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#GET-和-POST-的区别"><span class="post-toc-number">2.4.2.2.</span> <span class="post-toc-text">GET 和 POST 的区别</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#使用-POST"><span class="post-toc-number">2.4.2.3.</span> <span class="post-toc-text">使用 POST</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#乱码问题"><span class="post-toc-number">2.4.2.4.</span> <span class="post-toc-text">乱码问题</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#改变服务器编码（Java）："><span class="post-toc-number">2.4.2.4.1.</span> <span class="post-toc-text">改变服务器编码（Java）：</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#改变-Android-编码"><span class="post-toc-number">2.4.2.4.2.</span> <span class="post-toc-text">改变 Android 编码</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#URLEncode-类"><span class="post-toc-number">2.4.2.4.3.</span> <span class="post-toc-text">URLEncode 类</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#HttpClient-方式提交数据"><span class="post-toc-number">2.4.3.</span> <span class="post-toc-text">HttpClient 方式提交数据</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#GET"><span class="post-toc-number">2.4.3.1.</span> <span class="post-toc-text">GET</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#POST"><span class="post-toc-number">2.4.3.2.</span> <span class="post-toc-text">POST</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#asyncHttpClient-开源项目"><span class="post-toc-number">2.4.4.</span> <span class="post-toc-text">asyncHttpClient 开源项目</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#GET-1"><span class="post-toc-number">2.4.4.1.</span> <span class="post-toc-text">GET</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#POST-1"><span class="post-toc-number">2.4.4.2.</span> <span class="post-toc-text">POST</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#多线程下载"><span class="post-toc-number">2.5.</span> <span class="post-toc-text">多线程下载</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#原理"><span class="post-toc-number">2.5.1.</span> <span class="post-toc-text">原理</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#RandomAccessFile-类"><span class="post-toc-number">2.5.2.</span> <span class="post-toc-text">RandomAccessFile 类</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#代码"><span class="post-toc-number">2.5.3.</span> <span class="post-toc-text">代码</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#断点续传"><span class="post-toc-number">2.5.4.</span> <span class="post-toc-text">断点续传</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#安卓动态添加进度条"><span class="post-toc-number">2.5.5.</span> <span class="post-toc-text">安卓动态添加进度条</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#安卓多线程下载"><span class="post-toc-number">2.5.6.</span> <span class="post-toc-text">安卓多线程下载</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#多线程下载开源项目"><span class="post-toc-number">2.5.7.</span> <span class="post-toc-text">多线程下载开源项目</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Android-四大组件"><span class="post-toc-number">3.</span> <span class="post-toc-text">Android 四大组件</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Activity"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">Activity</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#创建新的-Activity"><span class="post-toc-number">3.1.1.</span> <span class="post-toc-text">创建新的 Activity</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#隐式意图"><span class="post-toc-number">3.1.1.1.</span> <span class="post-toc-text">隐式意图</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#意图过滤器"><span class="post-toc-number">3.1.1.2.</span> <span class="post-toc-text">意图过滤器</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#短信发送器"><span class="post-toc-number">3.1.2.</span> <span class="post-toc-text">短信发送器</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#广播"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">广播</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#广播接收"><span class="post-toc-number">3.2.1.</span> <span class="post-toc-text">广播接收</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#IP拨号器"><span class="post-toc-number">3.2.1.1.</span> <span class="post-toc-text">IP拨号器</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#SD卡状态的监听"><span class="post-toc-number">3.2.1.2.</span> <span class="post-toc-text">SD卡状态的监听</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#短信监听器"><span class="post-toc-number">3.2.1.3.</span> <span class="post-toc-text">短信监听器</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#卸载安装实例"><span class="post-toc-number">3.2.1.4.</span> <span class="post-toc-text">卸载安装实例</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#手机重启实例"><span class="post-toc-number">3.2.1.5.</span> <span class="post-toc-text">手机重启实例</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#广播类型"><span class="post-toc-number">3.2.2.</span> <span class="post-toc-text">广播类型</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#无序广播"><span class="post-toc-number">3.2.2.1.</span> <span class="post-toc-text">无序广播</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#有序广播"><span class="post-toc-number">3.2.2.2.</span> <span class="post-toc-text">有序广播</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#特殊广播接收者"><span class="post-toc-number">3.2.2.3.</span> <span class="post-toc-text">特殊广播接收者</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#样式和主题"><span class="post-toc-number">3.2.3.</span> <span class="post-toc-text">样式和主题</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#样式"><span class="post-toc-number">3.2.3.1.</span> <span class="post-toc-text">样式</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#主题"><span class="post-toc-number">3.2.3.2.</span> <span class="post-toc-text">主题</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#区别"><span class="post-toc-number">3.2.3.3.</span> <span class="post-toc-text">区别</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Android-国际化"><span class="post-toc-number">3.2.3.4.</span> <span class="post-toc-text">Android 国际化</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#对话框"><span class="post-toc-number">3.2.4.</span> <span class="post-toc-text">对话框</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#普通对话框"><span class="post-toc-number">3.2.4.1.</span> <span class="post-toc-text">普通对话框</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#两种上下文的区别"><span class="post-toc-number">3.2.4.1.1.</span> <span class="post-toc-text">两种上下文的区别</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#单选对话框"><span class="post-toc-number">3.2.4.2.</span> <span class="post-toc-text">单选对话框</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#多选对话框"><span class="post-toc-number">3.2.4.3.</span> <span class="post-toc-text">多选对话框</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#进度条对话框"><span class="post-toc-number">3.2.4.4.</span> <span class="post-toc-text">进度条对话框</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#帧动画"><span class="post-toc-number">3.2.5.</span> <span class="post-toc-text">帧动画</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#服务"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">服务</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#进程"><span class="post-toc-number">3.3.1.</span> <span class="post-toc-text">进程</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#start方式开启服务"><span class="post-toc-number">3.3.2.</span> <span class="post-toc-text">start方式开启服务</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#电话监听器"><span class="post-toc-number">3.3.2.1.</span> <span class="post-toc-text">电话监听器</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#录音机"><span class="post-toc-number">3.3.2.1.1.</span> <span class="post-toc-text">录音机</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#使用服务注册特殊的广播接收者"><span class="post-toc-number">3.3.2.2.</span> <span class="post-toc-text">使用服务注册特殊的广播接收者</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#bind-方式开启服务"><span class="post-toc-number">3.3.3.</span> <span class="post-toc-text">bind 方式开启服务</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#为什么要引入-bindService"><span class="post-toc-number">3.3.3.1.</span> <span class="post-toc-text">为什么要引入 bindService</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#通过接口调用服务里面的方法"><span class="post-toc-number">3.3.3.2.</span> <span class="post-toc-text">通过接口调用服务里面的方法</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#混合方式开启服务"><span class="post-toc-number">3.3.4.</span> <span class="post-toc-text">混合方式开启服务</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#百度音乐盒框架"><span class="post-toc-number">3.3.4.1.</span> <span class="post-toc-text">百度音乐盒框架</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#AIDL-介绍"><span class="post-toc-number">3.3.5.</span> <span class="post-toc-text">AIDL 介绍</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#AIDL-的应用场景"><span class="post-toc-number">3.3.5.1.</span> <span class="post-toc-text">AIDL 的应用场景</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#内容提供者-contentProvider"><span class="post-toc-number">3.4.</span> <span class="post-toc-text">内容提供者(contentProvider)</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#暴露方法"><span class="post-toc-number">3.4.1.</span> <span class="post-toc-text">暴露方法</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#app2读取app1的数据库"><span class="post-toc-number">3.4.2.</span> <span class="post-toc-text">app2读取app1的数据库</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#暴露增删改查"><span class="post-toc-number">3.4.3.</span> <span class="post-toc-text">暴露增删改查</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#备份短信"><span class="post-toc-number">3.4.4.</span> <span class="post-toc-text">备份短信</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#插入短信"><span class="post-toc-number">3.4.5.</span> <span class="post-toc-text">插入短信</span></a></li></ol></li></ol></li></ol>
        </nav>
    </aside>
   
<article id="post-Android-学习笔记"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Android-学习笔记</h1>
        <div class="post-meta">
            <i class="icon icon-lg icon-calendar-o"></i>
            发表于
            <time class="post-time" title="2018-12-19 10:29:00" datetime="2018-12-19T02:29:00.000Z"  itemprop="datePublished">2018-12-19</time>

            <br id="mybreak"/>
            
	<i class="icon icon-lg icon-folder-o"></i>
	分类：<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Code/">Code</a></li></ul>


            <i>·</i>
            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>次浏览
</span>


        </div>
        <div class="post-count-custom">
            <i class="icon icon-lg icon-comment-o"></i>
            阅读本文可能花费您&nbsp;<span class="post-count">83</span>&nbsp;分钟
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h1 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h1><h2 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h2><h3 id="adb-命令"><a href="#adb-命令" class="headerlink" title="adb 命令"></a>adb 命令</h3><ul>
<li>adb kill-server 杀死模拟器</li>
<li>adb start-server 启动模拟器</li>
<li>cd desktop 进入桌面文件夹</li>
<li>adb install path/x.apk 安装应用</li>
<li>adb uninstall com.xxx 卸载应用</li>
<li>adb shell   进入linux指令（ctrl+C退出）</li>
<li># ls 列出目录下所有文件（夹）清单</li>
<li>adb pull a.txt 从手机中导出文件</li>
<li>adb push a.txt /mnt/sdcard 把一个文件导入到手机</li>
<li>monkey 1000 随机点模拟器1000次（冒烟测试（压力测试））<a id="more"></a>


</li>
</ul>
<h2 id="简易拨号应用"><a href="#简易拨号应用" class="headerlink" title="简易拨号应用"></a>简易拨号应用</h2><h3 id="设置按钮点击事件的四种方式"><a href="#设置按钮点击事件的四种方式" class="headerlink" title="设置按钮点击事件的四种方式"></a>设置按钮点击事件的四种方式</h3><h4 id="1、内部类"><a href="#1、内部类" class="headerlink" title="1、内部类"></a>1、内部类</h4><p>使用 onClickListener() 类</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">btn = (Button) findViewById(R.id.button1); <span class="comment">// 找到按钮</span></span><br><span class="line">btn.setOnClickListener(<span class="keyword">new</span> MyClickListener()); <span class="comment">// 设置按钮点击事件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 在 MainActivity 里面再定义一个类去实现 按钮需要的接口类型</span></span><br><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">MyClickListener</span> <span class="keyword">implements</span> <span class="title">OnClickListener</span></span>{</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>{ <span class="comment">// 当按钮被单击的时候调用</span></span><br><span class="line">      System.out.println(<span class="string">"按钮被点击了"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="2、匿名内部类"><a href="#2、匿名内部类" class="headerlink" title="2、匿名内部类"></a>2、<strong>匿名内部类</strong></h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">btn.setOnClickListener(<span class="keyword">new</span> OnClickListener(){</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span></span>{</span><br><span class="line">      <span class="comment">// code process</span></span><br><span class="line">    }</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>

<h4 id="3、setOnClickListener-this"><a href="#3、setOnClickListener-this" class="headerlink" title="3、setOnClickListener(this)"></a>3、setOnClickListener(<strong>this</strong>)</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> <span class="keyword">implements</span> <span class="title">onClickListener</span></span>{</span><br><span class="line">  <span class="comment">// 注意:接口所属的包名有多个，不能选错：onClickListener - android.view.View</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">      	btn.setOnClickListener(<span class="keyword">this</span>); <span class="comment">// 适用于多个按钮使用同一个事件的情况</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span></span>{</span><br><span class="line">        <span class="keyword">switch</span> (v.getID()){ <span class="comment">// 可根据参数来判断按钮</span></span><br><span class="line">          <span class="keyword">case</span> R.id.btn1 :</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">case</span> R.id.btn2 :</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="4、布局中的-onClick"><a href="#4、布局中的-onClick" class="headerlink" title="4、布局中的 onClick"></a>4、布局中的 onClick</h4><p>在 AndroidManiFest 中设置 attribute（属性）</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;Button</span><br><span class="line">	<span class="comment">//……</span></span><br><span class="line">	android:onClick=<span class="string">"myClick"</span> /&gt;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myClick</span><span class="params">(View v)</span></span>{ <span class="comment">// 方法名必须和 attribute 的 onClick 属性一致</span></span><br><span class="line">  <span class="comment">// Kabloey</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="获取-EdiText-文本内容"><a href="#获取-EdiText-文本内容" class="headerlink" title="获取 EdiText 文本内容"></a>获取 EdiText 文本内容</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ed = (EditText) findViewById(R.id.editText1);</span><br><span class="line">String str = ed.getText().toString().trim(); <span class="comment">// trim()去空格</span></span><br><span class="line"><span class="keyword">if</span> (str.equals(<span class="string">""</span>)){ <span class="comment">// 如果文本为空</span></span><br><span class="line">	Toast.makeText(MainActivity.<span class="keyword">this</span>, <span class="string">"文本不能为空"</span>, <span class="number">1</span>).show(); <span class="comment">// 弹出吐司</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>判断文本是否为空的API：<code>TextUtils.isEmpty(str)</code></p>
<h3 id="吐司-Toast"><a href="#吐司-Toast" class="headerlink" title="吐司 Toast"></a>吐司 Toast</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Toast.makeText(context<span class="comment">/*上下文，可用 this,指当前的activity,即context*/</span>,</span><br><span class="line">               text, duration).show();</span><br></pre></td></tr></tbody></table></figure>

<p>注意：如果是在自定义的类例如 MyClickListener 中，context 不能是 <code>this</code><br>context 可以改成：<code>MainActivity.this</code><br>duration 弹出时长，参数有：</p>
<ul>
<li>Toast.LENGTH_LONG    值为1<ul>
<li>Toast.LENGTH_SHORT值为0</li>
</ul>
</li>
</ul>
<p>最后别忘了弹出吐司： <code>.show()</code></p>
<h3 id="意图-Intent"><a href="#意图-Intent" class="headerlink" title="意图 Intent"></a>意图 Intent</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Intent intent = <span class="keyword">new</span> Intent(); <span class="comment">// 创建一个意图对象</span></span><br><span class="line">intent.setAction(Intent.ACTION_CALL); <span class="comment">// 设置动作：打电话</span></span><br><span class="line">intent.setData(Uri.parse(<span class="string">"tel:"</span> + num)); <span class="comment">// 设置数据：tel:119</span></span><br><span class="line">startActivity(intent); <span class="comment">// 开启意图：调用电话进行拨号（注意：权限 android.permission.CALL_PHONE）</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="布局"><a href="#布局" class="headerlink" title="布局"></a><strong>布局</strong></h2><h3 id="1、线性布局"><a href="#1、线性布局" class="headerlink" title="1、线性布局"></a>1、线性布局</h3><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">android:orientation="horizontal" // 水平的（默认）</span><br><span class="line">android:orientation="vertitcal" // 竖直的</span><br><span class="line">android:layout_width="match_parent" // 填充父</span><br><span class="line">android:layout_height="wrap_content" // 自适应</span><br><span class="line">android:paddingBottom="@dimen/activity_vertical_margin" // 控件内部内容（文字）位置</span><br><span class="line">android:marginLeft="10dp" // 控件整体左边留空 10 像素</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 总体布局 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLaout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">             <span class="attr">xmlns:toos</span>=<span class="string">"http://schemas.android.com/tools"</span></span></span><br><span class="line"><span class="tag">             <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">             <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">             <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></span></span><br><span class="line"><span class="tag">             <span class="attr">tools:context</span>=<span class="string">".MainActivity"</span> &gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 内部控件布局 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLaout</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="2、相对布局"><a href="#2、相对布局" class="headerlink" title="2、相对布局"></a>2、相对布局</h3><p>控件默认左上角，需手动确定相对关系</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">android:id="@+id/btn2" // 添加一个 ID</span><br><span class="line">android:layout_below="@id/btn1" // 在 btn1 的下面（即当前控件的的上面）</span><br><span class="line">android:layout_toRightOf="@id/btn3" // 在 btn3 的右边</span><br><span class="line">android:layout_alignParentRgiht="true" // 在布局的最右边</span><br><span class="line">android:layout_alignBottom="@id/bt4" // 与 bt4 底部对齐</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span> <span class="attr">xmlns</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">  	<span class="comment">&lt;!-- 控件布局 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="3、帧布局"><a href="#3、帧布局" class="headerlink" title="3、帧布局"></a>3、帧布局</h3><p>一层一层显示，后面的Frame在前面的Frame上面（默认窗口左上角）</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android:layout_gravity="center"</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><p>center 居中</p>
</li>
<li><p>center_vertical 垂直居中</p>
</li>
<li><p>center_horizontal 水平居中</p>
</li>
</ul>
<h3 id="4、表格布局"><a href="#4、表格布局" class="headerlink" title="4、表格布局"></a>4、表格布局</h3><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">TableLayout</span></span></span><br><span class="line"><span class="tag">	<span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">	</span></span><br><span class="line">	&lt;!--代表一行--&gt;</span><br><span class="line">	<span class="tag">&lt;<span class="name">TableRow</span></span></span><br><span class="line"><span class="tag">		<span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span> &gt;</span></span><br><span class="line">	</span><br><span class="line">        <span class="comment">&lt;!--加入第一个控件--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">"所有控件开头都是大写的"</span></span></span><br><span class="line"><span class="tag">			<span class="attr">android:textColoe</span>=<span class="string">"#ff0000"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">		 <span class="comment">&lt;!--加入第二个控件--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">			<span class="attr">android:layout_marginLeft</span>=<span class="string">"10dp"</span></span></span><br><span class="line"><span class="tag">			<span class="attr">android:text</span>=<span class="string">"这是第二列"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:textSize</span>=<span class="string">"18sp"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;/<span class="name">TableRow</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">TableRow</span>&gt;</span> <span class="comment">&lt;!-- 第二行 --&gt;</span> <span class="tag">&lt;/<span class="name">TableRow</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">TableRow</span>&gt;</span> <span class="comment">&lt;!-- 第三行 --&gt;</span> <span class="tag">&lt;/<span class="name">TableRow</span>&gt;</span></span><br><span class="line">		</span><br><span class="line"><span class="tag">&lt;/<span class="name">TableLayout</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="5、绝对布局"><a href="#5、绝对布局" class="headerlink" title="5、绝对布局"></a>5、绝对布局</h3><blockquote>
<p>absolution 已经废弃了</p>
</blockquote>
<h3 id="权重"><a href="#权重" class="headerlink" title="权重"></a>权重</h3><p>只能在线性布局中使用，平分布局。</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">TextView</span> <span class="attr">android:layout_weight</span>=<span class="string">"2"</span>/&gt;</span> <span class="comment">&lt;!--占三分之二--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">TextView</span> <span class="attr">android:layout_weight</span>=<span class="string">"1"</span>/&gt;</span> <span class="comment">&lt;!--占三分之一--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="单位"><a href="#单位" class="headerlink" title="单位"></a>单位</h3><ul>
<li>px    像素（不适配屏幕，不建议使用）<ul>
<li><strong>dp</strong>自动适应屏幕的单位（px的替代单位）</li>
<li><strong>sp</strong>控件文字大小 textSize</li>
</ul>
</li>
</ul>
<h2 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h2><h3 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h3><ol>
<li><p>定义一个类继承 <strong>AndroidTestCase</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.test.AndroidTestCase</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CalcTest</span> <span class="keyword">extends</span> <span class="title">AndroidTestCase</span> </span>{</span><br><span class="line">	<span class="comment">// 写测试方法</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAdd</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">    	Calc calc = <span class="keyword">new</span> Calc(); <span class="comment">// 这时已经写好的待测试类</span></span><br><span class="line">    	<span class="keyword">int</span> result = calc.add(<span class="number">5</span>, <span class="number">3</span>);</span><br><span class="line">    	</span><br><span class="line">    	assertEquals(<span class="number">8</span><span class="comment">/*expected*/</span>, result<span class="comment">/*actual*/</span>); <span class="comment">// 期望与实际进行对比</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>在清单文件（AndroidManifest） 中加入 <strong>uses-library</strong> 和 <strong>instrumentation</strong>：</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:android...</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">application</span> <span class="attr">android:icon</span>=<span class="string">"@drawable/icon"</span><span class="attr">...</span>&gt;</span></span><br><span class="line">      	<span class="comment">&lt;!-- 配置函数库 （application 里面） --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">uses-library</span> <span class="attr">android:name</span>=<span class="string">"android.test.runner"</span> /&gt;</span></span><br><span class="line">		...</span><br><span class="line">	<span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">	<span class="tag">&lt;<span class="name">uses-sdk</span> <span class="attr">android:minSdkVersion</span>=<span class="string">"6"</span> /&gt;</span></span><br><span class="line">  </span><br><span class="line">  	<span class="comment">&lt;!-- 测试指令集 （application 外面） --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">instrumentation</span> <span class="attr">android:name</span>=<span class="string">"android.test.InstrumentationTestRunner"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">android:targetPackage</span>=<span class="string">"应用包名"</span> <span class="attr">android:lable</span>=<span class="string">"标题（可省）"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<pre><code>\&lt;application android:icon="@drawable/icon"...&gt;
    ***\&lt;uses-library android:name="android.test.runner" /&gt;***
\&lt;/application&gt;
***&lt;instrumentation android:name="android.test.InstrumentationTestRunner"***
    ***android:targetPackage="cn.itcast.action" android:lable="Tests for My APP" /&gt;***</code></pre></li>
<li><p>Run As : <strong>Android JUnit Test</strong></p>
</li>
<li><p>加入误相减，console 会出现：junit.framework.AssertionFailedError: expected:&lt;8&gt; but was &lt;2&gt;</p>
<p>可根据不同的错误级别来显示</p>
</li>
</ol>
<h3 id="日志猫"><a href="#日志猫" class="headerlink" title="日志猫"></a>日志猫</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Log.v(tag<span class="comment">/*一般是 类名*/</span>, msg); <span class="comment">// v 级别（和 println 一样）	绿</span></span><br><span class="line">Log.i(tag<span class="comment">/*一般是 类名*/</span>, msg); <span class="comment">// info 级别		----		绿</span></span><br><span class="line">Log.d(tag<span class="comment">/*一般是 类名*/</span>, msg); <span class="comment">// debug 级别		----		蓝</span></span><br><span class="line">Log.w(tag<span class="comment">/*一般是 类名*/</span>, msg); <span class="comment">// warn 级别 		----		黄</span></span><br><span class="line">Log.e(tag<span class="comment">/*一般是 类名*/</span>, msg); <span class="comment">// error 级别 		----		红</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="文件存储操作"><a href="#文件存储操作" class="headerlink" title="文件存储操作"></a>文件存储操作</h2><pre><code>过程：File -&gt; FileStream -&gt; write / read &amp; read_buffer -&gt; close</code></pre><blockquote>
<p>向SD卡写数据需要存储权限<br>AndroidManiFest 增加权限：android.permission.WRITE_EXTERNAL_STORAGE</p>
</blockquote>
<h3 id="txt读写例程：绝对路径"><a href="#txt读写例程：绝对路径" class="headerlink" title="txt读写例程：绝对路径"></a>txt读写例程：绝对路径</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserInfoUtiles</span></span></span><br><span class="line"><span class="class"></span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 写入到文件</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">saveInfo</span><span class="params">(String username, String password)</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        {</span><br><span class="line">            String result = username + <span class="string">"&amp;"</span> + password;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 创建 File类 指定数据存储的位置</span></span><br><span class="line">            File file = <span class="keyword">new</span> File(<span class="string">"/data/data/包名/info.txt"</span>);</span><br><span class="line">            <span class="comment">// 创建一个文件输出流</span></span><br><span class="line">            FileOutputStream fos = <span class="keyword">new</span> FileOutputStream(file);</span><br><span class="line">            fos.write(result.getBytes());</span><br><span class="line">            fos.close();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">catch</span> (Exception e)</span><br><span class="line">        {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从文件读出</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String, String&gt; <span class="title">readInfo</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        {</span><br><span class="line">            Map&lt;String, String&gt; maps = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">            File file = <span class="keyword">new</span> File(<span class="string">"/data/data/包名/info.txt"</span>);</span><br><span class="line">            FileInputStream fis = <span class="keyword">new</span> FileInputStream(file);</span><br><span class="line">            BufferedReader bufr = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(fis));</span><br><span class="line">            String content = bufr.readLine(); <span class="comment">// 读取一行</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 分割文本</span></span><br><span class="line">            String[] splits = content.split(<span class="string">"&amp;"</span>);</span><br><span class="line">            String name = splits[<span class="number">0</span>];</span><br><span class="line">            String pwd = splits[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 把数据放到 Map 中</span></span><br><span class="line">            maps.put(<span class="string">"username"</span>, name);</span><br><span class="line">            maps.put(<span class="string">"password"</span>, pwd);</span><br><span class="line"></span><br><span class="line">            fis.close();</span><br><span class="line">            <span class="keyword">return</span> maps;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">catch</span> (Exception e)</span><br><span class="line">        {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用存入</span></span><br><span class="line"><span class="keyword">if</span> (UserInfoUtils.saveInfo(username, password))</span><br><span class="line">{</span><br><span class="line">    ...</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用取出</span></span><br><span class="line">Map&lt;String, String&gt; maps = UserInfoUtils.readInfo();</span><br><span class="line"><span class="keyword">if</span> (maps != <span class="keyword">null</span>)</span><br><span class="line">{</span><br><span class="line">    String name = maps.get(<span class="string">"username"</span>);</span><br><span class="line">    String pwd = maps.get(<span class="string">"password"</span>);</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="API-获取内部路径"><a href="#API-获取内部路径" class="headerlink" title="API 获取内部路径"></a>API 获取内部路径</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用API获取路径</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">saveInfo</span><span class="params">(Context context, String username, String password)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">// path = "/data/data/包名/files/"</span></span><br><span class="line">    String path = context.getFilesDir().getpath();</span><br><span class="line">    <span class="comment">// 用 path/info.txt 代替原来的 路径常量</span></span><br><span class="line">    File file = <span class="keyword">new</span> File(path, <span class="string">"info.txt"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 和前面一样的</span></span><br><span class="line">    FileOutputStream fos = <span class="keyword">new</span> FileOutputStream(file);</span><br><span class="line">    fos.write(result.getBytes());</span><br><span class="line">    fos.close();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用</span></span><br><span class="line">UserInfoUtils.saveInfo(MainActivity.<span class="keyword">this</span>, username, password);</span><br><span class="line">UserInfoUtils.readInfo(MainActivity.<span class="keyword">this</span>);</span><br></pre></td></tr></tbody></table></figure>

<h3 id="context-获取内部路径"><a href="#context-获取内部路径" class="headerlink" title="context 获取内部路径"></a>context 获取内部路径</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用上下文直接获取 FileOutputStream （类似API）</span></span><br><span class="line">FileOutputStream fos = context.openFileOutput(<span class="string">"info,txt"</span>, <span class="number">0</span><span class="comment">/*模式，4种*/</span>);</span><br><span class="line"></span><br><span class="line">fos.write(result.getBytes());</span><br><span class="line">fos.close();</span><br></pre></td></tr></tbody></table></figure>

<h3 id="Environment-获取SD卡路径"><a href="#Environment-获取SD卡路径" class="headerlink" title="Environment 获取SD卡路径"></a>Environment 获取SD卡路径</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// sdPath = "/mnt/sdcard"</span></span><br><span class="line">String sdPath = Environment.getExternalStorageDirectory().getPath();</span><br><span class="line">File file = <span class="keyword">new</span> File(sdPath, <span class="string">"info.txt"</span>);</span><br></pre></td></tr></tbody></table></figure>

<h3 id="判断SD卡是否可用"><a href="#判断SD卡是否可用" class="headerlink" title="判断SD卡是否可用"></a>判断SD卡是否可用</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( Environment.MEDIA_MOUNTED.equals( Environment.getExternalStorageState() ) ) {</span><br><span class="line">  	Toast.makeText(getApplicationContext(), <span class="string">"SD卡可用"</span>, <span class="number">1</span>).show();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="获取SD卡的可用空间"><a href="#获取SD卡的可用空间" class="headerlink" title="获取SD卡的可用空间"></a>获取SD卡的可用空间</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">File file = Envirinment.getExternalStorageDirectory();</span><br><span class="line"><span class="keyword">long</span> total = file.getTotalSpace(); <span class="comment">// 总空间（单位：byte）</span></span><br><span class="line"><span class="keyword">long</span> usable = file.getUsableSpace(); <span class="comment">// 可用空间（单位：byte）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//转换数据格式为可视化文本</span></span><br><span class="line">String Total = Formatter.formatFileSize(<span class="keyword">this</span>, total); <span class="comment">// this 是当前的 MainActivity</span></span><br><span class="line">String Usable = Formatter.formatFileSize(<span class="keyword">this</span>, usable); <span class="comment">// 每大于900则除以1024</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="文件权限"><a href="#文件权限" class="headerlink" title="文件权限"></a>文件权限</h3><p><strong>四种模式</strong></p>
<ul>
<li>MODE_PRIVATE  —  值为0</li>
<li>MODE_APPEND  —</li>
<li>MODE_WORLD_READABLE  r–</li>
<li>MODE_WORLD_WRITEABLE -w-</li>
</ul>
<p><strong>Linux文件权限表示：十位数</strong></p>
<ul>
<li>第一位：文件的类型 ( 例如：文件夹 d )</li>
<li>2-4位：用户的权限</li>
<li>5-7位：用户所在的组的权限</li>
<li>8-10位：其他用户的权限</li>
</ul>
<p><strong>r w x</strong></p>
<ul>
<li>r  可读</li>
<li>w 可写</li>
<li>x  可执行</li>
</ul>
<p>rw-   &lt;=&gt;  110  &lt;=&gt;  6</p>
<p><strong>改变文件权限</strong></p>
<p>Linux下的chhmod命令：<br>chmod 764 a.txt        // 文件权限为：rwx rw- r–<br>​                              111 110 100 == 7 6 4</p>
<h2 id="XML"><a href="#XML" class="headerlink" title="XML"></a>XML</h2><h3 id="保存设置文件-SharedPreferences"><a href="#保存设置文件-SharedPreferences" class="headerlink" title="保存设置文件 SharedPreferences"></a>保存设置文件 SharedPreferences</h3><p>（必须得会）</p>
<p>Sharedpreferences setting = getSharedPreferences(name, mode);<br>name:任意    mode:同上，4种模式<br>会自动生成：/data/data/包名/shared_prefs/name.xml 文件</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">SharedPreferences sp = <span class="keyword">new</span> SharedPreferences(<span class="string">"config"</span>, <span class="number">0</span>); <span class="comment">// 文件名为 config.xml  模式为 private 0</span></span><br><span class="line"><span class="comment">// 若改成"config.txt", 则会生成 config.txt.xml 文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取 sp 的编辑器</span></span><br><span class="line">Editor edit = sp.edit();</span><br><span class="line">edit.putString(<span class="string">"username"</span>, username);  <span class="comment">// key, value</span></span><br><span class="line">edit.putInt(<span class="string">"Age"</span>, age); <span class="comment">// edit.putXXX  有多种类型可选</span></span><br><span class="line">edit.putFloat(<span class="string">"PI"</span>, <span class="number">3.14</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 记得关闭 edit （提交）</span></span><br><span class="line">edit.commit();</span><br></pre></td></tr></tbody></table></figure>

<p>SharedPreferences.getString(key, defaultValue /*默认的，找不到时*/ );</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SharedPreferences sp = getSharedPreferences(<span class="string">"config"</span>, <span class="number">0</span>);</span><br><span class="line">sp.getString(<span class="string">"username"</span>, <span class="string">""</span>);</span><br></pre></td></tr></tbody></table></figure>

<p>对应的 xml 内容</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encodeing="UTF-8" standalone="true"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">"username"</span>&gt;</span>myname<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">"Age"</span>&gt;</span>20<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">  	...</span><br><span class="line"><span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="手动构建-xml-文件"><a href="#手动构建-xml-文件" class="headerlink" title="手动构建 xml 文件"></a>手动构建 xml 文件</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">build_xml</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 声明数组（其中 Sms 是自定义 class）</span></span><br><span class="line">    List&lt;Sms&gt; smsLists = <span class="keyword">new</span> ArrayList&lt;Sms&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建 sb 对象</span></span><br><span class="line">    StringBuffer sb = <span class="keyword">new</span> StringBuffer();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 开始组拼 xml 文件头(注意转移双引号)</span></span><br><span class="line">    sb.append(<span class="string">"&lt;?xml version=\"1.0\" encodeing=\"UTF-8\" ?&gt;"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 开始组拼 xml 根节点</span></span><br><span class="line">    sb.append(<span class="string">"&lt;smss&gt;"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 开始组建 xml 节点 （任意循环增加）</span></span><br><span class="line">    <span class="keyword">for</span> (Sms sms : smsLists)</span><br><span class="line">    {</span><br><span class="line">        sb.append(<span class="string">"&lt;num&gt;"</span>);</span><br><span class="line">        sb.append(<span class="string">"110"</span>);</span><br><span class="line">        sb.append(<span class="string">"&lt;/num&gt;"</span>);</span><br><span class="line"></span><br><span class="line">        sb.append(<span class="string">"&lt;people&gt;"</span>);</span><br><span class="line">        sb.append(<span class="string">"小明"</span>);</span><br><span class="line">        sb.append(<span class="string">"&lt;/people&gt;"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    sb.append(<span class="string">"&lt;/smss&gt;"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 保存到 SD卡 上</span></span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    {</span><br><span class="line">        File file = <span class="keyword">new</span> File(Environment.getExternalStorageDirectory().getPath(), <span class="string">"backup.xml"</span>);</span><br><span class="line">        FileOutputStream fos = <span class="keyword">new</span> FileOutputStream(file);</span><br><span class="line">        fos.write(sb, .toString().getBytes());</span><br><span class="line">        fos.close(); <span class="comment">// 关闭流</span></span><br><span class="line">        <span class="comment">// 注意写入到SD卡权限：WRITE_EXTERNAL_STORAGE</span></span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">catch</span> ( Exception e)</span><br><span class="line">    {</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="xml序列化器-xmlSerializer"><a href="#xml序列化器-xmlSerializer" class="headerlink" title="xml序列化器 xmlSerializer"></a>xml序列化器 xmlSerializer</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span></span><br><span class="line">{</span><br><span class="line">    <span class="comment">// 通过 Xml 类获取 XmlSerializer 类的实例</span></span><br><span class="line">    XmlSerializer sl = Xml.newSerializer();</span><br><span class="line">    <span class="comment">// 设置参数：XML文件路径</span></span><br><span class="line">    File file = <span class="keyword">new</span> File(Environment.getExternalStorageDirectory().getPath(), <span class="string">"backup2.xml"</span>);</span><br><span class="line">    FileOutputStream fos = <span class="keyword">new</span> FileOutputStream(file);</span><br><span class="line">    sl.setOutput(fos, <span class="string">"utf-8"</span>); <span class="comment">// 文件流与编码</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 开始写 xml 文档开头</span></span><br><span class="line">    sl.startDocument(<span class="string">"utf-8"</span>, <span class="keyword">true</span><span class="comment">/*standalone, 表示是一个独立的xml文件，没有其他文件的约束*/</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// xml 的根节点，namespace = null</span></span><br><span class="line">    sl.startTag(<span class="keyword">null</span>, <span class="string">"smss"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 循环写xml数据</span></span><br><span class="line">    <span class="keyword">for</span> (Sms sms : smsLists)</span><br><span class="line">    {</span><br><span class="line">        sl.startTag(<span class="keyword">null</span>, <span class="string">"sms"</span>);</span><br><span class="line"></span><br><span class="line">        sl.startTag(<span class="keyword">null</span>, <span class="string">"num"</span>);</span><br><span class="line">        sl.text(<span class="string">"110"</span>);</span><br><span class="line">        sl.endTag(<span class="keyword">null</span>, <span class="string">"num"</span>);</span><br><span class="line"></span><br><span class="line">        sl.startTag(<span class="keyword">null</span>, <span class="string">"people"</span>);</span><br><span class="line">        sl.text(<span class="string">"小明"</span>);</span><br><span class="line">        sl.endTag(<span class="keyword">null</span>, <span class="string">"people"</span>);</span><br><span class="line"></span><br><span class="line">        sl.endTag(<span class="keyword">null</span>, <span class="string">"sms"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    sl.endTag(numll, <span class="string">"smss"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 写文档结尾</span></span><br><span class="line">    sl.endDocument();</span><br><span class="line">    fos.close(); <span class="comment">// 关闭流</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="xml的解析"><a href="#xml的解析" class="headerlink" title="xml的解析"></a>xml的解析</h3><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 目标 xml 文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">weather</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">channel</span> <span class="attr">id</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">city</span>&gt;</span>背景<span class="tag">&lt;/<span class="name">cith</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">temp</span>&gt;</span>25<span class="tag">&lt;/<span class="name">temp</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">channel</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">channel</span>&gt;</span></span><br><span class="line">		...</span><br><span class="line">	<span class="tag">&lt;/<span class="name">channel</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	...</span><br><span class="line"><span class="tag">&lt;/<span class="name">weather</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 调用：</span></span><br><span class="line"><span class="keyword">try</span></span><br><span class="line">{</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取 Assets 的文件</span></span><br><span class="line">    InputStream inputStream = getAssets().open(<span class="string">"weather.xml"</span>);</span><br><span class="line"></span><br><span class="line">    List&lt;Channel&gt; weatherlists = WeatherParser.parserXml(inputstream);</span><br><span class="line"></span><br><span class="line">    StringBuffer sb = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">    <span class="keyword">for</span> (Channel channel : weatherlists)</span><br><span class="line">    {</span><br><span class="line">        sb.append(channel.toString());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    System.out.println(sb.toString());</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// WeatherParser类的parserXml方法：</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;Channel&gt; <span class="title">parserXml</span><span class="params">(InputStream in)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    {</span><br><span class="line">        List&lt;Channel&gt; weather: ists = <span class="keyword">null</span>;</span><br><span class="line">        Channel channel = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取解析的实例</span></span><br><span class="line">        XmlPullParser parser = Xml.newPullParser();</span><br><span class="line">        <span class="comment">// 设置解析参数(in是输入流)</span></span><br><span class="line">        parser.setInput(in, <span class="string">"utf-8"</span>);</span><br><span class="line">        <span class="comment">// 获取事件类型</span></span><br><span class="line">        <span class="keyword">int</span> type = parser.getEventType();</span><br><span class="line">        <span class="keyword">while</span> (type != XmlPullParser.END_DOCUMENT <span class="comment">/*==1*/</span>)</span><br><span class="line">        {</span><br><span class="line">            <span class="comment">// 具体判断解析到哪个节点</span></span><br><span class="line">            <span class="keyword">switch</span> (type)</span><br><span class="line">            {</span><br><span class="line">            <span class="comment">// 具体判断一下 解析到哪个开始标志</span></span><br><span class="line">            <span class="keyword">case</span> XmlPullParser.START_TAG : <span class="comment">// 解析开始标志</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="string">"weather"</span>.equals(parser.getName()))</span><br><span class="line">                {</span><br><span class="line">                    <span class="comment">// 创建一个集合对象</span></span><br><span class="line">                    weatherLists = <span class="keyword">new</span> ArrayList&lt;Channel&gt;();</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"channel"</span>.equals(parser.getName()))</span><br><span class="line">                {</span><br><span class="line">                    <span class="comment">// 创建Channel对象</span></span><br><span class="line">                    channel = <span class="keyword">new</span> Channel();</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 获取ID：第1个数，下标0</span></span><br><span class="line">                    String id = parser.getAttributeValue(<span class="number">0</span>)</span><br><span class="line">                                channel.setId(id); <span class="comment">// 自定义类的方法</span></span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"city"</span>.equals(parser.getName()))</span><br><span class="line">                {</span><br><span class="line">                    <span class="comment">// 获取city的数据</span></span><br><span class="line">                    String city = parser.getText();</span><br><span class="line">                    channel.setCity(city);</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"temp"</span>.equals(parser.getName()))</span><br><span class="line">                {</span><br><span class="line">                    <span class="comment">// 获取temp的数据</span></span><br><span class="line">                    String temp = parser.getText();</span><br><span class="line">                    channel.setTemp(temp);</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> XmlPullParser.END_TAG : <span class="comment">// 解析结束标志</span></span><br><span class="line">                <span class="comment">// 判断要解析的结束标签</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="string">"channel"</span>.equals(parser.getName()))</span><br><span class="line">                {</span><br><span class="line">                    <span class="comment">// 把 Javabean 对象存到集合中</span></span><br><span class="line">                    weatherLists.add(channel);</span><br><span class="line"></span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 不停地向下解析</span></span><br><span class="line">            parser.next();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> weatherLists;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">catch</span> ( Exception e ) { }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h2><h3 id="sqlite-数据库初始化"><a href="#sqlite-数据库初始化" class="headerlink" title="sqlite 数据库初始化"></a>sqlite 数据库初始化</h3><h4 id="SQLiteOpenHelper"><a href="#SQLiteOpenHelper" class="headerlink" title="SQLiteOpenHelper"></a>SQLiteOpenHelper</h4><p><strong>SQLiteOpenHelper类</strong> 用来管理数据库的创建 ，创建子类来继承它</p>
<p><strong>db.execSQL(string sql)</strong>  执行SQL语句</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.database.sqlite.SQLiteDababase;</span><br><span class="line"><span class="keyword">import</span> android.database.sqlite.SQLiteOpenHelper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyOpenHelper</span> <span class="keyword">extends</span> <span class="title">SQLiteOpenHelper</span> </span>{</span><br><span class="line">  </span><br><span class="line">  	<span class="comment">// 需要添加无参构造方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyOpenHelper</span><span class="params">(Context context)</span> </span>{</span><br><span class="line">       	<span class="comment">// 创建数据库，上下文、名字、cursor对象（结果集/游标）、数据库版本（从1开始）</span></span><br><span class="line">      	<span class="keyword">super</span>(context, <span class="string">"test.db"</span>, <span class="keyword">null</span>, <span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 数据库第一次创建的时候用（仅一次），特别适合做表结构的初始化</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(SQLiteDatabase db)</span> </span>{</span><br><span class="line">        <span class="comment">// 创建表的结构</span></span><br><span class="line">        db.execSQL(<span class="string">"create table info( _id integer primary key autoincrement, name varchar(20) )"</span>);</span><br><span class="line">        <span class="comment">// SQLite数据库底层不区分数据类型，但是SQL语句还是得照写声明类别（所有SQL语句都一样）</span></span><br><span class="line">        <span class="comment">// integer 也是用 string 来存储，varchar(20) 可以存更长的 string</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">  	<span class="comment">// 数据库升级的时候调用（不能降级，会出错）</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onUpgrade</span><span class="params">(SQLiteDatabase db, <span class="keyword">int</span> oldVersion, <span class="keyword">int</span> newVersion)</span> </span>{</span><br><span class="line">		<span class="comment">//例如：升级 info表 添加 phone字段</span></span><br><span class="line">      	db.execSQL(<span class="string">"alter table info add phone varchar(20)"</span>);</span><br><span class="line">    } </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="MainActivity部分"><a href="#MainActivity部分" class="headerlink" title="MainActivity部分"></a>MainActivity部分</h4><p>数据库路径：<strong>/data/data/包名/databases/数据库名字.db</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span></span></span><br><span class="line"><span class="class"></span>{</span><br><span class="line">	<span class="keyword">private</span> MyOpenHelp myOpenHelper;</span><br><span class="line">	</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建数据库（包名），触发 构造方法、onCreate() 事件</span></span><br><span class="line">        myOpenHelper = <span class="keyword">new</span> MyOpenHelper(getApplicationContext());</span><br><span class="line">        <span class="comment">// 创建（第一次）或打开数据库</span></span><br><span class="line">        SQLiteDatabase sqLiteDatabase = myOpenHelper.getWriteableDatabase();</span><br><span class="line">        <span class="comment">// 创建（第一次）或打开数据库；如果磁盘已满则返回只读</span></span><br><span class="line">        <span class="comment">// SQLiteDatabase readableDatabase = myOpenHelper.getReadableDatabase();</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="执行SQL语句"><a href="#执行SQL语句" class="headerlink" title="执行SQL语句"></a>执行SQL语句</h3><h4 id="execSQL"><a href="#execSQL" class="headerlink" title="execSQL"></a>execSQL</h4><p>void execSQL(sql, bindArgs); // 修改语句，无返回值</p>
<p>SQLiteDatabase execSQL(sql); // 查找语句，有返回值</p>
<figure class="highlight sql"><figcaption><span>lite</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> info(<span class="keyword">name</span>, phone) <span class="keyword">values</span>(<span class="string">"Tom"</span>, <span class="string">"110"</span>); <span class="comment">-- 两个斜杠表示注释</span></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> info <span class="keyword">where</span> <span class="keyword">name</span> = <span class="string">"Tom"</span>l</span><br><span class="line"><span class="keyword">update</span> info <span class="keyword">set</span> phone = <span class="string">"120"</span> <span class="keyword">where</span> <span class="keyword">name</span> = <span class="string">"Tom"</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">name</span>, phone <span class="keyword">from</span> info;</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 执行 SQL语句</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="comment">// 获取数据库对象</span></span><br><span class="line">    SQLiteDatabase db = myOpenHelper.getWritableDatabase();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 执行增加一条的SQL语句</span></span><br><span class="line">    db.execSQL(<span class="string">"insert into info (name, phone) values(?, ?)"</span>, <span class="keyword">new</span> Object[] {<span class="string">"Tim"</span>, <span class="string">"119"</span>});</span><br><span class="line">    <span class="comment">// 执行删除语句</span></span><br><span class="line">    db.execSQL(<span class="string">"delete from info where name=?"</span>, <span class="keyword">new</span> Object[] {<span class="string">"Tom"</span>}<span class="comment">/*bindArgs*/</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 数据库用完需关闭（官方建议关闭，但是不关可提升效率）</span></span><br><span class="line">    db.close();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="Cursor"><a href="#Cursor" class="headerlink" title="Cursor"></a>Cursor</h4><ul>
<li>int getCount() 行数    getColumnCount() 列数</li>
<li>String getString(int columnIndex)</li>
<li>boolean moveToNext()    moveToFirst()    moveToLast()    moveToPosition(int position)    moveToPrevious()</li>
<li>String[] getColumnNames() 所有列的名字</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    SQLiteDatabase db = myOpenHelper.getReadableDatabase(); <span class="comment">// 只读就行了</span></span><br><span class="line"></span><br><span class="line">    Cursor cursor = db.rawQuery(<span class="string">"select * from info"</span>, <span class="keyword">null</span>);</span><br><span class="line">    <span class="keyword">if</span> (cursor != <span class="keyword">null</span> &amp;&amp; cursor.getCount() &gt; <span class="number">0</span>)</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">while</span> (cursor.moveToNext())</span><br><span class="line">        {</span><br><span class="line">            String name = cursor.getString(<span class="number">1</span>); <span class="comment">// 这一行第二列的值</span></span><br><span class="line">            System.out.println(<span class="string">"name:"</span> + name);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="SQL优缺点"><a href="#SQL优缺点" class="headerlink" title="SQL优缺点"></a>SQL优缺点</h4><p>缺点</p>
<ul>
<li>SQL语句容易写错</li>
<li>没有返回值，结果不容易判断</li>
</ul>
<p>优点</p>
<ul>
<li>多表查询（自由、功能强）</li>
</ul>
<h4 id="sqlite3"><a href="#sqlite3" class="headerlink" title="sqlite3"></a>sqlite3</h4><h5 id="命令行SQL语句"><a href="#命令行SQL语句" class="headerlink" title="命令行SQL语句"></a>命令行SQL语句</h5><p>开启shell <code>adb shell</code></p>
<p>定位到目录 <code># cd /data/data/包名/databases</code></p>
<p>打开数据库 <code># sqlite3 数据库名字.db</code></p>
<p>sqlite&gt; <code>SQL语句</code>    （不包括前面的sqlite&gt;）</p>
<h5 id="改变DOS编码"><a href="#改变DOS编码" class="headerlink" title="改变DOS编码"></a>改变DOS编码</h5><blockquote>
<p>如果中文乱码，点击cmd属性，看编码是否为UTF-8（默认GBK）</p>
</blockquote>
<p>改成GBK <code>chcp 936</code> </p>
<p>改成UTF-8 <code>chcp 65001</code></p>
<blockquote>
<p>chcp: <u>ch</u>ar <u>c</u>hange <u>p</u>age</p>
</blockquote>
<h3 id="谷歌封装好的数据库API"><a href="#谷歌封装好的数据库API" class="headerlink" title="谷歌封装好的数据库API"></a>谷歌封装好的数据库API</h3><p>原理是组拼SQL语句</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    SQLiteDatabase db = myOpenHelper.getWritableDatabase();</span><br><span class="line"></span><br><span class="line">    ContentValues values = <span class="keyword">new</span> ContentValues();</span><br><span class="line">    values.put(<span class="string">"name"</span>, <span class="string">"Tom"</span>);</span><br><span class="line">    values.put(<span class="string">"phone"</span>, <span class="string">"110"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加记录：表名、null、map数组：名字=&gt;值。返回 long -1失败 或 行号（1开始）</span></span><br><span class="line">    <span class="keyword">long</span> num = db.insert(<span class="string">"info"</span>, <span class="keyword">null</span>, values);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 删除记录：表名、条件、条件值。返回 int 影响的行数， 0 为没有删除</span></span><br><span class="line">    <span class="keyword">int</span> num = db.delete(<span class="string">"info"</span>, <span class="string">"name=?"</span>, <span class="keyword">new</span> String[] {<span class="string">"Tom"</span>});</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新记录：表名、map数组、条件、条件值。 返回 int 影响的行数</span></span><br><span class="line">    <span class="keyword">int</span> num = db.update(<span class="string">"info"</span>, values, <span class="string">"name=?"</span>, <span class="keyword">new</span> String[] {<span class="string">"Tom"</span>});</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询：表名、查询的列String[]（null为全部列）、条件、条件值String[]、分组、过滤条件、排序</span></span><br><span class="line">    <span class="comment">// 选择查询的列（参数二）：new String[]{"name", "phone"}</span></span><br><span class="line">    Cursor cursor = db.query(<span class="string">"info"</span>, <span class="keyword">null</span>, <span class="string">"name=?"</span>, <span class="keyword">new</span> String[] {<span class="string">"Tom"</span>}, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">    <span class="keyword">if</span> (cursor != <span class="keyword">null</span> &amp;&amp; cursor.getCount() &gt; <span class="number">0</span>)</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">while</span>(cursor.moveToNext())</span><br><span class="line">        {</span><br><span class="line">            String name = cursor.getString(<span class="number">0</span>); <span class="comment">// 第一列（name）</span></span><br><span class="line">            String phone = cursor.getString(<span class="number">1</span>); <span class="comment">// 第二列（phone）</span></span><br><span class="line">            System.out.println(<span class="string">"name="</span> + name + <span class="string">" phone="</span> + phone);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    db.close();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>优点</p>
<ul>
<li>写法简单</li>
<li>有返回值</li>
</ul>
<p>缺点</p>
<ul>
<li>多张表不容易查询</li>
</ul>
<h3 id="数据库的事物"><a href="#数据库的事物" class="headerlink" title="数据库的事物"></a>数据库的事物</h3><p>例如：转账，需要取出、存入同时成功</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(Veiw v)</span></span>{</span><br><span class="line">    SQLiteDatabase db = myOpenHelper.getReadableDatabase();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用事物进行操作</span></span><br><span class="line">    db.beginTransaction();</span><br><span class="line">    <span class="keyword">try</span>{</span><br><span class="line">        <span class="comment">// 实现逻辑，即SQL语句</span></span><br><span class="line">        db.execSQL(<span class="string">"update ac_mon set money = money - 100 where name = ?"</span>, <span class="keyword">new</span> String[]{<span class="string">"userA"</span>});</span><br><span class="line">        <span class="comment">/* int i = 10 / 0; // 运行中断 */</span></span><br><span class="line">        db.execSQL(<span class="string">"update ac_mon set money = money + 100 where name = ?"</span>, <span class="keyword">new</span> String[]{<span class="string">"userB"</span>});</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 给当前事物设置一个成功的标记</span></span><br><span class="line">        db.setTansactionSuccessful();</span><br><span class="line">    } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">      	Toast.makeText(getApplicationContext(), <span class="string">"服务器忙，请稍后再试"</span>, <span class="number">1</span>).show();</span><br><span class="line">    } <span class="keyword">finally</span> {</span><br><span class="line">      	db.endTransaction(); <span class="comment">// 关闭事物</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="ListView"><a href="#ListView" class="headerlink" title="ListView"></a>ListView</h2><h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><h4 id="1、布局：activity-main"><a href="#1、布局：activity-main" class="headerlink" title="1、布局：activity_main"></a>1、布局：activity_main</h4><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ListView</span></span></span><br><span class="line"><span class="tag">          <span class="attr">android:id</span>=<span class="string">"@+id/lv"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">android:layout_witdh</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">android:fastScrollEnabled</span>=<span class="string">"true"</span>&gt;</span> <span class="comment">&lt;!--快速滚动条--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ListView</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="2、设置Adapter"><a href="#2、设置Adapter" class="headerlink" title="2、设置Adapter"></a>2、设置Adapter</h4><p>连接到数据适配器：<code>setAdapter()</code></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>{</span><br><span class="line">  	<span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle saveInstanceState)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 找到控件</span></span><br><span class="line">        ListView lv = (ListView) findViewById(R.id.lv);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 显示数据（数据来源于数据适配器）</span></span><br><span class="line">        lv.setAdapter(<span class="keyword">new</span> MyListAdapter());</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="3、实现BaseAdapter方法"><a href="#3、实现BaseAdapter方法" class="headerlink" title="3、实现BaseAdapter方法"></a>3、实现BaseAdapter方法</h4><p><strong>BaseAdapter</strong></p>
<p>可以放到上面的 MainActivity 类的代码里面，作为类中类</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">MyListAdapter</span> <span class="keyword">extends</span> <span class="title">BaseAdapter</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 项目数量</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="number">4</span>; <span class="comment">/*item数量，自定义*/</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 对应的对象</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getItem</span><span class="params">(<span class="keyword">int</span> position)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 对应的ID</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getItemID</span><span class="params">(<span class="keyword">int</span> position)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取一个view，用来显示每个item的数据</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">getView</span><span class="params">(<span class="keyword">int</span> position, View convertView, ViewGroup parent)</span> </span>{</span><br><span class="line">        TextView tv = <span class="keyword">new</span> TextView(MainActivity.<span class="keyword">this</span><span class="comment">/*当前类*/</span>);</span><br><span class="line">        tv.setText(<span class="string">"索引："</span> + position);</span><br><span class="line">        <span class="keyword">return</span> tv; <span class="comment">// return null 的话会报错</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="错误提示"><a href="#错误提示" class="headerlink" title="错误提示"></a>错误提示</h4><p><code>Attempt to invoke virtual method 'int android.view.View.getImportantForAccessibility()' on a null object reference</code></p>
<p>原因是 getView() 返回值为空……</p>
<h4 id="结果示例"><a href="#结果示例" class="headerlink" title="结果示例"></a>结果示例</h4><p><code>getCount()</code>控制条目数量。当数量=4时：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>{ <span class="keyword">return</span> <span class="number">4</span>; }</span><br></pre></td></tr></tbody></table></figure>

<p>结果：</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">索引：0</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">索引：1</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">索引：2</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">索引：3</span><br></pre></td></tr></tbody></table></figure>

<p>每个item都是一个TextView，其由<code>getView()</code>方法决定</p>
<h4 id="显示数据的原理"><a href="#显示数据的原理" class="headerlink" title="显示数据的原理"></a>显示数据的原理</h4><p><strong>MVC</strong></p>
<p>Javaweb:</p>
<ul>
<li>m : mode 数据</li>
<li>v : view 视图 jsp</li>
<li>c : controller 控制 sevlet</li>
</ul>
<p>Android:</p>
<ul>
<li>m : mode 数据(javabean)</li>
<li>v : listview</li>
<li>c : adapter</li>
</ul>
<h3 id="ListView优化"><a href="#ListView优化" class="headerlink" title="ListView优化"></a>ListView优化</h3><h4 id="getView-方法说明"><a href="#getView-方法说明" class="headerlink" title="getView() 方法说明"></a>getView() 方法说明</h4><p>只有在屏幕上显示（包括只显示一点点）的item才会触发<code>getView()</code>方法。<br>滚动时新显示的条目也会触发。<br>快速滚动加载大量View可能会导致内存溢出（Out Of Memory）。</p>
<h4 id="convertView-缓存机制"><a href="#convertView-缓存机制" class="headerlink" title="convertView 缓存机制"></a>convertView 缓存机制</h4><p>item并不是滚动完就销毁。<br>使用 <code>convertView</code> 历史缓存可避免内存溢出。</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> View <span class="title">getView</span><span class="params">(<span class="keyword">int</span> position, View convertView, ViewGroup parent)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line"></span><br><span class="line">    TextView tv;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (convertView == <span class="keyword">null</span>)</span><br><span class="line">    {</span><br><span class="line">        <span class="comment">// 缓存对象为空，创建新的 view 对象</span></span><br><span class="line">        tv = <span class="keyword">new</span> TextView(MainActivity.<span class="keyword">this</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    {</span><br><span class="line">        <span class="comment">// 使用历史缓存对象</span></span><br><span class="line">        tv = (TextView) convertView;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    tv.setText(<span class="string">"索引："</span> + position);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> tv;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>复用历史缓存对象：一开始时是真的创建可见范围内的对象，滚动上去后，新出现（底部）的对象实际上是复用已经加载好但是看不见了的（顶部）的对象。根据 <code>position</code> 调用 <code>getView()</code> 方法。</p>
<blockquote>
<p>例如，快速滚动时加载100个item，不用缓存需要创建100个TextView。使用 convertView 后，只需要设置TextView的值就好了。</p>
</blockquote>
<h4 id="List高度设置"><a href="#List高度设置" class="headerlink" title="List高度设置"></a>List高度设置</h4><p>能否设置成 <code>layout_height="wrap_content"</code> ？</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ListView</span></span></span><br><span class="line"><span class="tag">          <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</span> <span class="comment">&lt;!--这是正常的--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ListView</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>改成<code>android:layout_height="wrap_content"</code>后，无法确定高度，校验很多次，重复调用 <code>getView()</code> 方法，严重影响性能。</p>
<h3 id="复杂的ListView"><a href="#复杂的ListView" class="headerlink" title="复杂的ListView"></a>复杂的ListView</h3><p>┍━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┑<br>│ ┌───────┐   <strong>这里是项目标题，字…</strong>   │<br>│ │    Image    │      <code>这个部分是项目相对应</code>  │<br>│ └───────┘  <code>的信息内容</code>                     │<br>┕━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┙</p>
<h4 id="1、Layout：activity-main"><a href="#1、Layout：activity-main" class="headerlink" title="1、Layout：activity_main"></a>1、Layout：activity_main</h4><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ListView</span></span></span><br><span class="line"><span class="tag">	<span class="attr">android:id</span>=<span class="string">"@+id/lv"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">android:layout_witdh</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ListView</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="2、Layout-item（xml）"><a href="#2、Layout-item（xml）" class="headerlink" title="2、Layout : item（xml）"></a>2、Layout : item（xml）</h4><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_witdh</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span> &gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/iv_icon"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:src</span>=<span class="string">"@drawable/ic_launcher"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/tv_title"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span>    // 左边与父容器右边的距离</span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_toRightOf</span>=<span class="string">"@id/iv_icon"</span> // 图片右边</span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginTop</span>=<span class="string">"3dp"</span> // 顶部留空</span></span><br><span class="line"><span class="tag">        <span class="attr">android:singleLine</span>=<span class="string">"true"</span> // 单行显示</span></span><br><span class="line"><span class="tag">        <span class="attr">android:ellipsize</span>=<span class="string">"end"</span>   // 显示开头，末尾三个点。<span class="attr">start</span>值相反</span></span><br><span class="line"><span class="tag">        <span class="attr">androi:textColor</span>=<span class="string">"#000000"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textsize</span>=<span class="string">"20sp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"这个里项目标题，字体加粗加黑"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/tv_message"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_toRightOf</span>=<span class="string">"@id/iv_icon"</span> // 图片右边</span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_below</span>=<span class="string">"@id/tv_text"</span>     // 标题下面</span></span><br><span class="line"><span class="tag">        <span class="attr">android:singleLine</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:ellipsize</span>=<span class="string">"end"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">androi:textColor</span>=<span class="string">"#666666"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textsize</span>=<span class="string">"15sp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"这个里项目标题，字体加粗加黑"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="3、BaseAdapter：打气筒"><a href="#3、BaseAdapter：打气筒" class="headerlink" title="3、BaseAdapter：打气筒"></a>3、BaseAdapter：打气筒</h4><p><code>View View.inflate(context, resource, root)</code> 方法（打气筒）<br>介绍：创建新的View对象，把布局资源（xml 文件）折换成一个 View 对象，放到父容器中，并返回这个 View 对象</p>
<ul>
<li>context : <code>getApplicationContext()</code>，或 <code>this</code></li>
<li>resource : 定义的布局文件 R.id.xxx</li>
<li>root : null，或者待放入的容器(ViewGroup)</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span></span></span><br><span class="line"><span class="class"></span>{</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle saveInstanceState)</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 找到控件</span></span><br><span class="line">        ListView lv = (ListView) findViewById(R.id.lv);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 显示数据（数据来源于数据适配器）</span></span><br><span class="line">        lv.setAdapter(<span class="keyword">new</span> MyListAdapter);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">MyListAdapter</span> <span class="keyword">extends</span> <span class="title">BaseAdapter</span></span></span><br><span class="line"><span class="class">    </span>{</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 项目数量</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>{</span><br><span class="line">            <span class="keyword">return</span> <span class="number">4</span>; <span class="comment">/*item数量，自定义*/</span></span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 对应的对象</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Object <span class="title">getItem</span><span class="params">(<span class="keyword">int</span> position)</span></span></span><br><span class="line"><span class="function">        </span>{</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 对应的ID</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getItemID</span><span class="params">(<span class="keyword">int</span> position)</span></span></span><br><span class="line"><span class="function">        </span>{</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取一个view，用来显示每个item的数据</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> View <span class="title">getView</span><span class="params">(<span class="keyword">int</span> position, View convertView, ViewGroup parent)</span></span></span><br><span class="line"><span class="function">        </span>{</span><br><span class="line"></span><br><span class="line">            View view;</span><br><span class="line">            <span class="keyword">if</span> (convertView == <span class="keyword">null</span>)</span><br><span class="line">            {</span><br><span class="line">                <span class="comment">// 获取打气筒服务</span></span><br><span class="line">                view = View.inflate(getApplicationContext, R.id.item, <span class="keyword">null</span>);</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            {</span><br><span class="line">                <span class="comment">// 复用历史缓存对象</span></span><br><span class="line">                view = (TextView) convertView;</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">//根据列表设置控件数据</span></span><br><span class="line">            <span class="comment">//TextView tv = (TextView) view.findViewById(R.id.tv);</span></span><br><span class="line">            <span class="comment">//view.setText(xxLists.get(position).getXx());</span></span><br><span class="line">            <span class="keyword">return</span> view;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>获取 XML 布局里面的控件：<code>view.findViewById()</code></strong>，不能直接 <code>findViewById()</code></p>
<h5 id="打气筒的三种写法"><a href="#打气筒的三种写法" class="headerlink" title="打气筒的三种写法"></a>打气筒的三种写法</h5><p>打气筒写法一：View.inflate()</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">view = View.inflate(getApplicationContext, R.id.item, <span class="keyword">null</span>); <span class="comment">// 用法见上</span></span><br></pre></td></tr></tbody></table></figure>

<p>打气筒写法二：LayoutInflater.from()</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">view = LayoutInflater.from(getApplicationContext()).inflate(R.layout.item, <span class="keyword">null</span>);</span><br></pre></td></tr></tbody></table></figure>

<p>打气筒写法三：getSystemService()<br>据说实际上用得比较多</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LayoutInflater inflater = (LayoutInflater) getSystemService(LAYOUT_INFLATER_SERVICE);</span><br><span class="line">view = inflater.inflate(R.layout.item, <span class="keyword">null</span>);</span><br></pre></td></tr></tbody></table></figure>

<p>其他写法：不常见</p>
<h3 id="ArrayAdapter"><a href="#ArrayAdapter" class="headerlink" title="ArrayAdapter"></a>ArrayAdapter</h3><p>布局：activity_main</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ListView</span></span></span><br><span class="line"><span class="tag">          <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ListView</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>布局：item</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">          <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">TextView</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>MainActivity</strong></p>
<p><code>ArraryAdapter&lt;String&gt;(context, resource, objects)</code></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.R.array;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainAcitivity</span> <span class="keyword">extends</span> <span class="title">Activity</span></span></span><br><span class="line"><span class="class"></span>{</span><br><span class="line"></span><br><span class="line">    String names[] = { <span class="string">"111"</span>, <span class="string">"222"</span>, <span class="string">"333"</span>, <span class="string">"444"</span> };</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreat</span><span class="params">(Bundle savedInstanceState)</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line"></span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 找到控件</span></span><br><span class="line">        ListView lv = (ListView) findViewById(R.id.lv);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建 ArrayAdapter : context, resource(只有TextView的xml文件), 数据数组</span></span><br><span class="line">        ArrayAdapter&lt;String&gt; adapter = <span class="keyword">new</span> ArrayAdapter&lt;String&gt;(<span class="keyword">this</span>, R.id.item, names);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置数据适配器</span></span><br><span class="line">        lv.setAdapter(adapter);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>结果</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">111</span><br><span class="line">222</span><br><span class="line">333</span><br><span class="line">444</span><br></pre></td></tr></tbody></table></figure>

<p>重载的四个参数的ArrayAdapter用法：</p>
<p><code>ArraryAdapter&lt;String&gt;(context, resource, textViewResourceId, objects)</code></p>
<p><code>textViewResourceId</code> 为 resource 布局文件里面的某个特定的 TextView 的 ID</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ArrayAdapter&lt;String&gt; adapter = <span class="keyword">new</span> ArrayAdapter&lt;String&gt;(<span class="keyword">this</span>, R.id.item, R.id.tv, names);</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span> <span class="attr">...</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/tv"</span> <span class="attr">...</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="SimpleAdapter"><a href="#SimpleAdapter" class="headerlink" title="SimpleAdapter"></a>SimpleAdapter</h3><p>┍━━━━━━━━━━━━━━━━━━━━━┑<br>│┌───────┐┌───────┐│<br>││    name     │ │    phone    ││<br>│└───────┘└───────┘│<br>┕━━━━━━━━━━━━━━━━━━━━━┙</p>
<p>布局：activity_main</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span> <span class="attr">...</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ListView</span> <span class="attr">...</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>布局：item</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns</span>=<span class="string">"..."</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">android:orientation</span>=<span class="string">"horizental"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  	<span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/tv_name"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_weight</span>=<span class="string">"1"</span></span></span><br><span class="line"><span class="tag">    	<span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">  	<span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/tv_phone"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_weight</span>=<span class="string">"1"</span></span></span><br><span class="line"><span class="tag">    	<span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>代码：MainActivity</strong></p>
<p><code>SimpleAdapter adapter = new SimapleAdapter(context, data, resource, from, to);</code> // 参数长的那个</p>
<ul>
<li><code>data</code> 是 <strong><code>List&lt;Map&lt;String, String&gt;&gt;</code></strong> 类型数据</li>
<li><code>resource</code> 是 布局文件（上面的 item）</li>
<li><code>from</code> 是 String[] 类型，表示 <code>Map&lt;String, String&gt;</code> 的键</li>
<li><code>to</code> 是 int[] 类型数组，与<code>from</code> 对应的布局文件中的 TextView 的 ID</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 找到控件</span></span><br><span class="line">ListView lv = (ListView) findViewById(R.id.lv);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 准备数据</span></span><br><span class="line">List&lt;Map&lt;String, String&gt;&gt; data = <span class="keyword">new</span> ArrayList&lt;Map&lt;String, String&gt;&gt;();</span><br><span class="line"></span><br><span class="line">Map&lt;String, String&gt; map1 = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">map1.put(<span class="string">"name"</span>, <span class="string">"Tom"</span>);</span><br><span class="line">map1.put(<span class="string">"phone"</span>, <span class="string">"110"</span>);</span><br><span class="line"></span><br><span class="line">Map&lt;String, String&gt; map2 = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">map2.put(<span class="string">"name"</span>, <span class="string">"Alice"</span>);</span><br><span class="line">map2.put(<span class="string">"phone"</span>, <span class="string">"120"</span>);</span><br><span class="line"></span><br><span class="line">data.add(map1);</span><br><span class="line">data.add(map2);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置数据适配器</span></span><br><span class="line">SimpleAdapter adapter = <span class="keyword">new</span> SimapleAdapter(getApplicationContext(), data, R.id.item,</span><br><span class="line">				<span class="keyword">new</span> String[]{ <span class="string">"name"</span>, <span class="string">"phone"</span> }, <span class="keyword">new</span> String[]{ R.id.tv_name, R.id.tv_phone });</span><br><span class="line">lv.setAdapter(adapter);</span><br></pre></td></tr></tbody></table></figure>

<h3 id="用ListView展示数据库的数据"><a href="#用ListView展示数据库的数据" class="headerlink" title="用ListView展示数据库的数据"></a>用ListView展示数据库的数据</h3><p>┍━━━━━━━━━━━━━━━━━━━━━┑<br>│┌───────┐┌───────┐│<br>││    name     │ │    phone    ││<br>│└───────┘└───────┘│<br>┕━━━━━━━━━━━━━━━━━━━━━┙</p>
<p>布局：activity_main</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">略</span><br></pre></td></tr></tbody></table></figure>

<p>布局：item</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns</span>=<span class="string">"..."</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">android:orientation</span>=<span class="string">"horizental"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  	<span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/tv_name"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_weight</span>=<span class="string">"1"</span></span></span><br><span class="line"><span class="tag">    	<span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">  	<span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/tv_phone"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_weight</span>=<span class="string">"1"</span></span></span><br><span class="line"><span class="tag">    	<span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>类：Person</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String name, phone;</span><br><span class="line">略</span><br></pre></td></tr></tbody></table></figure>

<p><strong>MainActivity</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainAcitivity</span> <span class="keyword">extends</span> <span class="title">Activity</span></span></span><br><span class="line"><span class="class"></span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 找到控件</span></span><br><span class="line">    ListView lv = (ListView) findViewById(R.id.lv);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 整理数据</span></span><br><span class="line">    List&lt;Person&gt; lists = <span class="keyword">new</span> ArrayList&lt;Person&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreat</span><span class="params">(Bundle savedInstanceState)</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line"></span><br><span class="line">        SQLiteDatabase db = myOpenHelper.getWritableDatabase();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 查询：表名、查询的列String[]（null为全部列）、条件、条件值String[]、分组、过滤条件、排序</span></span><br><span class="line">        <span class="comment">//Cursor cursor = db.query("info", null, "name=?", new String[]{"Tom"}, null, null, null);</span></span><br><span class="line">        Cursor cursor = db.query(<span class="string">"info"</span>, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>); <span class="comment">// 查询所有</span></span><br><span class="line">        <span class="keyword">if</span> (cursor != <span class="keyword">null</span> &amp;&amp; cursor.getCount() &gt; <span class="number">0</span>)   <span class="comment">// 如果有数据</span></span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">while</span>(cursor.moveToNext())</span><br><span class="line">            {</span><br><span class="line">                String name = cursor.getString(<span class="number">0</span>); <span class="comment">// 第一列（name）</span></span><br><span class="line">                String phone = cursor.getString(<span class="number">1</span>); <span class="comment">// 第二列（phone）</span></span><br><span class="line"></span><br><span class="line">                Person person = <span class="keyword">new</span> Person(name, phone);</span><br><span class="line">                lists.add(person);</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 设置数据适配器</span></span><br><span class="line">            lv.setAdapter(<span class="keyword">new</span> MyListAdapter);</span><br><span class="line">        }</span><br><span class="line">        db.close();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">MyListAdapter</span> <span class="keyword">extends</span> <span class="title">BaseAdapter</span></span></span><br><span class="line"><span class="class">    </span>{</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 项目数量</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>{</span><br><span class="line">            <span class="keyword">return</span> lists.size(); <span class="comment">// 返回列表（数据库）中的数据数量</span></span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 对应的对象</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Object <span class="title">getItem</span><span class="params">(<span class="keyword">int</span> position)</span></span></span><br><span class="line"><span class="function">        </span>{</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 对应的ID</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getItemID</span><span class="params">(<span class="keyword">int</span> position)</span></span></span><br><span class="line"><span class="function">        </span>{</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取一个view，用来显示每个item的数据</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> View <span class="title">getView</span><span class="params">(<span class="keyword">int</span> position, View convertView, ViewGroup parent)</span></span></span><br><span class="line"><span class="function">        </span>{</span><br><span class="line"></span><br><span class="line">            TextView view;</span><br><span class="line">            <span class="keyword">if</span> (convertView == <span class="keyword">null</span>)</span><br><span class="line">            {</span><br><span class="line">                <span class="comment">// 缓存对象为空，创建新的 view 对象</span></span><br><span class="line">                view = View.inflate(getApplicationContext, R.id.item, <span class="keyword">null</span>);</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            {</span><br><span class="line">                <span class="comment">// 使用历史缓存对象</span></span><br><span class="line">                view = (TextView) convertView;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            Person person = lists.get(position); <span class="comment">// 获取从数据库中取出的列表对象</span></span><br><span class="line">            <span class="comment">// findViewById() 从当前 activity 中获取 ID，无法直接取到 layout/item 里面的 ID，</span></span><br><span class="line">            <span class="comment">// 所以需要先用 inflate() 获取到 R.id.item 的 view，再通过 view 获取 ID</span></span><br><span class="line">            TextView tv_name = (TextView) view.findViewById(R.id.tv_name);</span><br><span class="line">            TextView tv_phone = (TextView) view.findViewById(R.id.tv_phone);</span><br><span class="line">            tv_name.setText(person.getName()); <span class="comment">// 设置名字</span></span><br><span class="line">            tv_phone.setText(person.getPhone()); <span class="comment">// 设置电话</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> view;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h1 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h1><h2 id="网页源码查看器"><a href="#网页源码查看器" class="headerlink" title="网页源码查看器"></a>网页源码查看器</h2><h3 id="联网权限"><a href="#联网权限" class="headerlink" title="联网权限"></a>联网权限</h3><p><code>android.permission.INTERNET</code></p>
<h3 id="HttpUrlConnection-类"><a href="#HttpUrlConnection-类" class="headerlink" title="HttpUrlConnection 类"></a>HttpUrlConnection 类</h3><p>用于发送或者接受数据，取网页源代码</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置网址</span></span><br><span class="line">String path = <span class="string">"http://www.baidu.com"</span>;</span><br><span class="line">URL url = <span class="keyword">new</span> URL(path);</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span></span><br><span class="line">{</span><br><span class="line">    <span class="comment">// HttpURLConnection对象，用于发送或者接受数据</span></span><br><span class="line">    HttpURLConnection urlConnection = (HttpURLConnection) url.openConnection();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置发送 get 请求（默认），注意要求【大写】</span></span><br><span class="line">    urlConnection.setRequestMethod(<span class="string">"GET"</span>);</span><br><span class="line">    <span class="comment">// 设置请求超时</span></span><br><span class="line">    urlConnection.setConnectTimeout(<span class="number">5000</span>); <span class="comment">// 5 秒</span></span><br><span class="line">    <span class="comment">// 获取服务器返回的状态码，例如 404</span></span><br><span class="line">    <span class="keyword">int</span> code = urlConnection.getResponseCode();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (code == <span class="number">200</span>)</span><br><span class="line">    {</span><br><span class="line">        <span class="comment">// 获取服务器返回的数据流</span></span><br><span class="line">        InputStream in = urlConnection.getInputStream();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 数据流转换成文本，最终的网页源代码</span></span><br><span class="line">        String content = StreamTools.readStream(in);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 流转文本的方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">StreamTools</span></span></span><br><span class="line"><span class="class"></span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">readStream</span><span class="params">(InputStream in)</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">int</span> len = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>]; <span class="comment">// 1 kb</span></span><br><span class="line">        <span class="comment">// 定义一个内存输出流</span></span><br><span class="line">        ByteArrayOutputStream baos = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">        <span class="keyword">while</span> ( ( len = in.read(buffer) ) != -<span class="number">1</span> )</span><br><span class="line">        {</span><br><span class="line">            baos.write(buffer, <span class="number">0</span>, len);</span><br><span class="line">        }</span><br><span class="line">        in.close();</span><br><span class="line">        String content = <span class="keyword">new</span> String(baos.toByteArray());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> content;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="ScrollView"><a href="#ScrollView" class="headerlink" title="ScrollView"></a>ScrollView</h3><p><strong>scrollview 只能有一个子控件</strong></p>
<p>布局</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ScrollView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">"@+id/tv"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">ScrollView</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>如果要多个子控件，可以将这些子控件包裹在 <code>&lt;LinearLayout&gt;</code> 里面，<code>orientation="vertical"</code></p>
<h3 id="消息机制的写法"><a href="#消息机制的写法" class="headerlink" title="消息机制的写法"></a>消息机制的写法</h3><h4 id="主线程（UI线程）"><a href="#主线程（UI线程）" class="headerlink" title="主线程（UI线程）"></a>主线程（UI线程）</h4><p><strong>ANR</strong> Application not response 应用无响应</p>
<p>耗时的操作放到子线程当中</p>
<p>Android 4.0 之后，谷歌强制要求连接网络不能再主线程进行访问</p>
<p>只有主线程（UI线程）才可以更新UI</p>
<h3 id="Handler-使用步骤"><a href="#Handler-使用步骤" class="headerlink" title="Handler 使用步骤"></a>Handler 使用步骤</h3><p>1、在主线程定义一个 Handler</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Handler handler = <span class="keyword">new</span> Handler();</span><br></pre></td></tr></tbody></table></figure>

<p>2、使用 Handler，重写里面的 handlerMessage 方法</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(android.os.Message msg)</span> </span>{ }</span><br></pre></td></tr></tbody></table></figure>

<p>3、用 Handler 去子线程发消息</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">handler.sendMessage(msg);</span><br></pre></td></tr></tbody></table></figure>

<p>4、handleMessage 方法就会执行，更新UI</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span></span></span><br><span class="line"><span class="class"></span>{</span><br><span class="line"></span><br><span class="line">    TextView tv = (TextView) findVIewById(R.id.tv);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在主线程中定义一个Handler，类后跟{}表示重写类的方法</span></span><br><span class="line">    <span class="keyword">private</span> Handler handler = <span class="keyword">new</span> Handler()</span><br><span class="line">    {</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 收到消息。这个方法是在主线程里执行的，可以更新 UI</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(android.os.Message msg)</span></span></span><br><span class="line"><span class="function">        </span>{</span><br><span class="line">            String content = (String) msg.obj;</span><br><span class="line">            tv.setText(content);</span><br><span class="line">        };</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">click</span><span class="params">(View v)</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="comment">// 创建一个子线程</span></span><br><span class="line">        <span class="keyword">new</span> Thread()</span><br><span class="line">        {</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span></span><br><span class="line"><span class="function">            </span>{</span><br><span class="line">                <span class="keyword">try</span></span><br><span class="line">                {</span><br><span class="line">                    <span class="comment">// 设置网址</span></span><br><span class="line">                    String path = <span class="string">"http://www.baidu.com"</span>;</span><br><span class="line">                    URL url = <span class="keyword">new</span> URL(path);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 发送、接收数据的对象</span></span><br><span class="line">                    HttpURLConnection urlConnection = (HttpURLConnection) url.openConnection();</span><br><span class="line">                    <span class="comment">// 设置GET请求</span></span><br><span class="line">                    urlConnection.setRequestMethod(<span class="string">"GET"</span>);</span><br><span class="line">                    <span class="comment">// 设置超时时间</span></span><br><span class="line">                    urlConnection.setConnectTimeout(<span class="number">5000</span>);</span><br><span class="line">                    <span class="comment">// 获取服务器返回的状态码</span></span><br><span class="line">                    <span class="keyword">int</span> code = urlConnection.getResponseCode()；</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (code == <span class="number">200</span>)</span><br><span class="line">                    {</span><br><span class="line">                        <span class="comment">// 输入流</span></span><br><span class="line">                        InputStream in = conn.getInputStream();</span><br><span class="line">                        <span class="comment">// 流转字符串</span></span><br><span class="line">                        String content = StreamTools.readStream(in);</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// 创建  Message 对象</span></span><br><span class="line">                        Message msg = <span class="keyword">new</span> Message();</span><br><span class="line">                        msg.obj = content;</span><br><span class="line">                        <span class="comment">// Handler 发送msg(包含数据)于更新UI</span></span><br><span class="line">                        handler.sendMessage(msg);</span><br><span class="line">                    } <span class="comment">//if</span></span><br><span class="line"></span><br><span class="line">                } <span class="comment">//try</span></span><br><span class="line"></span><br><span class="line">            }</span><br><span class="line">        } .start(); <span class="comment">//thread run</span></span><br><span class="line"></span><br><span class="line">    } <span class="comment">//function</span></span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="消息机制的原理"><a href="#消息机制的原理" class="headerlink" title="消息机制的原理"></a>消息机制的原理</h3><p>消息队列，有一个Looper不断读取队列，然后 handlerMessage(msg)</p>
<h3 id="Handler-完善：what"><a href="#Handler-完善：what" class="headerlink" title="Handler 完善：what"></a>Handler 完善：what</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">int</span> REQUESTSUCESS = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">int</span> REQUESTNOTFOUND = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">int</span> REQUESTEXCEPTION = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(android.os.Message msg)</span> </span>{</span><br><span class="line">  <span class="keyword">switch</span> (msg.what) {</span><br><span class="line">    <span class="keyword">case</span> REQUESTSUCESS : <span class="comment">// 代表请求成功</span></span><br><span class="line">      String content = (String) msg.obj;</span><br><span class="line">      tv.setText(content);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> REQUESTNOTFOUND : <span class="comment">// 代表请求失败</span></span><br><span class="line">      Toast.makeText(getApplicationContext(), <span class="string">"请求资源不存在"</span>, <span class="number">0</span>).show();</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> REQUESTEXCEPTION : <span class="comment">// 代表产生异常</span></span><br><span class="line">      Toast.makeText(getApplicationContext(), <span class="string">"服务器忙，请稍后再访问"</span>, <span class="number">0</span>).show();</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>{</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="keyword">if</span> (code == <span class="number">200</span>)</span><br><span class="line">  {</span><br><span class="line">    Mseeage msg = <span class="keyword">new</span> Message();</span><br><span class="line">    msg.what = REQUESTSUCESS; <span class="comment">// 代表哪条消息</span></span><br><span class="line">    handler.sendMessage(msg);</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  {</span><br><span class="line">    Mseeage msg = <span class="keyword">new</span> Message();</span><br><span class="line">    msg.what = REQUESTNOTFOUND; <span class="comment">// 代表哪条消息</span></span><br><span class="line">    handler.sendMessage(msg);</span><br><span class="line">  }</span><br><span class="line">} <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">  Mseeage msg = <span class="keyword">new</span> Message();</span><br><span class="line">  msg.what = REQUESTEXCEPTION; <span class="comment">// 代表哪条消息</span></span><br><span class="line">  handler.sendMessage(msg);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>程序运行错误，尽量提示用户：服务器忙，请稍后访问</p>
<p>而不是：程序运行错误，让用户担忧</p>
</blockquote>
<h2 id="图片查看器"><a href="#图片查看器" class="headerlink" title="图片查看器"></a>图片查看器</h2><h3 id="ImageView-显示网络图片"><a href="#ImageView-显示网络图片" class="headerlink" title="ImageView 显示网络图片"></a>ImageView 显示网络图片</h3><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">manifest</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.INTERNET"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">EditView</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Button</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">"@+id/iv"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span> /&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Handler handler = <span class="keyword">new</span> Handler()</span><br><span class="line">{</span><br><span class="line">    <span class="comment">//收到消息，设置图片</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(android.os.Message msg)</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        bitmap bitmap = (Bitmap) msg.obj;</span><br><span class="line">        iv.setImageBitmap(bitmap);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">click</span><span class="params">(View v)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">new</span> Thread()</span><br><span class="line">    {</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>{</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            {</span><br><span class="line">                <span class="comment">// 使用路径创建 URL 对象</span></span><br><span class="line">                String path = ev.getText().toString().trim();</span><br><span class="line">                URL url = <span class="keyword">new</span> URL(path);</span><br><span class="line">                <span class="comment">// 获取 HttpURLConnection（用户发送或者接收数据）</span></span><br><span class="line">                HttpURLConnection conn = (HttpURLConnection) url.openConnection();</span><br><span class="line">                <span class="comment">// 设置请求的方式、超时时间</span></span><br><span class="line">                conn.setRequestMethond(<span class="string">"GET"</span>);</span><br><span class="line">                conn.setConnectTimeout(<span class="number">5000</span>);</span><br><span class="line">                <span class="keyword">int</span> code = conn.getResponseCode();</span><br><span class="line">                <span class="keyword">if</span> (code == <span class="number">200</span>)</span><br><span class="line">                {</span><br><span class="line">                    <span class="comment">// 获取图片的数据（流 的形式）</span></span><br><span class="line">                    InputStream in = conn.getInputStream();</span><br><span class="line">                    <span class="comment">// 通过位图工厂 获取 bitmap</span></span><br><span class="line">                    Bitmap bitmap = BitmapFactory.decodeStream(in);</span><br><span class="line">                    <span class="comment">// 发送消息用于更新UI</span></span><br><span class="line">                    Message msg = Message.obtain(); <span class="comment">// 使用 Message 的静态方法 可以减少对象的创建</span></span><br><span class="line">                    msg.obj = bitmap;</span><br><span class="line">                    handler.sendMessage(msg);</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                {</span><br><span class="line">                    <span class="comment">// ...</span></span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">catch</span> (Exception e)</span><br><span class="line">            {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    } .start();</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>使用 Message 的静态方法 可以减少对象的创建</strong></p>
<p><code>Message msg = Message.obtain();</code></p>
<p>效果等同于：<code>Message msg = new Message()</code> 但是效率快</p>
<h3 id="图片缓存到本地"><a href="#图片缓存到本地" class="headerlink" title="图片缓存到本地"></a>图片缓存到本地</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (code == <span class="number">2</span>) {</span><br><span class="line">    <span class="comment">//图片的数据流</span></span><br><span class="line">    InputStream in = conn.getInputStream();</span><br><span class="line"></span><br><span class="line">    File file = <span class="keyword">new</span> File(getCacheDir(), <span class="string">"test.png"</span>); <span class="comment">// 谷歌提供的缓存目录</span></span><br><span class="line">    FileOutputStream fos = <span class="keyword">new</span> FileOutputStream(file);</span><br><span class="line">    <span class="keyword">int</span> len = -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>]; <span class="comment">// 1kb</span></span><br><span class="line">    <span class="keyword">while</span> ((len = in.read(buffer)) != -<span class="number">1</span>) {</span><br><span class="line">      	fos.write(buffer, <span class="number">0</span>, len);</span><br><span class="line">    }</span><br><span class="line">    fos.close();</span><br><span class="line">    in.close();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="使用缓存图片"><a href="#使用缓存图片" class="headerlink" title="使用缓存图片"></a>使用缓存图片</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Thread()</span><br><span class="line">{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        {</span><br><span class="line">            <span class="comment">// 谷歌提供的缓存目录：/data/data/包名/cache/ + test.png</span></span><br><span class="line">            File file = <span class="keyword">new</span> File(getCacheDir(), <span class="string">"test.png"</span>);</span><br><span class="line">            <span class="keyword">if</span> (file.exists() &amp;&amp; file.length() &gt; <span class="number">0</span>)</span><br><span class="line">            {</span><br><span class="line">                <span class="comment">// 使用缓存的图片</span></span><br><span class="line">                Bitmap cacheBitmap = BitmapFactory.decodeFile(file.getAbsolutePath());</span><br><span class="line">                <span class="comment">// 把 cacheBitmap 显示到 ImageView 上</span></span><br><span class="line">                Message msg = Message.obtain();</span><br><span class="line">                msg.obj = cacheBitmap;</span><br><span class="line">                handler.sendMessage(msg);</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            {</span><br><span class="line">                <span class="comment">// 第一次访问，联网获取数据</span></span><br><span class="line">                String path = ev.getText().toString().trim();</span><br><span class="line">                URL url = <span class="keyword">new</span> URL(path);</span><br><span class="line">                HttpURLConnection conn = (HttpURLConnection) url.openConnection();</span><br><span class="line">                conn.setRequestMethond(<span class="string">"GET"</span>);</span><br><span class="line">                conn.setConnectTimeout(<span class="number">5000</span>);</span><br><span class="line">                <span class="keyword">int</span> code = conn.getResponseCode();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (code == <span class="number">200</span>)</span><br><span class="line">                {</span><br><span class="line">                    InputStream in = conn.getInputStream();</span><br><span class="line"></span><br><span class="line">                    FileOutputStream fos = <span class="keyword">new</span> FileOutputStream(file);</span><br><span class="line">                    <span class="keyword">int</span> len = -<span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>]; <span class="comment">// 1kb</span></span><br><span class="line">                    <span class="keyword">while</span> ((len = in.read(buffer)) != -<span class="number">1</span>)</span><br><span class="line">                    {</span><br><span class="line">                        fos.write(buffer, <span class="number">0</span>, len);</span><br><span class="line">                    }</span><br><span class="line">                    fos.close();</span><br><span class="line">                    in.close();</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="对图片进行加密"><a href="#对图片进行加密" class="headerlink" title="对图片进行加密"></a>对图片进行加密</h3><p>Base64加密： <code>Base64.encodeToString(byte[] input, int flags);</code></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">File file = <span class="keyword">new</span> File(getCacheDir(), Base64.encodeToString(path.getBytes[], Base64.DEFAULT));</span><br></pre></td></tr></tbody></table></figure>

<p>上述代码针对文件路径进行加密，文件名为URL路径加密后的密文</p>
<h3 id="cache-和-filedir-区别"><a href="#cache-和-filedir-区别" class="headerlink" title="cache 和 filedir 区别"></a>cache 和 filedir 区别</h3><h4 id="写出文件示例"><a href="#写出文件示例" class="headerlink" title="写出文件示例"></a>写出文件示例</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> {</span><br><span class="line">  	<span class="comment">// firledir：/data/data/包名/files/info.txt</span></span><br><span class="line">    FileOutputStream fos = openFileOutput(<span class="string">"info.txt"</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  	<span class="comment">// cache：/data/data/包名/cache/info.txt</span></span><br><span class="line">  	File file = <span class="keyword">new</span> File(getCacheDir(), <span class="string">"info.txt"</span>);</span><br><span class="line">  	FileOutputStream fos = <span class="keyword">new</span> FileOutputStream(file);</span><br><span class="line"></span><br><span class="line">    fos.write(<span class="string">"haha"</span>.getByte());</span><br><span class="line">    fos.close();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="Thread-API"><a href="#Thread-API" class="headerlink" title="Thread API"></a>Thread API</h2><h3 id="runOnUiThread-写法"><a href="#runOnUiThread-写法" class="headerlink" title="runOnUiThread 写法"></a>runOnUiThread 写法</h3><p><code>runOnUiThread(Runable action)</code></p>
<p>不管在什么位置，里面运行的语句都运行在 UI 线程上。</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Thread() { <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    runOnUiThread(<span class="keyword">new</span> Runnable() {</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">			tv.setText(<span class="string">"HHH"</span>);</span><br><span class="line">        }</span><br><span class="line">    });</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">} }</span><br></pre></td></tr></tbody></table></figure>

<h3 id="Handler-API"><a href="#Handler-API" class="headerlink" title="Handler API"></a>Handler API</h3><p>延迟线程 <code>new Handler().postDelayed(Runnable r, int delayMillis);</code>  效果等同于 <code>Sleep()</code></p>
<p>这个方法执行在 UI 线程里，可更新 UI</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">f</span><span class="params">()</span> </span>{</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// 2秒后执行 run 方法</span></span><br><span class="line">    <span class="keyword">new</span> Handler().postDelayed( <span class="keyword">new</span> Runnable(){</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">			<span class="comment">// ...code...</span></span><br><span class="line">        }</span><br><span class="line">    }, <span class="number">2000</span>);</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="定时器-Timer"><a href="#定时器-Timer" class="headerlink" title="定时器 Timer"></a>定时器 Timer</h3><p><code>Timer.schedule(TimerTask task, long delay);</code> 延迟后执行</p>
<p><code>Timer.schedule(TimerTask task, long delay, long period);</code> 指定的延迟后进行重复的固定延迟执行</p>
<p>还有其它重载的 schedule 函数</p>
<p>相当于子线程，<strong>不能用来更新 UI</strong>。可以用 <code>runOnUiThread</code> 来执行 UI 操作</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">click</span><span class="params">()</span> </span>{</span><br><span class="line">  </span><br><span class="line">    Timer timer = <span class="keyword">new</span> Timer();</span><br><span class="line">    TimerTask task = <span class="keyword">new</span> TimerTask() {</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="comment">// ... code...</span></span><br><span class="line">          	<span class="comment">// 这相当于子线程，不能更新 UI</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    timer.schedule(task, <span class="number">5000</span>);</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><code>Timer.cancel();</code> <code>Task.cancel();</code>  销毁一个执行</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 当 Activity 销毁时 会执行这个方法</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>{</span><br><span class="line">    timer.cancel();</span><br><span class="line">    task.cancel();</span><br><span class="line">    <span class="keyword">super</span>.onDestroy();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="网络基础"><a href="#网络基础" class="headerlink" title="网络基础"></a>网络基础</h2><h3 id="网络图片-SmartImageView"><a href="#网络图片-SmartImageView" class="headerlink" title="网络图片 SmartImageView"></a>网络图片 SmartImageView</h3><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">com.loopj.android.image.SmartImageView</span></span></span><br><span class="line"><span class="tag">	<span class="attr">android:id</span>=<span class="string">"@+id/siv"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">...</span> /&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">imageUrl = <span class="string">"..."</span>;</span><br><span class="line">view = View.inflate(...);</span><br><span class="line">SmartImageView svi = (SmartImageView) view.findViewById(R.id.siv);</span><br><span class="line">siv.setImageUrl(imageUrl); <span class="comment">// 设置加载网络图片</span></span><br><span class="line">siv.setImageUrl(String imageUrl, Integer fallbackResource); <span class="comment">// 参数2为加载失败的内容 R.drawable.xxx</span></span><br><span class="line">siv.setImageView(String imageUrl, Integer OnCompleteListener completeListener); <span class="comment">// 结束后回调事件</span></span><br><span class="line">siv.setImageView(String imageUrl, Integer fallbackResource, OnCompleteListener completeListener);</span><br><span class="line">siv.setImageView(String imageUrl, Integer fallbackResource, Integer loadingResource, OnCompleteListener completeListener);</span><br></pre></td></tr></tbody></table></figure>

<h4 id="GitHub-开源项目"><a href="#GitHub-开源项目" class="headerlink" title="GitHub 开源项目"></a>GitHub 开源项目</h4><p>网址：github.com</p>
<p>导入开源项目：下载 zip 后，把解压出来后的 com 文件夹（源码包）复制到项目的 src 中</p>
<p>源码：在 com 文件夹内，.java 后缀名的</p>
<p>布局：用的时候，需要用开源项目的完整包名</p>
<h3 id="HttpURLConnextion"><a href="#HttpURLConnextion" class="headerlink" title="HttpURLConnextion"></a>HttpURLConnextion</h3><p>联网的基类。</p>
<p>如果连接要求不是很高，只是用来发发数据的话，可以用下面的开源项目。</p>
<h4 id="封装-toast-方法"><a href="#封装-toast-方法" class="headerlink" title="封装 toast 方法"></a>封装 toast 方法</h4><p>通用方法，获取数据后立即弹出提示</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showToast</span><span class="params">(<span class="keyword">final</span> String content)</span> </span>{</span><br><span class="line">  runOnUiThread(<span class="function">enw <span class="title">Runnable</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">      Toast.makeText(getApplicationContext(), content, <span class="number">1</span>).show();</span><br><span class="line">    }  </span><br><span class="line">  })</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="GET-和-POST-的区别"><a href="#GET-和-POST-的区别" class="headerlink" title="GET 和 POST 的区别"></a>GET 和 POST 的区别</h4><ol>
<li>URL路径不同：GET 拼接 网址 和 数据</li>
<li>POST 通过请求体（流）的形式把数据发送给服务器</li>
<li>POST 比 GET 多了两个头信息：content-length 和 content-type</li>
</ol>
<h4 id="使用-POST"><a href="#使用-POST" class="headerlink" title="使用 POST"></a>使用 POST</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">String path = <span class="string">"http://xxx"</span>;</span><br><span class="line">String data = <span class="string">"name="</span> + name + <span class="string">"&amp;pass="</span> + pass;</span><br><span class="line">URL url = <span class="keyword">new</span> URL(path);</span><br><span class="line">HttpURLConnextion conn = (HttpURLConnection) url.openConnection();</span><br><span class="line">conn.setRequestMethond(<span class="string">"POST"</span>);</span><br><span class="line">conn.setConnextTimeout(<span class="number">5000</span>);</span><br><span class="line"><span class="comment">//比GET方式多的两个头信息</span></span><br><span class="line">conn.setRequestProperty(<span class="string">"Content-Type"</span>, <span class="string">"application/x-www-form-url"</span>);</span><br><span class="line">conn.setRequestProperty(<span class="string">"Content-Length"</span>, data.length()+<span class="string">""</span>); <span class="comment">// 参数二要求字符串，故 数字+空字符串</span></span><br><span class="line"><span class="comment">//以流的形式提交数据</span></span><br><span class="line">con.setDoOutput(<span class="keyword">true</span>); <span class="comment">// 设置一个标记，允许输出</span></span><br><span class="line">conn.getOutputStream().write(data.getBytes());</span><br><span class="line"><span class="comment">//判断结果</span></span><br><span class="line"><span class="keyword">int</span> code = conn.getReponseCode();</span><br><span class="line"><span class="keyword">if</span> (code  == <span class="number">200</span>) {</span><br><span class="line">  <span class="comment">// 获取返回的数据流 -&gt; 转化成字符串 -&gt; 操作字符串数据</span></span><br><span class="line">  InputStream inputStream = conn.getInputStream();</span><br><span class="line">  String content = StreamTools.readStream(inputStream);</span><br><span class="line">  showToast(content);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="乱码问题"><a href="#乱码问题" class="headerlink" title="乱码问题"></a>乱码问题</h4><p>Android 编码：UTF-8</p>
<p>服务器编码：本地服务器的编码，一般为 iso-859-1 （类似 GBK）</p>
<h5 id="改变服务器编码（Java）："><a href="#改变服务器编码（Java）：" class="headerlink" title="改变服务器编码（Java）："></a>改变服务器编码（Java）：</h5><p>返回中文乱码 <code>System.out.prrintln("ans : " + new String(ans.getBytes("utf-8")));</code> </p>
<p>发送中文乱码：先以 iso-8859-1 编码，再以 UTF-8 解码</p>
<pre><code>`System.out.prrintln("ans : " + new String(ans.getBytes("iso-8859-1"), "utf-8"));`</code></pre><h5 id="改变-Android-编码"><a href="#改变-Android-编码" class="headerlink" title="改变 Android 编码"></a>改变 Android 编码</h5><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StreamTools</span></span></span><br><span class="line"><span class="class"></span>{</span><br><span class="line">    <span class="comment">//把输入流转换成字符串</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">readStream</span><span class="params">(InputStream in)</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="comment">//定义一个内存输出流</span></span><br><span class="line">        ByteArrayOutputStream baos = <span class="keyword">new</span> ByteArrayOutStream();</span><br><span class="line">        <span class="keyword">int</span> len = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>]; <span class="comment">// 1 kb</span></span><br><span class="line">        <span class="keyword">while</span> ( (len = in.read(buffer)) != -<span class="number">1</span> )</span><br><span class="line">        {</span><br><span class="line">            baos.write(buffer, <span class="number">0</span>, len);</span><br><span class="line">        }</span><br><span class="line">        in.close();</span><br><span class="line">        String content = <span class="keyword">new</span> String(baos.toByteArray(), <span class="string">"gbk"</span>); <span class="comment">// 指定 GBK 编码</span></span><br><span class="line">        <span class="keyword">return</span> content;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h5 id="URLEncode-类"><a href="#URLEncode-类" class="headerlink" title="URLEncode 类"></a><strong>URLEncode 类</strong></h5><p>encode方法： <code>URLEncode.encode(String s, String charseName);</code></p>
<p><code>path = path + "?username=" + URLEncode(name, "utf-8") + "&amp;password=" + URLEncode(pass, "utf-8");</code></p>
<h3 id="HttpClient-方式提交数据"><a href="#HttpClient-方式提交数据" class="headerlink" title="HttpClient 方式提交数据"></a>HttpClient 方式提交数据</h3><p>HttpClient 是一个接口，而不是类。（没有人用这个，了解）</p>
<h4 id="GET"><a href="#GET" class="headerlink" title="GET"></a>GET</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Thread()</span><br><span class="line">{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        {</span><br><span class="line">            String path = <span class="string">"http://xxx?id="</span> + URLEncoder.encode(id);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 获取 httpclient 实例</span></span><br><span class="line">            DefaultHttpClient client = <span class="keyword">new</span> DefaultHttpClient();</span><br><span class="line">            <span class="comment">// 准备 get 请求，定义一个 httpget 实现</span></span><br><span class="line">            HttpGet get = <span class="keyword">new</span> HttpGet(path);</span><br><span class="line">            <span class="comment">// 执行一个 get 请求</span></span><br><span class="line">            HttpResponse response = client.execute(get);</span><br><span class="line">            <span class="comment">// 获取服务器返回的状态码</span></span><br><span class="line">            <span class="keyword">int</span> code = response.getStatusLine().getStatusCode();</span><br><span class="line">            <span class="keyword">if</span> (code == <span class="number">200</span>)</span><br><span class="line">            {</span><br><span class="line">                <span class="comment">// 获取服务器返回的数据，以流的形式</span></span><br><span class="line">                InputStream inputstream = response.getEntity().getContent();</span><br><span class="line">                <span class="comment">// 把流转换成字符串</span></span><br><span class="line">                String content = StreamTools.readStream(inputStream);</span><br><span class="line">                showToast(content);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">} .start();</span><br></pre></td></tr></tbody></table></figure>

<h4 id="POST"><a href="#POST" class="headerlink" title="POST"></a>POST</h4><p>Entity、BasicNameValuePair 等也都是接口</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">String name = <span class="string">"..."</span>, pwd = <span class="string">"..."</span>;</span><br><span class="line">String path = <span class="string">"..."</span>;</span><br><span class="line">DefaultHttpClient client = <span class="keyword">new</span> DefaulthttpClient();</span><br><span class="line">HttpPost post = <span class="keyword">new</span> HttpPost(path);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 准备 parameters 集合</span></span><br><span class="line">List&lt;NameValuePair&gt; lists = <span class="keyword">new</span> ArrayList&lt;NameValuePair&gt;();</span><br><span class="line"><span class="comment">// 准备 NameValuePair，键值对数据</span></span><br><span class="line">BasicNameValuePair nameValuePair = <span class="keyword">new</span> BasicNameValuePair(<span class="string">"username"</span>, name);</span><br><span class="line">BasicNameValuePair pwdValuePair = <span class="keyword">new</span> BasicNameValuePair(<span class="string">"password"</span>, pwd);</span><br><span class="line"><span class="comment">// 把 name 和 pwd 加入到集合中</span></span><br><span class="line">lists.add(nameValuePair);</span><br><span class="line">lists.add(pwdValuePair);</span><br><span class="line"><span class="comment">// 准备 entity</span></span><br><span class="line">UrlEncodeFormEntity entity = <span class="keyword">new</span> UrlEncodeFormEntity(parameters);</span><br><span class="line"><span class="comment">// 准备 post，以实体 Entity 的形式</span></span><br><span class="line">post.setEntity(entity);</span><br><span class="line"></span><br><span class="line">HttpResponse response = client.execute(post);</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> code = response.getStatusLine().getStatusCode();</span><br><span class="line"><span class="keyword">if</span> (code == <span class="number">200</span>) {</span><br><span class="line">	InputStream inputStream = response.getEntity().getContent();</span><br><span class="line">	String content = StreamTools.readStream(inputStream);</span><br><span class="line">	showToast(content);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="asyncHttpClient-开源项目"><a href="#asyncHttpClient-开源项目" class="headerlink" title="asyncHttpClient 开源项目"></a>asyncHttpClient 开源项目</h3><p>GitHub 上下载，把 com 包复制到 src 中。</p>
<h4 id="GET-1"><a href="#GET-1" class="headerlink" title="GET"></a>GET</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">String path = <span class="string">"..."</span>;</span><br><span class="line">AsyncHttpClient client = <span class="keyword">new</span> AsyncHttpClient();</span><br><span class="line"></span><br><span class="line">client.get(path, <span class="keyword">new</span> AcynchttpResponseHandler()</span><br><span class="line">{</span><br><span class="line">    <span class="comment">// 请求成功的回调方法0</span></span><br><span class="line">    <span class="comment">/*@Override</span></span><br><span class="line"><span class="comment">    public void onSuccess(String response) {</span></span><br><span class="line"><span class="comment">        showToast(response);</span></span><br><span class="line"><span class="comment">    }*/</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 请求成功的回调方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">onSuccess</span><span class="params">(<span class="keyword">int</span> statusCode, Header[] headers, <span class="keyword">byte</span>[] responseBody)</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        showToast(<span class="keyword">new</span> String(responseBody, <span class="string">"gbk"</span>));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 请求失败的回调方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(<span class="keyword">int</span> statusCode, Header[] headers, <span class="keyword">byte</span>[] responseBody, Throwable error)</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="comment">// ...code...</span></span><br><span class="line">    }</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>

<h4 id="POST-1"><a href="#POST-1" class="headerlink" title="POST"></a>POST</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">String path = <span class="string">"..."</span>;</span><br><span class="line">AsyncHttpClient client = <span class="keyword">new</span> AsyncHttpClient();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 准备请求体的内容</span></span><br><span class="line">RequestParams params = <span class="keyword">new</span> RequestParams();</span><br><span class="line">params.put(<span class="string">"username"</span>, <span class="string">"admin"</span>);</span><br><span class="line">params.put(<span class="string">"password"</span>, <span class="string">"123"</span>);</span><br><span class="line">params.put(<span class="string">"email"</span>, <span class="string">"my@email.com"</span>);</span><br><span class="line">params.put(<span class="string">"profile_picture"</span>, <span class="keyword">new</span> FIle(<span class="string">"pic.jpg"</span>)); <span class="comment">// 上传文件</span></span><br><span class="line">params.put(<span class="string">"profile_picture2"</span>, someInputStream); <span class="comment">// 上传输入流</span></span><br><span class="line">params.put(<span class="string">"profile_picture"</span>, <span class="keyword">new</span> ByteArrayInputStream(someBytes)); <span class="comment">// 上传字节集</span></span><br><span class="line"></span><br><span class="line">client.post(path, params, <span class="keyword">new</span> AcynchttpResponseHandler() {</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 请求成功的回调方法</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">onSuccess</span><span class="params">(<span class="keyword">int</span> statusCode, Header[] headers, <span class="keyword">byte</span>[] responseBody)</span> </span>{</span><br><span class="line">		showToast(<span class="keyword">new</span> String(responseBody, <span class="string">"gbk"</span>));</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 请求失败的回调方法</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(<span class="keyword">int</span> statusCode, Header[] headers, <span class="keyword">byte</span>[] responseBody, Throwable error)</span></span>{</span><br><span class="line">		<span class="comment">// ...code...</span></span><br><span class="line">	}</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>

<h2 id="多线程下载"><a href="#多线程下载" class="headerlink" title="多线程下载"></a>多线程下载</h2><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>分段下载</p>
<p>服务器没有限速的话，线程并不是越多越好</p>
<p>获取一部分文件，返回的状态码是<strong>206</strong>，而不是<strong>200</strong>。</p>
<h3 id="RandomAccessFile-类"><a href="#RandomAccessFile-类" class="headerlink" title="RandomAccessFile 类"></a>RandomAccessFile 类</h3><p>随机读取和写入文件，使用见下方代码</p>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><p>test.java</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.*;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span></span><br><span class="line"><span class="class"></span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String path = <span class="string">"http://download.dcloud.net.cn/HBuilder.9.0.1.windows.zip"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> threadCount = <span class="number">3</span>; <span class="comment">// 线程数</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        {</span><br><span class="line">            URL url = <span class="keyword">new</span> URL(path);</span><br><span class="line">            HttpURLConnection conn = (HttpURLConnection) url.openConnection();</span><br><span class="line">            conn.setRequestMethod(<span class="string">"GET"</span>);</span><br><span class="line">            conn.setConnectTimeout(<span class="number">5000</span>);</span><br><span class="line">            <span class="keyword">int</span> code = conn.getResponseCode();</span><br><span class="line">            <span class="keyword">if</span> (code == <span class="number">200</span>)</span><br><span class="line">            {</span><br><span class="line">                <span class="comment">// 获取服务器文件的大小(B)</span></span><br><span class="line">                <span class="keyword">int</span> length = conn.getContentLength();</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 创建一个和下载文件一样大的文件，提前申请空间</span></span><br><span class="line">                RandomAccessFile raf = <span class="keyword">new</span> RandomAccessFile(getFileName(path), <span class="string">"rw"</span>);</span><br><span class="line">                raf.setLength(length);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 算出每个线程下载的大小</span></span><br><span class="line">                <span class="keyword">int</span> blockSize = length / threadCount;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 计算每个线程开始位置和结束位置</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; threadCount; i++)</span><br><span class="line">                {</span><br><span class="line">                    <span class="keyword">int</span> startIndex = i * blockSize; <span class="comment">// 开始位置</span></span><br><span class="line">                    <span class="keyword">int</span> endIndex = (i + <span class="number">1</span>) * blockSize - <span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">if</span> (i == threadCount - <span class="number">1</span>) <span class="comment">// 最后一个线程</span></span><br><span class="line">                    {</span><br><span class="line">                        endIndex = length - <span class="number">1</span>;</span><br><span class="line">                    }</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 开启线程去下载</span></span><br><span class="line">                    DownLoadThread dlt = <span class="keyword">new</span> DownLoadThread(path, startIndex, endIndex, i);</span><br><span class="line">                    dlt.start();</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">catch</span> (Exception e)</span><br><span class="line">        {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getFileName</span><span class="params">(String path)</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">int</span> start = path.lastIndexOf(<span class="string">"/"</span>) + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> path.substring(start);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>DownLoadThread.java</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义下载文件的线程</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DownLoadThread</span> <span class="keyword">extends</span> <span class="title">Thread</span></span></span><br><span class="line"><span class="class"></span>{</span><br><span class="line">	<span class="keyword">private</span> String path;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> startIndex;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> endIndex;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> threadId;</span><br><span class="line"></span><br><span class="line">    DownLoadThread(String path, <span class="keyword">int</span> startIndex, <span class="keyword">int</span> endIndex, <span class="keyword">int</span> threadId)</span><br><span class="line">    {</span><br><span class="line">    	<span class="keyword">this</span>.path = path;</span><br><span class="line">        <span class="keyword">this</span>.startIndex = startIndex;</span><br><span class="line">        <span class="keyword">this</span>.endIndex = endIndex;</span><br><span class="line">        <span class="keyword">this</span>.threadId = threadId;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        {</span><br><span class="line">            URL url = <span class="keyword">new</span> URL(path);</span><br><span class="line">            HttpURLConnection conn = (HttpURLConnection) url.openConnection();</span><br><span class="line">            conn.setRequestMethod(<span class="string">"GET"</span>);</span><br><span class="line">            conn.setConnectTimeout(<span class="number">5000</span>);</span><br><span class="line">            <span class="comment">// 设置一个请求头Range，获取每个线程下载的开始位置和结束位置</span></span><br><span class="line">            conn.setRequestProperty(<span class="string">"Range"</span>, <span class="string">"bytes="</span> + startIndex + <span class="string">"-"</span> + endIndex);</span><br><span class="line">            <span class="keyword">int</span> code = conn.getResponseCode();</span><br><span class="line">            <span class="comment">// 状态码 206 表示请求部分资源成功（一部分文件）</span></span><br><span class="line">            <span class="keyword">if</span> (code == <span class="number">206</span>)</span><br><span class="line">            {</span><br><span class="line">                <span class="comment">// 创建随机读写文件对象</span></span><br><span class="line">                RandomAccessFile raf = <span class="keyword">new</span> RandomAccessFile(getFileName(path), <span class="string">"rw"</span>);</span><br><span class="line">                <span class="comment">// 每个线程从自己的位置开始写</span></span><br><span class="line">                raf.seek(startIndex);</span><br><span class="line"></span><br><span class="line">                InputStream in = conn.getInputStream();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">int</span> len = -<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">                <span class="keyword">while</span> ((len = in.read()) != -<span class="number">1</span>)</span><br><span class="line">                {</span><br><span class="line">                    raf.write(buffer, <span class="number">0</span>, len);</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                System.out.println(<span class="string">"下载完毕"</span>);</span><br><span class="line">                raf.close();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">catch</span> (Exception e)</span><br><span class="line">        {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取文件名</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getFileName</span><span class="params">(String path)</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">int</span> start = path.lastIndexOf(<span class="string">"/"</span>)+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> path.substring(start);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="断点续传"><a href="#断点续传" class="headerlink" title="断点续传"></a>断点续传</h3><p>下载过程中保存每个线程的下载位置到文件</p>
<p>保存的间隔越短（缓冲区越小）则越卡顿</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 正在运行的线程数</span></span><br><span class="line">runningThread = threadCount;</span><br></pre></td></tr></tbody></table></figure>

<p>下载类：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*...code...*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取上次断开的位置继续下载</span></span><br><span class="line">File file = <span class="keyword">new</span> File(threadId + <span class="string">".txt"</span>);</span><br><span class="line"><span class="keyword">if</span> (file.exists() &amp;&amp; file.length() &gt; <span class="number">0</span>)</span><br><span class="line">{</span><br><span class="line">    FileInputStream fis = <span class="keyword">new</span> FileInputStream(file);</span><br><span class="line">    BufferedReader bufr = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStream(fis));</span><br><span class="line">    String lastPositions = bufr.readLine(); <span class="comment">// 读出来的是上次下载的位置</span></span><br><span class="line">    <span class="keyword">int</span> lastPosition = Integer.parseInt(lastPositions);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 改变一下 startIndex 的位置</span></span><br><span class="line">    startIndex = lastPosition;</span><br><span class="line">    fis.close();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (code == <span class="number">206</span>)</span><br><span class="line">{</span><br><span class="line">    <span class="comment">// 创建随机读写文件对象</span></span><br><span class="line">    RandomAccessFile raf = <span class="keyword">new</span> RandomAccessFile(<span class="string">"file.exe"</span>, <span class="string">"rw"</span>);</span><br><span class="line">    <span class="comment">// 每个线程从自己的位置开始写</span></span><br><span class="line">    raf.seek(startIndex);</span><br><span class="line"></span><br><span class="line">    InputStream in = conn.getInputStream();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> len = -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span> * <span class="number">1024</span>]; <span class="comment">// 缓冲区每 1M 保存一次文件</span></span><br><span class="line">    <span class="keyword">int</span> total = <span class="number">0</span>; <span class="comment">// 当前线程已下载的大小</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> ((len = in.read) != -<span class="number">1</span>)</span><br><span class="line">    {</span><br><span class="line">        raf.write(buffer, <span class="number">0</span>, len);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 保存下载位置到文件</span></span><br><span class="line">        total += len;</span><br><span class="line">        <span class="keyword">int</span> currentThreadPosition = startIndex + total;</span><br><span class="line">        RandomAccessFile raff = <span class="keyword">new</span> RandomAccessFile(threadId + <span class="string">".txt"</span>, <span class="string">"rwd"</span>); <span class="comment">// rwd 同步写入到底层文件中</span></span><br><span class="line">        raff.write(String.valueOf(currentThreadPosition).getBytes());</span><br><span class="line">        raff.close();</span><br><span class="line">    }</span><br><span class="line">    raf.close();</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"下载完毕"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 下载完毕后判断并删除保存下载位置的文件</span></span><br><span class="line">    <span class="keyword">synchronized</span> (DownLoadThread.class) <span class="comment">// 加锁？</span></span><br><span class="line">    {</span><br><span class="line">        runningThread--;</span><br><span class="line">        <span class="keyword">if</span> (runningThread == <span class="number">0</span>) <span class="comment">// 全部下载完毕</span></span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; threadCount; i++)</span><br><span class="line">            {</span><br><span class="line">                File file = <span class="keyword">new</span> File(threadId + <span class="string">".txt"</span>)</span><br><span class="line">                file.delete(); <span class="comment">// 删除文件</span></span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="安卓动态添加进度条"><a href="#安卓动态添加进度条" class="headerlink" title="安卓动态添加进度条"></a>安卓动态添加进度条</h3><p>进度条布局</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">progressBar</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">"@+id/progressBar1"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">style</span>=<span class="string">"?android:attr/progressBarStyleHorizontal</span></span></span><br><span class="line"><span class="tag"><span class="string">    android:layout_width="</span><span class="attr">match_parent</span>"</span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span> /&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>动态添加进度条</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">List&lt;ProgressBar&gt; pbLists = <span class="keyword">new</span> ArrayList&lt;ProgressBar&gt;(); <span class="comment">// 进度条集合，用来取对象</span></span><br><span class="line">barLayout = (LinearLayout) findViewById(R.id.barLayout); <span class="comment">// 进度条线性布局</span></span><br><span class="line"></span><br><span class="line">barLayout.removeAllViews(); <span class="comment">// 先移除上次的进度条</span></span><br><span class="line">pbLists.clear(); <span class="comment">// 清除上次的进度条实例</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加线程数量的进度条</span></span><br><span class="line"><span class="keyword">int</span> threadCount = Integer.parseInt(threadCount);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; threadCount; i++)</span><br><span class="line">{</span><br><span class="line">    View pbView = View.inflate(getApplicationContext(), R.id.barItem, <span class="keyword">null</span>)</span><br><span class="line">    pbLists.add(pbView);</span><br><span class="line">    barLayout.addView(pbView);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="安卓多线程下载"><a href="#安卓多线程下载" class="headerlink" title="安卓多线程下载"></a>安卓多线程下载</h3><p><strong>与进度相关的控件都可以在子线程更新UI</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> PbMax; <span class="comment">// 线程下载的最大值</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> pbPos; <span class="comment">// 当前线程的进度</span></span><br><span class="line">pbMax = endIndex - startIndex;</span><br><span class="line">pbPos = <span class="number">0</span>; <span class="comment">// 进度条当前进度，如果中断过，则要从上次的位置开始</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 每个线程设置对应进度条的进度</span></span><br><span class="line"><span class="keyword">if</span> (code == <span class="number">206</span>)</span><br><span class="line">{</span><br><span class="line">    <span class="comment">// 创建随机读写文件对象</span></span><br><span class="line">    RandomAccessFile raf = <span class="keyword">new</span> RandomAccessFile(getFileName(path), <span class="string">"rw"</span>);</span><br><span class="line">    <span class="comment">// 每个线程从自己的位置开始写</span></span><br><span class="line">    raf.seek(startIndex);</span><br><span class="line"></span><br><span class="line">    InputStream in = conn.getInputStream();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> len = -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">    <span class="keyword">while</span> ((len = in.read()) != -<span class="number">1</span>)</span><br><span class="line">    {</span><br><span class="line">        raf.write(buffer, <span class="number">0</span>, len);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"下载完毕"</span>);</span><br><span class="line">    raf.close();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置进度条进度（注：进度条可以直接在子线程中更新UI）</span></span><br><span class="line">    pbLists.get(threadId).setMax(pbMax);</span><br><span class="line">    pbLists.get(threadId).setProgress(pbPos);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="多线程下载开源项目"><a href="#多线程下载开源项目" class="headerlink" title="多线程下载开源项目"></a>多线程下载开源项目</h3><p><strong>xUtils</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 点击按钮开始下载</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">click</span><span class="params">(View v)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    String path = <span class="string">"..."</span>;</span><br><span class="line">    HttpUtils http = <span class="keyword">new</span> HttpUtils();</span><br><span class="line">    <span class="comment">//下载路径, 目标路径, 是否支持断点续传, 回调);</span></span><br><span class="line">    http.download(path, <span class="string">"/mnt/sdcard/haha.exe"</span>, <span class="keyword">true</span>, <span class="keyword">new</span> RequstCallBack&lt;File&gt;()</span><br><span class="line">    {</span><br><span class="line">        <span class="comment">// 下载成功</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSucess</span><span class="params">(RequestInfo&lt;File&gt; responseInfo)</span></span></span><br><span class="line"><span class="function">        </span>{</span><br><span class="line">            Toast.makeText(getApplicationContext(), <span class="string">"下载成功"</span>, <span class="number">1</span>).show();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 下载失败</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(HttpException error, String msg)</span></span></span><br><span class="line"><span class="function">        </span>{</span><br><span class="line">            ;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 下载进度</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onLoading</span><span class="params">(<span class="keyword">long</span> total, <span class="keyword">long</span> current, <span class="keyword">boolean</span> isUploading)</span></span></span><br><span class="line"><span class="function">        </span>{</span><br><span class="line">            pb.setMax((<span class="keyword">int</span>) total);</span><br><span class="line">            pb.setProgress((<span class="keyword">int</span>) current);</span><br><span class="line">        }</span><br><span class="line">    })</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h1 id="Android-四大组件"><a href="#Android-四大组件" class="headerlink" title="Android 四大组件"></a>Android 四大组件</h1><h2 id="Activity"><a href="#Activity" class="headerlink" title="Activity"></a>Activity</h2><h3 id="创建新的-Activity"><a href="#创建新的-Activity" class="headerlink" title="创建新的 Activity"></a>创建新的 Activity</h3><p>创建新的 Class 继承 Activity</p>
<p>新的 Activity</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span></span></span><br><span class="line"><span class="class"></span>{</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        <span class="comment">// 加载布局</span></span><br><span class="line">        setContentView(R.layout.activity_test)</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>清单文件 AndroidManifest</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 代表当前应用 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 两个 Activity 入口 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">application</span> <span class="attr">...</span> &gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">activity</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">"com.包名.MainActivity"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:label</span>=<span class="string">"第一个页面"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:icon</span>=<span class="string">"@drawable/icon1"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- main 主入口 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.MAIN"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.LAUNCHER"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置入口 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">activity</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">"com.包名.TestActivity"</span> /&gt;</span></span><br><span class="line">        android:label="第二个页面"</span><br><span class="line">        android:icon="@drawable/icon2" /&gt;</span><br><span class="line">        <span class="comment">&lt;!-- main 主入口 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 第二个入口（要 .MAIN 和 .LAUNCHER） --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.MAIN"</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 如果是 .category.DEFAULT 则不会有入口 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.LAUNCHER"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>Android 四大组件都要在清单文件里面配置</li>
<li>如果要多个入口（启动图标），则 <code>intent-filter</code> 必须要 .MAIN 和 .LAUNCHER。（一般就一个启动图标）</li>
<li>Activity 下的 label 和 icon 属性可以和 Application 节点的属性不一样默认使用 Application 节点下的属性。</li>
</ul>
<h4 id="隐式意图"><a href="#隐式意图" class="headerlink" title="隐式意图"></a>隐式意图</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建 意图对象</span></span><br><span class="line">Intent intent = <span class="keyword">new</span> Intent();</span><br><span class="line"><span class="comment">// 设置 跳转的动作</span></span><br><span class="line">intent.setAction(<span class="string">"com.包名.活动名"</span>);</span><br><span class="line"><span class="comment">// 设置 category</span></span><br><span class="line">intent.addCategory(<span class="string">"android.intent.category.DEFALT"</span>);</span><br><span class="line"><span class="comment">// 开启 Activity</span></span><br><span class="line">startActivity(intent);</span><br></pre></td></tr></tbody></table></figure>

<h4 id="意图过滤器"><a href="#意图过滤器" class="headerlink" title="意图过滤器"></a>意图过滤器</h4><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 传递的数据 、 约束 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:mimetype</span>=<span class="string">"audio/mp4"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">android:scheme</span>=<span class="string">"wxy"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>可以配置多个 filter，只要匹配到完整的一个（setData 和 .setType）就行<br>mimetype 和 scheme 都可以不写</p>
<p><strong>mimetype</strong><br>Java 代码中设置 Date 也为 wxy（只要和约束相同就行）<br><code>intent.setData(Uri.parse("wxy:" + 110));</code><br>不设置约束，其实效果相同。</p>
<p><strong>scheme</strong><br><strong>设置 setType 会自动把 setData 方法的数据清除。</strong><br><strong>反之亦然……</strong><br><code>intent.setType("audio/mp4");</code><br>谷歌自定义了很多数据类型，开发者也可以用自己定义的例如<code>aa/bb</code>。</p>
<p>两个要一起使用时，可以用下面的方法：<br><code>intent.setDataAndType(data, type);</code><br>例如：<code>intent.setDataAndType(Uri.parse("wxy:" + 110), "audio/mp4");</code></p>
<p>####显式意图</p>
<p>通过制定具体的包名和类名来切换窗口</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">click</span><span class="params">(View v)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    Intent intent = <span class="keyword">new</span> Intent();</span><br><span class="line">    <span class="comment">//参数：packageName 包名, className 类名</span></span><br><span class="line">    intent.setClassName(<span class="string">"com.wxy.hello"</span>, <span class="string">"com.wxy.hello.HelloActivity2"</span>);</span><br><span class="line">    startActivity(intent);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 更简洁的 切换窗口</span></span><br><span class="line">startActivity(<span class="keyword">new</span> Intent(<span class="keyword">this</span>, HelloActivity.class));</span><br></pre></td></tr></tbody></table></figure>

<p>开启自己应用的界面用显示意图，开启其他应用用隐式意图。</p>
<p>显式意图更加安全一些（仅自己能调用）</p>
<p>####传递数据<br>切换 Activity 时传递数据</p>
<p>获取传递过来的数据 <code>Uri getIntent();</code></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Uri data = intent.getData(); <span class="comment">// 例如 wxy:110</span></span><br></pre></td></tr></tbody></table></figure>

<p><code>Intent.putExtra(name, value);</code> value 支持Android八大类型的数据</p>
<p><strong>存入数据</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Intent intent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, SecondActivity.class);</span><br><span class="line">intent.putExtra(<span class="string">"name"</span>, <span class="string">"hhh"</span>);</span><br><span class="line">intent.putExtra(<span class="string">"sex"</span>, <span class="number">0</span>);</span><br></pre></td></tr></tbody></table></figure>

<p><strong>取出数据</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Intent intent = getIntent();            <span class="comment">// 获取开启此Activity放入意图对象</span></span><br><span class="line">String name = intent.getStringExtra(<span class="string">"name"</span>);</span><br><span class="line"><span class="keyword">int</span> sex = intent.getIntExtra(<span class="string">"sex"</span>, <span class="number">0</span>); <span class="comment">// 参数二为默认值，可省</span></span><br><span class="line">textView.setTex(name);</span><br></pre></td></tr></tbody></table></figure>

<p>####人品计算器</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">byte</span>[] bytes = NULL;</span><br><span class="line"><span class="keyword">int</span> total = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span> (sex == <span class="number">1</span>) bytes = name.getBytes(<span class="string">"GBK"</span>);</span><br><span class="line"><span class="keyword">else</span> bytes = name.getBytes(<span class="string">"UTF-8"</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">byte</span> b : bytes) {     <span class="comment">// 有多少个1</span></span><br><span class="line">    <span class="keyword">int</span> number = b &amp; <span class="number">0xff</span>; <span class="comment">// 1111 1111</span></span><br><span class="line">    total += number;</span><br><span class="line">}</span><br><span class="line"><span class="keyword">int</span> score = Math.abs(total) % <span class="number">100</span>;</span><br><span class="line"><span class="keyword">if</span> (score &gt; <span class="number">90</span>) {</span><br><span class="line">    toast(<span class="string">"您的人品爆棚！"</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>#####RadioGroup</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">RadioGroup</span> <span class="attr">...</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Radio</span> <span class="attr">...</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Radio</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:checked</span>=<span class="string">"checked"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">RadioGroup</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">RadioGroup rg = (RadioGroup) findViewByUd(R.id.rg);</span><br><span class="line"><span class="keyword">int</span> res = rg.getCheckedRadioButtonId(); <span class="comment">// 获取选中的单选框ID(可不选)</span></span><br><span class="line"><span class="keyword">if</span> (res == NULL) { ; }</span><br></pre></td></tr></tbody></table></figure>

<h3 id="短信发送器"><a href="#短信发送器" class="headerlink" title="短信发送器"></a>短信发送器</h3><p>制作一个能够发送短信模板的小应用。</p>
<p>####简单的 ListView</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String msgs[] = {<span class="string">"短信1"</span>, <span class="string">"短信2"</span>, <span class="string">"短信3"</span>, ...};</span><br><span class="line">ListView lv = (ListView) findViewById(R.id.lv);</span><br><span class="line">ArrayAdapter&lt;String&gt; adapter = <span class="keyword">new</span> ArrayAdapter&lt;String&gt;(<span class="keyword">this</span>, R.layout.item, msg); <span class="comment">// layout/item 里面就只有一个 TextView</span></span><br><span class="line">lv.setAdapter(adapter);</span><br></pre></td></tr></tbody></table></figure>

<p>####设置 ListView 事件</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 给 ListView 设置事件</span></span><br><span class="line">lv.setonItemClickListener(<span class="keyword">new</span> onItemClickListener(){</span><br><span class="line">    <span class="comment">// 点击列表发送短信</span></span><br><span class="line">    <span class="comment">// 参数一：&lt;?&gt;ListView；参数二：每个条目（这里是TextView）</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onItemClickListener</span><span class="params">(AdapterView&lt;?&gt; parent, View view, <span class="keyword">int</span> position, <span class="keyword">long</span> id)</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="comment">// 条目内容</span></span><br><span class="line">        String content = msgs[position];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 跳转到短信发送页面</span></span><br><span class="line">        Intent intent = <span class="keyword">new</span> Intent();</span><br><span class="line">        intent.setAction(<span class="string">"android.intent.action.SEND"</span>);</span><br><span class="line">        intent.addCategory(<span class="string">"android.intent.category.DEFAULT"</span>);</span><br><span class="line">        intent.setType(<span class="string">"text/plain"</span>);</span><br><span class="line">        intent.putExtra(<span class="string">"sms_body"</span>, content); <span class="comment">// 设置短信内容</span></span><br><span class="line">        startActivity(intent);</span><br><span class="line">    }</span><br><span class="line">    });</span><br></pre></td></tr></tbody></table></figure>

<p>####请求码和结果码</p>
<p>自定义短信模板页面并插入</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 跳转到发送短信模板页面</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addTemplate</span><span class="params">(View v)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">  Intent intent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, SmsActivity.class);</span><br><span class="line">  startActivityForResult(intent, <span class="number">1</span>); <span class="comment">// 请求码 = 2</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 当开启的 Activity 页面关闭的时候，调用这个方法</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onActivityResult</span><span class="params">(<span class="keyword">int</span> requestCode, <span class="keyword">int</span> resultCode, Intent data)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">  <span class="keyword">if</span> (requestCode == <span class="number">1</span>) <span class="comment">// 请求码</span></span><br><span class="line">  {</span><br><span class="line">    ; <span class="comment">// 代表请求的是哪个页面的数据</span></span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (resultCode == <span class="number">10</span>) <span class="comment">// 结果码</span></span><br><span class="line">  {</span><br><span class="line">    <span class="comment">// 说明数据是从短信模板页面返回的</span></span><br><span class="line">    String msg = data.getStringExtra(<span class="string">"msg"</span>);</span><br><span class="line"></span><br><span class="line">    edit_num.setText(<span class="string">"msg"</span>);</span><br><span class="line">  }</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">super</span>.onActivityResult(requestCode, resultCode, data);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>选择模板页面</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">lv.setOnItemClickListener(newOnItemClickListener(){</span><br><span class="line">  <span class="meta">@Overridepublic</span> <span class="function"><span class="keyword">void</span> <span class="title">onItemClickListener</span><span class="params">(AdapterView&lt;?&gt; parent, View view, <span class="keyword">int</span> position, <span class="keyword">long</span> id)</span></span></span><br><span class="line"><span class="function">  </span>{</span><br><span class="line">    String msg = msgs.get(position).getPhone();</span><br><span class="line"></span><br><span class="line">    Intent intent - <span class="keyword">new</span> Intent();</span><br><span class="line">    intent.putExtra(<span class="string">"msg"</span>, msg);</span><br><span class="line">    setResult(<span class="number">10</span>, intent); <span class="comment">// 返回的结果码 = 10</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关闭当前页面</span></span><br><span class="line">    finish();</span><br><span class="line">  }</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>

<p>####发送短信</p>
<p><code>SmsManager 类</code><br>添加权限 <code>android.permission.SEND_SMS</code></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String number, content;</span><br><span class="line">SmsManager sm = SmsManager.getDefault(); <span class="comment">// 静态方法</span></span><br><span class="line"><span class="comment">// 参数二：服务中心号码，NULL 则使用默认；参数四：广播(成功失败的结果)</span></span><br><span class="line">sm.sendTextMessage(number, <span class="keyword">null</span>, content, NULL);</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>注：这个API有限制，英文70字符，中文140。太多不会发送，需要划分成多个片段。</p>
</blockquote>
<p>###Activity 生命周期</p>
<p>onCreate<br>​    onResuart<br>​    onStart 变成可视界面时<br>​        onResume 允许获取焦点（按钮能点击等）<br>​        onPause  不允许获取焦点<br>​    onStop  界面不可见时<br>onDestroy</p>
<p>打开其他 Activity：onPause onStart<br>返回当前 Activity：onRestart onStart onResume</p>
<p>####设置横屏<br>横竖屏切换时，会Destroy再Create。<br>竖屏：portrait<br>横屏：landscape<br><code>&lt;activity android:screenOrientation="portrait"&gt;</code></p>
<p>###任务栈</p>
<p>任务栈和 Activity 有关</p>
<p>进栈：打开一个 Activity<br>出栈：关闭一个 Activity<br>操作的 Activity 永远是栈顶的 </p>
<p>任务栈是用来维护操作体验的</p>
<p>应用程序退出完是任务栈清空了</p>
<p>一般情况一个应用程序对应一个任务栈</p>
<p>###Activity 的四种启动模式</p>
<p><code>&lt;activity android:launchMode="stander" ... &gt;</code></p>
<ul>
<li>stander        每创建一次 Activity 就一个任务栈</li>
<li>singletop      若Activity在栈顶则复用原Activity，否则创建Activity</li>
<li>singletask     一个 Activity 单一任务栈。浏览器。</li>
<li>singleinstance 有专属的任务栈，仅一个实例，不会重复创建。任务栈和任务栈之间再形成顺序。来电页面。</li>
</ul>
<h2 id="广播"><a href="#广播" class="headerlink" title="广播"></a>广播</h2><h3 id="广播接收"><a href="#广播接收" class="headerlink" title="广播接收"></a>广播接收</h3><p>类名一般是 xxReceiver 格式<br>退出程序后，进程还在，广播接受器还能收到广播</p>
<h4 id="IP拨号器"><a href="#IP拨号器" class="headerlink" title="IP拨号器"></a>IP拨号器</h4><p>（加特定前缀能省话费）</p>
<p>权限：<code>android.permission.OUTGONG_CALL</code></p>
<p>清单文件配置</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">application</span>&gt;</span></span><br><span class="line">	......</span><br><span class="line">	<span class="tag">&lt;<span class="name">receiver</span> <span class="attr">android:name</span>=<span class="string">"com.包名.OutGoingCallReceiver"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 要接受的广播频道 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.NEW_OUTGONG_CALL"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>定义广播接受者（java类）<br>若没有界面的话，可以不用编辑 MainActivity</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.content.BroadcastReceiver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OutGoingCallReceiver</span> <span class="keyword">extends</span> <span class="title">BroadcastReceiver</span> </span>{</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 当进行外拨电话的时候调用</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceiver</span><span class="params">(Context context, Intent intent)</span> </span>{</span><br><span class="line">		<span class="comment">// 使用参数里的上下文来读取设置</span></span><br><span class="line">		SharedPreferences sp = context.getSharedPreferences(<span class="string">"config"</span>, <span class="number">0</span>);</span><br><span class="line">		String IPnumber = sp.getString(<span class="string">"IPnumber"</span>, <span class="string">""</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 获取当前拨打的电话号码</span></span><br><span class="line">		String number = getResultData();</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 判断当前号码是否是长途，在当前的号码前面加上前缀</span></span><br><span class="line">		<span class="keyword">if</span> (currentNumber.startsWith(<span class="string">"0"</span>)) {</span><br><span class="line">			setResultData(IPnumber + number); <span class="comment">// 一般是能变更的前缀</span></span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>主函数 设置用户手动输入的 IPnumber</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">click</span><span class="params">(View v)</span> </span>{</span><br><span class="line">	EditText et = (EditText) findViewById(R.id.et);</span><br><span class="line">	String IPnumber = et.getText().toString().trim(); <span class="comment">// 用户编辑的前缀好吗</span></span><br><span class="line">	SharedPreferences sp = getSharedPreferences(<span class="string">"cinfig"</span>, <span class="number">0</span>);</span><br><span class="line">	sp.edit().putString(<span class="string">"IPnumber"</span>, IPnumber).commit();</span><br><span class="line">	Toast.makeText(getApplicationContext, <span class="string">"保存成功"</span>, <span class="number">1</span>).show();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="SD卡状态的监听"><a href="#SD卡状态的监听" class="headerlink" title="SD卡状态的监听"></a>SD卡状态的监听</h4><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">receiver</span> <span class="attr">android:name</span>=<span class="string">"包名.AdcardStateReceiver"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.MEDIA_MOUNTED"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.MEDIA_UNMOUNTED"</span> /&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 必须指定一个叫 file 的约束，否则不生效 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">data</span> <span class="attr">android:scheme</span>=<span class="string">"file"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>小细节：SD卡里面存的数据类型是 <code>file</code>，所以需要 file 约束。另一个要配置data的广播事件是 安装应用</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.content.BroadcastReceiver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span>  <span class="title">SdcardStateReceiver</span> <span class="keyword">extends</span> <span class="title">BroadcastReceiver</span> </span>{</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>{</span><br><span class="line">		<span class="comment">//  获取当前广播的事件类型</span></span><br><span class="line">		Strning action = intent.getAction();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (<span class="string">"android.intent.action.MEDIA_MOUNTED"</span>.equals(action)) {</span><br><span class="line">			<span class="comment">// SD卡挂在</span></span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"android.intent-filter.action.MEDIA_UNMOUNTED"</span>.equals(action)) {</span><br><span class="line">			<span class="comment">// SD卡卸载</span></span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="短信监听器"><a href="#短信监听器" class="headerlink" title="短信监听器"></a>短信监听器</h4><p>权限：<code>android.permission.RECEIVE_SMS</code></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.provider.Telephony.SMS_RECEIVED"</span> /&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>{</span><br><span class="line">	<span class="comment">// 获取发送的号码和内容</span></span><br><span class="line">	Object[] objects = (Objectp[]) intent.getExtras().get(<span class="string">"pdus"</span>);</span><br><span class="line">	<span class="keyword">for</span> (Object obj : objects) {</span><br><span class="line">		<span class="comment">// 获取 smsmessage 实例：这是调用静态方法而不是 new 出来的</span></span><br><span class="line">		SmsMessage smsMessage = SmsMessage.createFromPdu((<span class="keyword">byte</span>[]) boj);</span><br><span class="line">		<span class="comment">// 获取短信内容</span></span><br><span class="line">		String messageBody = smsMessage.getMessageBody();</span><br><span class="line">		String address = smsMessage.getOriginatingAddress();</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="卸载安装实例"><a href="#卸载安装实例" class="headerlink" title="卸载安装实例"></a>卸载安装实例</h4><p>这个也要配置 data</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.PACKAGE_INSTALL"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.PACKAGE_ADDED"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.PACKAGE_REMOVED"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">data</span> <span class="attr">android.scheme</span>=<span class="string">"package"</span> /&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>{</span><br><span class="line">	String action = intent.getAction();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (<span class="string">"android.intent.action.PACKAGE_INSTALL"</span>.equals(action)) {</span><br><span class="line">		<span class="comment">// 应用安装（预留的字符串，并没有什么用）</span></span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"android.intent.action.PACKAGE_ADDED"</span>.equals(action)) {</span><br><span class="line">		<span class="comment">// 应用安装了</span></span><br><span class="line">		String packageName = intent.getData(); <span class="comment">// 应用包名</span></span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"android.intent.action.PACKAGE_REMOVED"</span>.equals(action)) {</span><br><span class="line">		<span class="comment">// 应用卸载了</span></span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="手机重启实例"><a href="#手机重启实例" class="headerlink" title="手机重启实例"></a>手机重启实例</h4><p>不能在广播接收者里面开启 activity<br>需要添加一个任务栈的标记</p>
<p>权限：<code>anroid.permission.RECEIVE_BOOT_COMPLETED</code></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.BOOT_COMPLETED"</span> /&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BootReceiver</span> <span class="keyword">extends</span> <span class="title">BroadcastReceiver</span> </span>{</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 当手机重新启动的时候调用</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>{</span><br><span class="line">		<span class="comment">// 在这个方法里面开启 activity</span></span><br><span class="line">		Intent intent2 = <span class="keyword">new</span> Intent(context, MainActivity.class);</span><br><span class="line">		intent2.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 开启 activity</span></span><br><span class="line">		context.startActivity(intent2);</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Activity 里屏蔽返回键</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBackPressed</span><span class="params">()</span> </span>{</span><br><span class="line">	; <span class="comment">// 覆盖父类返回方法</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="广播类型"><a href="#广播类型" class="headerlink" title="广播类型"></a>广播类型</h3><p>有序广播：按照一定的优先级进行接收，在接收的过程中可以被修改或者终止</p>
<p>无序广播：不可以被修改或者终止</p>
<p>特殊广播：不能在清单文件中注册，需要动态注册</p>
<h4 id="无序广播"><a href="#无序广播" class="headerlink" title="无序广播"></a>无序广播</h4><p>发送无序广播</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">click</span><span class="params">(View v)</span> </span>{</span><br><span class="line">	Intent intent = <span class="keyword">new</span> Intent();</span><br><span class="line"></span><br><span class="line">	intent.setAction(<span class="string">"com.HHH"</span>);</span><br><span class="line"></span><br><span class="line">	intent.putExtra(<span class="string">"name"</span>, <span class="string">"HHH"</span>);</span><br><span class="line"></span><br><span class="line">	sendBroadcast(intent); <span class="comment">// 发送无序广播</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>接收无序广播</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"com.HHH"</span> /&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 当接收到自定义广播</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>{</span><br><span class="line">	String context = intent.getStringExtra(<span class="string">"name"</span>); <span class="comment">// 广播内容</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="有序广播"><a href="#有序广播" class="headerlink" title="有序广播"></a>有序广播</h4><p>发送有序广播</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 参数：Intent, 权限，最终的receiver，scheduler，初始码，初始化数据，额外的数据</span></span><br><span class="line">sendOrderedBroadcast(intent, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="number">1</span>, <span class="string">"这是广播"</span>, <span class="keyword">null</span>);</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">application</span></span></span><br><span class="line"><span class="tag">	<span class="attr">...</span> &gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">activity</span>&gt;</span> ... <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 配置广播接受优先级 范围 -1000~1000 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">receiver</span> <span class="attr">android:name</span>=<span class="string">"包名.FirstReceiver"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">intent-filter</span> <span class="attr">android:priority</span>=<span class="string">"1000"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"myReceiver"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">receiver</span> <span class="attr">android:name</span>=<span class="string">"包名.SecondReceiver"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">intent-filter</span> <span class="attr">android:priority</span>=<span class="string">"0"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"myReceiver"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">receiver</span> <span class="attr">android:name</span>=<span class="string">"包名.LastReceiver"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">intent-filter</span> <span class="attr">android:priority</span>=<span class="string">"-200"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"myReceiver"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>按顺序接收广播</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FirstReceiver</span> <span class="keyword">extends</span> <span class="title">BroadcastReceiver</span> </span>{</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>{</span><br><span class="line">		String content = getResultData();</span><br><span class="line">		setResultData(<span class="string">"哈哈哈"</span>); <span class="comment">// 修改广播内容，后面接收到的就是这个内容</span></span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecondReceiver</span> <span class="keyword">extends</span> <span class="title">BroadcastReceiver</span> </span>{</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>{</span><br><span class="line">		abortBroadcast(); <span class="comment">// 直接终止广播，下面接收不到了</span></span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LastReceiver</span> <span class="keyword">extends</span> <span class="title">BroadcastReceiver</span> </span>{</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>{</span><br><span class="line">		</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="特殊广播接收者"><a href="#特殊广播接收者" class="headerlink" title="特殊广播接收者"></a>特殊广播接收者</h4><p>操作特别频繁的广播事件，比如 屏幕的锁屏和解锁、电池电量的变化，这种事件的广播在清单文件里面是<strong>注册无效</strong>的，可以动态注册广播</p>
<p>注册广播接受者的两种方式：</p>
<ol>
<li>在清单文件通过 receiver tag 节点</li>
<li>动态注册：代码方式（即清单方式注册无效，并且无需注册）</li>
</ol>
<p>类似于<code>android.intent.action.SCREEN_ON</code> 或 <code>android.intent.action.SCREEN_OFF</code> 这种，注册是无效的</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>{</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 动态的去注册广播接收者，设为全局方便销毁</span></span><br><span class="line">	ScreenReceiver screenreceiver = <span class="keyword">new</span> ScreenReceiver();</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>{</span><br><span class="line">		<span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">		setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">		</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 创建 Intent-Filter 对象</span></span><br><span class="line">		IntentFilter filter = <span class="keyword">new</span> IntentFilter();</span><br><span class="line">		<span class="comment">// 动态注册广播（可以添加多个）</span></span><br><span class="line">		filter.addAction(<span class="string">"android.intent.action.SCREEN_OFF"</span>);</span><br><span class="line">		filter.addAction(<span class="string">"android.intent.action.SCREEN_ON"</span>);</span><br><span class="line">		</span><br><span class="line">		registerReceiver(screenReceiver, filter);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestory</span><span class="params">()</span> </span>{</span><br><span class="line">		<span class="comment">// activity 销毁时要取消注册广播</span></span><br><span class="line"></span><br><span class="line">		unregisterReceiver(screenreceiver);</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScreenReceiver</span> <span class="keyword">extends</span> <span class="title">BroadcastReceiver</span> </span>{</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>{</span><br><span class="line">		</span><br><span class="line">	}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="样式和主题"><a href="#样式和主题" class="headerlink" title="样式和主题"></a>样式和主题</h3><h4 id="样式"><a href="#样式" class="headerlink" title="样式"></a>样式</h4><p>样式一般作用在控件上</p>
<p>style 文件</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"myStyle"</span>&gt;</span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:layout_height"</span>&gt;</span>match_parent<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:textSize"</span>&gt;</span>20SP<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:textColor"</span>&gt;</span>#ff000<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>layout 文件</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">	<span class="attr">style</span>=<span class="string">"@style/mystyle"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">android:text</span>=<span class="string">"哈哈哈"</span> /&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="主题"><a href="#主题" class="headerlink" title="主题"></a>主题</h4><p>样式一般作用在 Activity 或 Application 节点下</p>
<p>style 文件</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"myStyle"</span>&gt;</span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:background"</span>&gt;</span>#ff0000<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>manifest 文件</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">application</span></span></span><br><span class="line"><span class="tag">	<span class="attr">android:theme</span>=<span class="string">"@style/mystyle"</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h4><p>两者定义的方式是一样的。</p>
<p>样式的作用范围比较窄，主题比较大。</p>
<p>不一定要在 style.xml 上定义，其他类似 txt 上也行。</p>
<h4 id="Android-国际化"><a href="#Android-国际化" class="headerlink" title="Android 国际化"></a>Android 国际化</h4><p>国际化：i18n</p>
<p>类似于<code>android:text="你好世界"</code>这种硬编码的字符串，一般都是放到<code>string.xml</code>里面</p>
<p>多国语言文件：res目录下的<strong>values-语言代码</strong>文件夹里面的<code>string.xml</code> （固定写法）<br>语言代码：en英语，zh中文简体，zh-Hant中文繁体……<br>例如：<code>/res/values-zh/string.xml</code> 表示中文资源</p>
<h3 id="对话框"><a href="#对话框" class="headerlink" title="对话框"></a>对话框</h3><p>常见对话框</p>
<ul>
<li>Toast</li>
<li>普通对话框</li>
<li>单选对话框</li>
<li>多选对话框</li>
<li>进度条对话框</li>
</ul>
<h4 id="普通对话框"><a href="#普通对话框" class="headerlink" title="普通对话框"></a>普通对话框</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过 builder 构建器来构造</span></span><br><span class="line">AlertDialog.Builder builder = <span class="keyword">new</span> Builder(<span class="keyword">this</span>); <span class="comment">// 不能用 getApplicationContext()</span></span><br><span class="line">builder.setTitle(<span class="string">"提示"</span>);</span><br><span class="line">builder.setMessage(<span class="string">"这里是提示内容"</span>);</span><br><span class="line">builder.setPositiveButton(<span class="string">"确定"</span>, <span class="keyword">new</span> OnClickListener() {</span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(DialogInterface dialog, <span class="keyword">int</span> which)</span> </span>{</span><br><span class="line">			System.out.println(<span class="string">"点击了确定按钮"</span>);</span><br><span class="line">		}</span><br><span class="line">	});</span><br><span class="line">builder.setNegativeButton(<span class="string">"取消"</span>, <span class="keyword">new</span> OnClickListener() {</span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(DialogInterface dialog, <span class="keyword">int</span> which)</span> </span>{</span><br><span class="line">			System.out.println(<span class="string">"点击了取消按钮"</span>);</span><br><span class="line">		}</span><br><span class="line">	});</span><br><span class="line">builder.show(); <span class="comment">// 一定要 show 出来</span></span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>如果报错，则把<code>new OnClickListener(){}</code> 改成<code>new DialogInterface.OnClickListener(){}</code></p>
</blockquote>
<h5 id="两种上下文的区别"><a href="#两种上下文的区别" class="headerlink" title="两种上下文的区别"></a>两种上下文的区别</h5><ul>
<li>this （即：类名.this）</li>
<li>getApplicationContext() 返回的是 Context 对象</li>
</ul>
<p>getApplicationContext() 获取的是整个应用上下文，this 是其子类，子类有的父类不一定有。</p>
<p>this 多了token（令牌）。</p>
<p><strong>就对话框来说，必须要用 this</strong>，否则会报错。</p>
<h4 id="单选对话框"><a href="#单选对话框" class="headerlink" title="单选对话框"></a>单选对话框</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">AlertDialog.Builder builder = <span class="keyword">new</span> Builder(<span class="keyword">this</span>);</span><br><span class="line">builder.setTitle(<span class="string">"请选择"</span>);</span><br><span class="line">String items[] = { <span class="string">"item1"</span>, <span class="string">"item2"</span>};</span><br><span class="line"><span class="comment">// 参数二：checked 选中索引，-1 为没有选中</span></span><br><span class="line">builder.setSingleChoiceItems(items, -<span class="number">1</span>, <span class="keyword">new</span> OnClickListener() {</span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(DialogInterface dialog, <span class="keyword">int</span> which)</span> </span>{</span><br><span class="line">			System.out.println(<span class="string">"您选择了"</span> + items[which]);</span><br><span class="line">			<span class="comment">// 关闭对话框：点一下就关掉，不需要确定按钮</span></span><br><span class="line">			dialog.dismiss();</span><br><span class="line">		}</span><br><span class="line">	}); </span><br><span class="line">builder.show();</span><br></pre></td></tr></tbody></table></figure>

<h4 id="多选对话框"><a href="#多选对话框" class="headerlink" title="多选对话框"></a>多选对话框</h4><p>注意：listener 是<code>OnMultiChoiceClickListener</code></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">AlertDialog.Builder builder = <span class="keyword">new</span> Builder(<span class="keyword">this</span>);</span><br><span class="line">String items[] = {<span class="string">"item1"</span>, <span class="string">"item2"</span>, <span class="string">"item3"</span>};</span><br><span class="line">Boolean[] checkedItems = {<span class="keyword">true</span>, <span class="keyword">false</span>, <span class="keyword">true</span>};</span><br><span class="line">builder.setMultiChoiceItems(items, checkedItems, <span class="keyword">new</span> OnMultiChoiceClickListener() {</span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(DialogInterface dialog, <span class="keyword">int</span> which, <span class="keyword">boolean</span> isChecked)</span> </span>{</span><br><span class="line">			System.out.println(<span class="string">"您点击了"</span> + items[which]);</span><br><span class="line">			<span class="comment">// 关闭对话框：点一下就关掉，不需要确定按钮</span></span><br><span class="line">			dialog.dismiss();</span><br><span class="line">		}</span><br><span class="line">	});</span><br><span class="line">builder.setPositiveButton(<span class="string">"确定"</span>, <span class="keyword">new</span> OnClickListener() {</span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(DialogInterface dialog, <span class="keyword">int</span> which)</span> </span>{</span><br><span class="line">			<span class="comment">// 把选中的条目数据取出来</span></span><br><span class="line">			StringBuffer sb = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; checkedItems.length; i++)</span><br><span class="line">			{</span><br><span class="line">				<span class="keyword">if</span> (checkedItems[i])</span><br><span class="line">				{</span><br><span class="line">					sb.append(items[i] + <span class="string">" "</span>);</span><br><span class="line">				}</span><br><span class="line">			}</span><br><span class="line">			Toast.makeText(getApplicationContext(), sb.toString(), <span class="number">1</span>).show();</span><br><span class="line">			<span class="comment">// 关闭对话框</span></span><br><span class="line">			dialog.dismiss();</span><br><span class="line">		}</span><br><span class="line">	});</span><br><span class="line">builder.show();</span><br></pre></td></tr></tbody></table></figure>

<h4 id="进度条对话框"><a href="#进度条对话框" class="headerlink" title="进度条对话框"></a>进度条对话框</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ProgressDialog dialog = <span class="keyword">new</span> ProgressDialog(<span class="keyword">this</span>);</span><br><span class="line">dialog.setTitle(<span class="string">"正在加载中"</span>);</span><br><span class="line"><span class="comment">// 设置进度条样式</span></span><br><span class="line">dialog.setProgressStyle(style);</span><br><span class="line">dialog.show();</span><br></pre></td></tr></tbody></table></figure>

<p>style 属性有：</p>
<p><code>ProgressDialog.STYLE_HORIZONTAL</code> 横向进度条，0%</p>
<p><strong>和进度相关的控件，都能在子线程中更新UI</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">ProgressDialog dialog = <span class="keyword">new</span> ProgressDialog(<span class="keyword">this</span>);</span><br><span class="line">dialog.setTitle(<span class="string">"正在加载中"</span>);</span><br><span class="line"><span class="comment">// 设置进度条样式</span></span><br><span class="line">dialog.setProgressStyle(ProgressDialog.STYLE_HORIZONTAL);</span><br><span class="line">dialog.show();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个子线程</span></span><br><span class="line"><span class="keyword">new</span> Thread() { </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">		<span class="comment">// 设置最大值</span></span><br><span class="line">		dialog.setMax(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 耗时操作，设置进度</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++)</span><br><span class="line">		{</span><br><span class="line">			<span class="comment">// 睡眠 50 ms</span></span><br><span class="line">			SystemClock.sleep(<span class="number">50</span>);</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 设置当前进度</span></span><br><span class="line">			dialog.setProgress(i);</span><br><span class="line">		}</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 关闭对话框</span></span><br><span class="line">		dialog.dismiss();</span><br><span class="line">	}</span><br><span class="line">}.start();</span><br></pre></td></tr></tbody></table></figure>

<h3 id="帧动画"><a href="#帧动画" class="headerlink" title="帧动画"></a>帧动画</h3><p>Android 中动画</p>
<ul>
<li><strong>帧动画</strong></li>
<li>View 动画（补间动画）</li>
<li>属性动画</li>
</ul>
<p>帧动画：加载一系列的图片资源</p>
<p>xml 文件在<code>res/drawable/directory</code>目录下，标签是<code>&lt;animation-list&gt;</code></p>
<p>res/drawable/myanim.xml 文件</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">animation-list</span> <span class="attr">xmlns:android</span>=<span class="string">"..."</span></span></span><br><span class="line"><span class="tag">	<span class="attr">androidLoneshot</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- true 表示只执行一次，false 循环播放 --&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">		<span class="attr">android:drawable</span>=<span class="string">"@drawable/pic_1"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">android:duration</span>=<span class="string">"200"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">		<span class="attr">android:drawable</span>=<span class="string">"@drawable/pic_2"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">android:duration</span>=<span class="string">"200"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">		<span class="attr">android:drawable</span>=<span class="string">"@drawable/pic_3"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">android:duration</span>=<span class="string">"200"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">		<span class="attr">android:drawable</span>=<span class="string">"@drawable/pic_4"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">android:duration</span>=<span class="string">"200"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">animation-list</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>java文件</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ImageView rocketImage = (ImageView) findViewById(R.id.rocketImage);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置背景资源</span></span><br><span class="line">rocketImage.setBackgroundResource(R.drawable.myanim);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取 AnimationDrawable 类型</span></span><br><span class="line">AnimationDrawable rocketAnimation = (AnimationDrawable) rocketImage.getBackground();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 开启动画</span></span><br><span class="line">rocketAnimation.start();</span><br></pre></td></tr></tbody></table></figure>

<p>兼容低版本 2.3</p>
<p>因为数据并未准备好，这个 API 是 2.3 之后出的</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">ImageView rocketImage = (ImageView) findViewById(R.id.rocketImage);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置背景资源</span></span><br><span class="line">rocketImage.setBackgroundResource(R.drawable.myanim);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 兼容低版本的写法</span></span><br><span class="line"><span class="keyword">new</span> Thread(){</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">		SystemClock.sleep(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 获取 AnimationDrawable 类型</span></span><br><span class="line">		AnimationDrawable rocketAnimation = (AnimationDrawable) rocketImage.getBackground();</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 开启动画</span></span><br><span class="line">		rocketAnimation.start();</span><br><span class="line">	}</span><br><span class="line">}.start();</span><br></pre></td></tr></tbody></table></figure>

<h2 id="服务"><a href="#服务" class="headerlink" title="服务"></a>服务</h2><p>服务在后台运行，没有界面</p>
<p><code>Service extends CpntextWrapper implements ...</code></p>
<h3 id="进程"><a href="#进程" class="headerlink" title="进程"></a>进程</h3><ol>
<li>前台进程</li>
<li>可视进程</li>
<li>服务进程</li>
<li>后台进程</li>
<li>空进程</li>
</ol>
<h3 id="start方式开启服务"><a href="#start方式开启服务" class="headerlink" title="start方式开启服务"></a>start方式开启服务</h3><p><strong>清单文件</strong></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">application</span> <span class="attr">...</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">activity</span> <span class="attr">...</span>&gt;</span> ... <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">service</span> <span class="attr">android:name</span>=<span class="string">"包名.服务名"</span>&gt;</span><span class="tag">&lt;/<span class="name">service</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>MyService.java</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyService</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>{</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Ibinder <span class="title">onBind</span><span class="params">(Intent intent)</span> </span>{</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 服务第一次创建的时候调用</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>{</span><br><span class="line">		<span class="keyword">super</span>.onCreate();</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 服务运行</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">onStartCommand</span><span class="params">(Intent intent, <span class="keyword">int</span> flags, <span class="keyword">int</span> startId)</span> </span>{</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">super</span>.StartCommand(intent, flags, startId);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 服务销毁</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>{</span><br><span class="line">		<span class="keyword">super</span>.onDestroy;</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>MainActivity.java</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 开启服务，一直后台运行直到用户手动关闭</span></span><br><span class="line">startService(<span class="keyword">new</span> Intent(<span class="keyword">this</span>, MyService.class));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 结束服务</span></span><br><span class="line">stopService(<span class="keyword">new</span> Intent(<span class="keyword">this</span>, MyService.class));</span><br></pre></td></tr></tbody></table></figure>

<p><strong>start方式开启服务的特点</strong></p>
<ul>
<li>定义四大组件的方式是一样的</li>
<li>定义一个类继承Service</li>
<li>第一次开启服务，会执行 onCreate 和 onStart 方案</li>
<li>第二次开启服务，会执行 onStart 方法</li>
<li><strong>服务一定开启，就会长期后台运行，直到用户手动停止</strong></li>
</ul>
<h4 id="电话监听器"><a href="#电话监听器" class="headerlink" title="电话监听器"></a>电话监听器</h4><ol>
<li>定义一个服务，开启服务。（记得在清单文件中配置服务）</li>
<li>在服务的 onCreate 里面获取 TelephonyManager</li>
<li>注册电话的监听</li>
<li>定义一个类用来判断电话的状态</li>
</ol>
<p><strong>TelephoneManager</strong> 监视电话的状态的改变</p>
<p>权限：<code>&lt;uses-permission android:name="android.permission.READ_PHONE_STATE" /&gt;</code></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PhoneService</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>{</span><br><span class="line">	<span class="meta">@Override</span> <span class="function">Ibinder <span class="title">onBind</span><span class="params">(Intent intent)</span> </span>{</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>{</span><br><span class="line">		<span class="comment">// 获取 telephonemanager 的实例</span></span><br><span class="line">		TelephonyManager tm = (TelephonyManager)getSystemService(TELEPHONY_SERVICE);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 注册电话的监听</span></span><br><span class="line">		tm.listen(<span class="keyword">new</span> MyPhoneStateListener(), PhoneStateListener.LISTEN_CALL_STAT)</span><br><span class="line"></span><br><span class="line">		<span class="keyword">super</span>.onCreate();</span><br><span class="line"></span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>{</span><br><span class="line">		<span class="keyword">super</span>.onDestroy();</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">MyPhoneStateListener</span> <span class="keyword">extends</span> <span class="title">PhoneStateListener</span> </span>{</span><br><span class="line">		<span class="comment">// 当电话设备状态发生改变的时候调用</span></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCallStateChanged</span><span class="params">(<span class="keyword">int</span> state, String incomingNumber)</span> </span>{</span><br><span class="line">			<span class="comment">// 具体判断一下电话的状态</span></span><br><span class="line">			<span class="keyword">switch</span> (state) {</span><br><span class="line">			<span class="keyword">case</span> TelephonyManager.CALL_STATE_IDLE: <span class="comment">// 空闲</span></span><br><span class="line">				<span class="comment">// 停止录音</span></span><br><span class="line"></span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> TelephonyManager.CALL_STATE_OFFHOOK: <span class="comment">// 接听</span></span><br><span class="line">				<span class="comment">// 开始录音</span></span><br><span class="line"></span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> TelephonyManager.CALL_STATE_RINGING: <span class="comment">// 响铃</span></span><br><span class="line">				<span class="comment">// 准备一个录音机</span></span><br><span class="line">				</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line"></span><br><span class="line">	} {}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h5 id="录音机"><a href="#录音机" class="headerlink" title="录音机"></a>录音机</h5><p>录音需要权限：<br><code>&lt;uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" /&gt;</code><br><code>&lt;uses-permission android:name="android.permission.RECORD_AUDIO" /&gt;</code></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建实例，全局</span></span><br><span class="line">MediaRecorder recorder = <span class="keyword">new</span> MediaRecorder();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置音频来源（麦克风MIC、外置声音VOICE_CALL)</span></span><br><span class="line">recorder.setAudioSource(MediaRecorder.AudioSource.MIC); <span class="comment">// 外国违法</span></span><br><span class="line"><span class="comment">// 设置输出格式 3GP(THREE_GPP)、MPEG_4 等</span></span><br><span class="line">recorder.setOutputFormat(MediaRecorder.OutputFormat.THREE_GPP);</span><br><span class="line"><span class="comment">// 设置音频编码方式</span></span><br><span class="line">recorder.setAudioEncoder(MediaRecorder.AudioEncoder.AMR_NB);</span><br><span class="line"><span class="comment">// 设置存放路径</span></span><br><span class="line">recorder.setOutputFile(<span class="string">"/mnt/sdcard/luyin.3gp"</span>);</span><br><span class="line"><span class="comment">// 准备录</span></span><br><span class="line"><span class="keyword">try</span> {</span><br><span class="line">	recorder.prepare();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 开始录</span></span><br><span class="line">recorder.start();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 停止录</span></span><br><span class="line"><span class="keyword">if</span> (recorder != <span class="keyword">null</span>)</span><br><span class="line">{</span><br><span class="line">	recorder.stop();</span><br><span class="line">	recorder.reset();</span><br><span class="line">	recorder.release();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="使用服务注册特殊的广播接收者"><a href="#使用服务注册特殊的广播接收者" class="headerlink" title="使用服务注册特殊的广播接收者"></a>使用服务注册特殊的广播接收者</h4><ol>
<li>定义广播接收者</li>
<li>写个服务用来注册广播接收者</li>
<li>在MainActivity里面开启服务</li>
<li>一定要记得配置服务</li>
</ol>
<p>MainActivity.java</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">onCreate() {</span><br><span class="line">	Intent intent = <span class="function">newe <span class="title">Intent</span><span class="params">(<span class="keyword">this</span>, ScreenService.class)</span></span>;</span><br><span class="line">	startService(intent);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ScreenService.java</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 动态注册和销毁广播</span></span><br><span class="line"><span class="keyword">private</span> ScreenReceiver receiver = <span class="keyword">new</span> ScreenReceiver();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>{</span><br><span class="line">	<span class="comment">// 服务创建时注册广播接收者</span></span><br><span class="line">	IntentFilter filter = <span class="keyword">new</span> IntentFilter();</span><br><span class="line">	filter.addAction(<span class="string">"android.intent.action.SCREEN_OFF"</span>);</span><br><span class="line">	filter.addAction(<span class="string">"android.intent.action.SCREEN_ON"</span>);</span><br><span class="line"></span><br><span class="line">	registerReceiver(receiver, filter)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">super</span>.onCreate();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">onDestroy() {</span><br><span class="line">	<span class="comment">// 服务销毁的时候取消广播接收者</span></span><br><span class="line">	unregisterReceiver(receiver);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">super</span>.onDestroy();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ScreenReceiver.java</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScreenReceiver</span> <span class="keyword">extends</span> <span class="title">BroadcastReceiver</span></span></span><br><span class="line"><span class="class"></span>{</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span></span></span><br><span class="line"><span class="function">	</span>{</span><br><span class="line">		<span class="comment">// 获取当前的事件类型</span></span><br><span class="line">		String acation = intent.getAction();</span><br><span class="line">		<span class="keyword">if</span> (<span class="string">"android.intent.action.SCREEN_OFF"</span>.equals(action))</span><br><span class="line">			; <span class="comment">// 锁屏</span></span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"android.intent.action.SCREEN_ON"</span>.equals(action))</span><br><span class="line">			; <span class="comment">// 解锁</span></span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="bind-方式开启服务"><a href="#bind-方式开启服务" class="headerlink" title="bind 方式开启服务"></a>bind 方式开启服务</h3><p><code>bindService(service, conn, flags);</code></p>
<p>点击按钮绑定服务</p>
<p>MainActivity.java</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">MyConn conn;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">click</span><span class="params">(View v)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="comment">// 或者放到 onCreate 方法里面</span></span><br><span class="line">	Intent intent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, MyService.class);</span><br><span class="line">	conn = <span class="keyword">new</span> MyConn();</span><br><span class="line">	bindService(intent, conn, BIND_AUTI_CREATE);<span class="comment">// 只能绑定一次</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个类，用来监视服务的状态</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> MyConn extends ServiceConnection</span><br><span class="line">{</span><br><span class="line">	<span class="comment">// 当服务连接成功</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceConnected</span><span class="params">(ComponentName name, IBinder serviec)</span> </span>{</span><br><span class="line">		;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 失去连接</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceDisconnected</span><span class="params">(ComponentName name)</span> </span>{</span><br><span class="line">		 ;</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 服务和活动绑定，销毁的时候必须手动解绑（同样不可以多次解绑）</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>{</span><br><span class="line">	unbindService(conn);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">super</span>.onDestroy();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>MyService.java</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 当绑定服务的时候</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> IBinder <span class="title">onBinder</span><span class="params">(Intent intent)</span> </span>{</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 当这个方法返回值为null的时候，onServiceConnected方法一不执行的</span></span><br><span class="line">	<span class="comment">// return null;</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>bind方法开启服务的特点</strong></p>
<ul>
<li>点击按钮（或执行操作）后，会此项服务的onCreate方法和onBind方法</li>
<li>当onBind方法返回null的时候，onServiceConnected方法是不执行的</li>
<li>第二次点击按钮，服务没有响应</li>
<li><strong>activity和service之间，不求同时生，但求同时死……</strong></li>
<li>服务多次解绑会报异常</li>
<li>设置页面里面不能找到bind方式开启的服务，相当于隐形的服务</li>
</ul>
<h4 id="为什么要引入-bindService"><a href="#为什么要引入-bindService" class="headerlink" title="为什么要引入 bindService"></a>为什么要引入 bindService</h4><p>在 Activity 里面调用 Service 的方法</p>
<p>Binder 是一个接口。</p>
<p>MyService.java</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> IBinder <span class="title">onbind</span><span class="params">(Intent intent)</span> </span>{</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> MyBinder;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 要调用的方法</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">f</span><span class="params">()</span> </span>{</span><br><span class="line">	;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> class MyBinder extends <span class="title">Binder</span><span class="params">()</span> </span>{</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">callF</span><span class="params">()</span> </span>{</span><br><span class="line">		<span class="comment">// 调用 f 的方法</span></span><br><span class="line">		f();</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>MainActivity.java</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">MyConn conn;</span><br><span class="line"><span class="keyword">private</span> MyBinder myBinder; <span class="comment">// （中间对象）</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(...)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	Intent intent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, MyService.class);</span><br><span class="line">	conn = <span class="keyword">new</span> MyConn();</span><br><span class="line">	bindService(intent, conn, BIND_AUTI_CREATE);<span class="comment">// 只能绑定一次</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个类，用来监视服务的状态</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> MyConn extends ServiceConnection</span><br><span class="line">{</span><br><span class="line">	<span class="comment">// 当服务连接成功</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceConnected</span><span class="params">(ComponentName name, IBinder serviec)</span> </span>{</span><br><span class="line">		myBinder = (MyBinder) service; <span class="comment">// 拿到中间对象，从而可以调用服务里的某个方法</span></span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 失去连接</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceDisconnected</span><span class="params">(ComponentName name)</span> </span>{</span><br><span class="line">		 ;</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">click</span><span class="params">()</span> </span>{</span><br><span class="line">	myBinder.callF(); <span class="comment">// 间接调用服务的方法</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 服务和活动绑定，销毁的时候必须手动解绑（同样不可以多次解绑）</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>{</span><br><span class="line">	unbindService(conn);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">super</span>.onDestroy();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="通过接口调用服务里面的方法"><a href="#通过接口调用服务里面的方法" class="headerlink" title="通过接口调用服务里面的方法"></a>通过接口调用服务里面的方法</h4><p>接口可以隐藏代码内部的细节，让程序员只暴露自己想暴露的方法</p>
<ol>
<li>把想暴露的方法都定义在接口里面</li>
<li>Binder对象实现我们定义的方法</li>
<li>把获取到的IBinder对象转换成暴露部分方法的接口</li>
</ol>
<p>Iservice.java （I 开头表示是一个接口）</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Iservice</span> </span>{</span><br><span class="line">	<span class="comment">// 只暴露一个 f1，没有 f2</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">callF1</span><span class="params">()</span></span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>MyService.java</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">f1</span><span class="params">()</span> </span>{ }</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">f2</span><span class="params">()</span> </span>{ }</span><br><span class="line"></span><br><span class="line"><span class="comment">// 把 public 改成 private</span></span><br><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBinder</span> <span class="keyword">extends</span> <span class="title">Binder</span> <span class="keyword">implements</span> <span class="title">Iservice</span> </span>{</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">callF1</span><span class="params">()</span> </span>{ }</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">callF2</span><span class="params">()</span> </span>{ }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>MainActivity.java</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> MyConn conn;</span><br><span class="line"><span class="keyword">private</span> Iservice myBinder; <span class="comment">// 中间对象</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> calss MyConn implements ServiceConnection {</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceConnected</span><span class="params">(ComponentName name, IBinder service)</span> </span>{</span><br><span class="line">		<span class="comment">// 类型转换成 Iservice</span></span><br><span class="line">		myBinder = (Iservice) service;</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">click</span><span class="params">(View v)</span> </span>{</span><br><span class="line">	myBinder.callF1(); <span class="comment">// 可以</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// myBinder.callF2(); // 不可以</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="混合方式开启服务"><a href="#混合方式开启服务" class="headerlink" title="混合方式开启服务"></a>混合方式开启服务</h3><p>既能在后台长期运行，又能调用服务里面的方法</p>
<ol>
<li>start 方法开启服务</li>
<li>调用 bindService 获取中间对象</li>
<li>调用 unbindService 解绑服务</li>
<li>彻底退出时 stopService</li>
</ol>
<h4 id="百度音乐盒框架"><a href="#百度音乐盒框架" class="headerlink" title="百度音乐盒框架"></a>百度音乐盒框架</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ==== MainActivity.java ==== */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> MainActivity extends Activity {</span><br><span class="line">    <span class="keyword">private</span> MyConn conn;</span><br><span class="line">    <span class="keyword">private</span> Iservice iservice; <span class="comment">// 定义的 Binder 对象</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentVIew(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 混合方式开启服务</span></span><br><span class="line"></span><br><span class="line">        Intent intent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, MusicService.class);</span><br><span class="line">        startService(intent);</span><br><span class="line"></span><br><span class="line">        conn = <span class="keyword">new</span> MyConn();</span><br><span class="line"></span><br><span class="line">        bindService(intent, conn, BIND_AUTO_CREATE);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 监听服务状态</span></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConn</span> </span>{</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceConnected</span><span class="params">(ComponentName name, IBinder service)</span> </span>{</span><br><span class="line">            <span class="comment">// 获取定义的 Binder 对象</span></span><br><span class="line">            iservice = (Iservice) service;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">playButton</span><span class="params">(View v)</span> </span>{</span><br><span class="line">        <span class="comment">// 播放音乐</span></span><br><span class="line">        iservice.callPlayMusic();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pauseButton</span><span class="params">(View v)</span> </span>{</span><br><span class="line">        <span class="comment">// 暂停音乐</span></span><br><span class="line">        iservice.callPauseMusic();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rePlayButton</span><span class="params">(View v)</span> </span>{</span><br><span class="line">        <span class="comment">// 继续播放音乐</span></span><br><span class="line">        iservice.callRePlayMusic();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>{</span><br><span class="line">        unbindService(conn);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* ==== MusicService.java ==== */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MusicService</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Ibinder <span class="title">onBind</span><span class="params">(Intent intent)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 服务第一次创建的时候调用</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>.onCreate();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 服务运行</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">onStartCommand</span><span class="params">(Intent intent, <span class="keyword">int</span> flags, <span class="keyword">int</span> startId)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.StartCommand(intent, flags, startId);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 服务销毁</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>.onDestroy;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 播放音乐</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">playMusic</span><span class="params">()</span> </span>{</span><br><span class="line">        ;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 暂停音乐</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pauseMusic</span><span class="params">()</span> </span>{</span><br><span class="line">        ;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 继续播放</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rePlayMusic</span><span class="params">()</span> </span>{</span><br><span class="line">        ;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在服务内部定义一个 IBinder 类的实现</span></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBinder</span> <span class="keyword">extends</span> <span class="title">Binder</span> <span class="keyword">implements</span> <span class="title">Iservice</span></span>{</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">callPlayMusic</span><span class="params">()</span> </span>{</span><br><span class="line">            playMusic();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">callPauseMusic</span><span class="params">()</span> </span>{</span><br><span class="line">            pauseMusic();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">callRePlayMusic</span><span class="params">()</span> </span>{</span><br><span class="line">            rePlayMusic();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* ==== Iservice.java ==== */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Iservice</span> </span>{</span><br><span class="line">    <span class="comment">// 想暴露的方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">callPlayMusic</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">callPauseMusic</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">callRePlayMusic</span><span class="params">()</span></span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="AIDL-介绍"><a href="#AIDL-介绍" class="headerlink" title="AIDL 介绍"></a>AIDL 介绍</h3><ul>
<li>本地服务：运行在自己应用里面的服务</li>
<li>远程服务：运行在其他应用里面的服务</li>
</ul>
<p><strong>实现进程间通讯（IPC）</strong></p>
<p>AIDL：安卓接口定义语言，专门用来解决进程间通讯</p>
<ol start="0">
<li>每个应用都要配置服务。其中一个定义 IBinder</li>
<li>把 Iservice.java 文件重命名为 Iservice.aidl。</li>
<li>aidl 不认识 public，所以这个关键词要去掉</li>
<li>会自动生成Iservice.java，里面有个类叫 Stub</li>
<li>MyBinder 直接继承 Stub</li>
<li>两个应用的 aidl 文件包名相同</li>
<li>Stub.asInterface(service);</li>
</ol>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Iservice iservice;</span><br><span class="line"></span><br><span class="line">onCreate() {</span><br><span class="line">	Intent intent = <span class="keyword">new</span> Intent();</span><br><span class="line">	Intent.setAction(<span class="string">"目标应用的包名"</span>);</span><br><span class="line">	MyConn conn = <span class="keyword">new</span> MyConn();</span><br><span class="line">	bindService(intent, conn, BIND_QUTO_CREATE);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConn</span> <span class="keyword">implements</span> <span class="title">ServiceConnection</span> </span>{</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceConnected</span><span class="params">(ComponentName name, IBinder service)</span> </span>{</span><br><span class="line">		iservice = Stub.asInterface(service);</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">click</span><span class="params">(View v)</span> </span>{</span><br><span class="line">	iservice.callF();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBinder</span> <span class="keyword">extends</span> <span class="title">Stub</span> </span>{</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">callF</span><span class="params">()</span> </span>{</span><br><span class="line">		f();</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>Iservice.aidl</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Iservice</span> </span>{</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">()</span></span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="AIDL-的应用场景"><a href="#AIDL-的应用场景" class="headerlink" title="AIDL 的应用场景"></a>AIDL 的应用场景</h4><p>类似调用支付宝进行支付</p>
<figure class="highlight"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>{</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> MyCon conn;</span><br><span class="line">	<span class="keyword">private</span> Iservice iservice;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>{</span><br><span class="line">		<span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">		setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">		Intent intent = <span class="keyword">new</span> Intent();</span><br><span class="line">		intent.setAction(<span class="string">"com.test.pay"</span>);</span><br><span class="line"></span><br><span class="line">		conn = <span class="keyword">new</span> MyConn();</span><br><span class="line"></span><br><span class="line">		bindService(intent, conn, BIND_AUTO_CREATE);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">payClick</span><span class="params">()</span> </span>{</span><br><span class="line">		<span class="keyword">try</span> {</span><br><span class="line">			<span class="keyword">boolean</span> result = iservice.callPay(<span class="string">"abc"</span>, <span class="string">"123"</span>, <span class="number">1000</span>);</span><br><span class="line">			<span class="keyword">if</span> (result) {</span><br><span class="line">				Toast.makeText(getApplicationContext(), <span class="string">"支付成功"</span>, <span class="number">1</span>).show();</span><br><span class="line">			} <span class="keyword">else</span> {</span><br><span class="line">				Toast.makeText(getApplicationContext(), <span class="string">"支付失败"</span>, <span class="number">1</span>).show();</span><br><span class="line">			}</span><br><span class="line">		} <span class="keyword">catch</span> (RemoteException e) {</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConn</span> <span class="keyword">implements</span> <span class="title">ServiceConnection</span> </span>{</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceConnected</span><span class="params">(ComponentName name, IBinder service)</span> </span>{</span><br><span class="line">			iservice = Stub.asInterface(service);</span><br><span class="line">		}</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceDisconnected</span><span class="params">(ComponentName name)</span> </span>{</span><br><span class="line">			;</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>{</span><br><span class="line">		unbinderService(conn);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">super</span>.onDestroy()</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// =================PayService.java===================</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PayService</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>{</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function">publci IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span> </span>{</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> MyBinder();</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 支付的方法</span></span><br><span class="line">	<span class="function">publci <span class="keyword">void</span> <span class="title">pay</span><span class="params">(String username, String pwd, <span class="keyword">int</span> money)</span> </span>{</span><br><span class="line">		<span class="comment">// 检查账号密码安全性等</span></span><br><span class="line">		<span class="keyword">if</span> (<span class="string">"abc"</span> . equals(username) &amp;&amp; <span class="string">"123"</span> . equals(pwd) &amp;&amp; money &lt;= <span class="number">5000</span>) {</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">else</span> {</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBinder</span> <span class="keyword">extends</span> <span class="title">Stub</span> /*<span class="title">Binder</span> <span class="keyword">implements</span> <span class="title">Iservice</span>*/ </span>{</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">callPay</span><span class="params">(String username, String pwd, <span class="keyword">int</span> money)</span> </span>{</span><br><span class="line">		<span class="keyword">return</span> pay(username, pwd, money);</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ==============Iservice.aidl===================</span></span><br><span class="line"><span class="comment">// 用来支付的应用也要 Iservice.aidl</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*public*/</span> <span class="class"><span class="keyword">interface</span> <span class="title">Iservice</span> </span>{</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*public*/</span> <span class="function"><span class="keyword">boolean</span> <span class="title">callPay</span><span class="params">(String username, String pwd, <span class="keyword">int</span> money)</span> </span>{</span><br><span class="line">		pay();</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ====================Manifest==================</span></span><br><span class="line"></span><br><span class="line">&lt;service android:name=<span class="string">"com.test.pay.PayService"</span>&gt;</span><br><span class="line">	&lt;intent-filter&gt;</span><br><span class="line">		&lt;action android:name=<span class="string">"com.test.pay"</span> /&gt;</span><br><span class="line">	&lt;/intent-filter&gt;</span><br><span class="line">&lt;/service&gt;</span><br></pre></td></tr></tbody></table></figure>

<h2 id="内容提供者-contentProvider"><a href="#内容提供者-contentProvider" class="headerlink" title="内容提供者(contentProvider)"></a>内容提供者(contentProvider)</h2><p>作用：在app2中读取app1的数据库(暴露私有的数据库)</p>
<p>使用：</p>
<ol>
<li>建一个类，继承 <code>contentProvider</code>。</li>
<li><strong>在清单文件中配置</strong></li>
<li>添加静态代码块</li>
<li>暴露你想暴露的方法（增删改查）</li>
<li>其他应用就能用内容解析者去操作数据库</li>
</ol>
<h3 id="暴露方法"><a href="#暴露方法" class="headerlink" title="暴露方法"></a>暴露方法</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.content.ContentProvider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyProvider</span> <span class="keyword">extends</span> <span class="title">ContentProvider</span> </span>{</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 定义一个 UriMather 路径匹配器</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> UriMather sURIMather = <span class="keyword">new</span> UriMather(UriMather.NO_MATH);</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> QUERYSUCCESS = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">private</span> MyOpenHelper myOpenHelper;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 定义静态代码块，添加匹配规则</span></span><br><span class="line">	<span class="keyword">static</span> {</span><br><span class="line">		<span class="comment">// sURIMather.addURI(authority/*清单文件里的自定义字符串*/, path, code/*int常量*/)</span></span><br><span class="line">		<span class="comment">// URI 路径：content://mystr/query</span></span><br><span class="line">		sURIMather.addURI(<span class="string">"mystr"</span>, <span class="string">"query"</span>, QUERYSUCCESS);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onCreate</span><span class="params">()</span> </span>{</span><br><span class="line">		myOpenHelper = <span class="keyword">new</span> MyOpenHelper(getContext());</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Cursor <span class="title">query</span><span class="params">(Uri uri, String[] projection, String selection, String[] selectionArgs, String sortOrder)</span> </span>{</span><br><span class="line">		<span class="keyword">int</span> code = sURIMather.math(uri);</span><br><span class="line">		<span class="keyword">if</span> (code == QUERYSUCCESS) { <span class="comment">// 路径匹配成功。不成功返回-1</span></span><br><span class="line">			<span class="comment">// 对数据库进行查询的操作</span></span><br><span class="line">			SQLiteDatabase db = myOpenHelper.getReadableDatabase();</span><br><span class="line"></span><br><span class="line">			<span class="comment">// db.query(table, columns/*别人能访问的列*/, selection, selectionArgs, groupBy, having, orderBy)</span></span><br><span class="line">			Cursor cursor = db.query(<span class="string">"info"</span>, projection, selection, selectionArgs, <span class="keyword">null</span>, <span class="keyword">null</span>. sortOrder);</span><br><span class="line">			<span class="comment">// 注意：cursor 不能管</span></span><br><span class="line"></span><br><span class="line">			<span class="keyword">return</span> cursor;</span><br><span class="line">		} <span class="keyword">else</span> { <span class="comment">// 路径不匹配</span></span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> IlleagalArgumentException(<span class="string">"路径不匹配"</span>);</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getType</span><span class="params">(Uri uri)</span> </span>{</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Uri <span class="title">insert</span><span class="params">(Uri uri, ContentValues values)</span> </span>{</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">provider</span> <span class="attr">android:name</span>=<span class="string">"com.app1.MyProvider"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">android:authorities</span>=<span class="string">"mystr"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">provider</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="app2读取app1的数据库"><a href="#app2读取app1的数据库" class="headerlink" title="app2读取app1的数据库"></a>app2读取app1的数据库</h3><p>由于app1里面的私有数据库已经通过内容提供者的方式暴露出来了，所以app2可以直接通过内容的解析这进行访问</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 拿到内容的解析者</span></span><br><span class="line"><span class="comment">// getContentResolver().query(uri, projection, selection, selectionArgs, sortOrder)</span></span><br><span class="line">Uri uri = Uri.parse(<span class="string">"content://mystr/query"</span>); <span class="comment">// 和app1定义的路径一样</span></span><br><span class="line"><span class="comment">// Cursor cursor = db.query("info", null, null, null, null, null, null, null);</span></span><br><span class="line">Cursor cursor = getContentResolver().query(uri, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line"><span class="keyword">if</span> (cursor != <span class="keyword">null</span> &amp;&amp; cursor.getCount() &gt; <span class="number">0</span>) {</span><br><span class="line">	<span class="keyword">while</span> (cursor.moveToNext()) {</span><br><span class="line">		String name = sursor.getString(<span class="number">1</span>);</span><br><span class="line">		String phone = cursor.getString(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">		System.out.println(<span class="string">"app2  name:"</span>+name+<span class="string">";phone:"</span>+phone);</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="暴露增删改查"><a href="#暴露增删改查" class="headerlink" title="暴露增删改查"></a>暴露增删改查</h3><p>app1</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.content.ContentProvider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyProvider</span> <span class="keyword">extends</span> <span class="title">ContentProvider</span> </span>{</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 定义一个 UriMather 路径匹配器</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> UriMather sURIMather = <span class="keyword">new</span> UriMather(UriMather.NO_MATH);</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> QUERYSUCCESS = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> INSERTSUCCESS = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> UPDATESUCCESS = <span class="number">2</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DELETESUCCESS = <span class="number">3</span>;</span><br><span class="line">	<span class="keyword">private</span> MyOpenHelper myOpenHelper;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 定义静态代码块，添加匹配规则</span></span><br><span class="line">	<span class="keyword">static</span> {</span><br><span class="line">		<span class="comment">// sURIMather.addURI(authority/*清单文件里的自定义字符串*/, path, code/*int常量*/)</span></span><br><span class="line">		<span class="comment">// URI 路径：content://mystr/query</span></span><br><span class="line">		sURIMather.addURI(<span class="string">"mystr"</span>, <span class="string">"query"</span>, QUERYSUCCESS);</span><br><span class="line">		sURIMather.addURI(<span class="string">"mystr"</span>, <span class="string">"insert"</span>, INSERTSUCCESS);</span><br><span class="line">		sURIMather.addURI(<span class="string">"mystr"</span>, <span class="string">"update"</span>, UPDATESUCCESS);</span><br><span class="line">		sURIMather.addURI(<span class="string">"mystr"</span>, <span class="string">"delete"</span>, DELETESUCCESS);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onCreate</span><span class="params">()</span> </span>{	</span><br><span class="line">		myOpenHelper = <span class="keyword">new</span> MyOpenHelper(getContext());</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Cursor <span class="title">query</span><span class="params">(Uri uri, String[] projection, String selection, String[] selectionArgs, String sortOrder)</span> </span>{</span><br><span class="line">		<span class="keyword">int</span> code = sURIMather.math(uri);</span><br><span class="line">		<span class="keyword">if</span> (code == QUERYSUCCESS) { <span class="comment">// 路径匹配成功。不成功返回-1</span></span><br><span class="line">			<span class="comment">// 对数据库进行查询的操作</span></span><br><span class="line">			SQLiteDatabase db = myOpenHelper.getReadableDatabase();</span><br><span class="line"></span><br><span class="line">			<span class="comment">// db.query(table, columns/*别人能访问的列*/, selection, selectionArgs, groupBy, having, orderBy)</span></span><br><span class="line">			Cursor cursor = db.query(<span class="string">"info"</span>, projection, selection, selectionArgs, <span class="keyword">null</span>, <span class="keyword">null</span>. sortOrder);</span><br><span class="line">			<span class="comment">// 注意：cursor 不能管</span></span><br><span class="line"></span><br><span class="line">			<span class="keyword">return</span> cursor;</span><br><span class="line">		} <span class="keyword">else</span> { <span class="comment">// 路径不匹配</span></span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> IlleagalArgumentException(<span class="string">"路径不匹配"</span>);</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getType</span><span class="params">(Uri uri)</span> </span>{</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Uri <span class="title">insert</span><span class="params">(Uri uri, ContentValues values)</span> </span>{</span><br><span class="line">		<span class="keyword">int</span> code = sURIMather.match(uri);</span><br><span class="line">		<span class="keyword">if</span> (code == INSERTSUCCESS) {</span><br><span class="line">			<span class="comment">// 路径匹配成功，操作数据库</span></span><br><span class="line">			SQLiteDatabase db = myOpenHelper.getReadableDatabase();</span><br><span class="line">			<span class="keyword">long</span> ins = db.insert(<span class="string">"info"</span><span class="comment">/*表名*/</span>, <span class="keyword">null</span>, values<span class="comment">/*map&lt;String, String&gt;类型*/</span>); <span class="comment">// 返回插入的行数ID</span></span><br><span class="line"></span><br><span class="line">			Uri uri2 = Uri.parse(<span class="string">"插入的行号："</span> + ins);</span><br><span class="line">			<span class="keyword">return</span> uri2;</span><br><span class="line">		} <span class="keyword">else</span> { <span class="comment">// 路径不匹配</span></span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> IlleagalArgumentException(<span class="string">"路径不匹配"</span>);</span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">delete</span><span class="params">(Uri uri, String selection, String[] selectionArgs)</span> </span>{</span><br><span class="line">		<span class="keyword">int</span> code = sURIMather.match(uri);</span><br><span class="line">		<span class="keyword">if</span> (code == DELETESUCCESS) {</span><br><span class="line">			<span class="comment">// 路径匹配成功，操作数据库</span></span><br><span class="line">			SQLiteDatabase db = myOpenHelper.getReadableDatabase();</span><br><span class="line">			<span class="keyword">int</span> del = db.delete(<span class="string">"info"</span>, selection, selectionArgs); <span class="comment">// 返回删除的行数</span></span><br><span class="line"></span><br><span class="line">			<span class="keyword">return</span> del; <span class="comment">// 返回的类型就是 int</span></span><br><span class="line">		} <span class="keyword">else</span> { <span class="comment">// 路径不匹配</span></span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> IlleagalArgumentException(<span class="string">"路径不匹配"</span>);</span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">delete</span><span class="params">(Uri uri, ContentValues values, String selection, String[] selectionArgs)</span> </span>{</span><br><span class="line">		<span class="keyword">int</span> code = sURIMather.match(uri);</span><br><span class="line">		<span class="keyword">if</span> (code == DELETESUCCESS) {</span><br><span class="line">			<span class="comment">// 路径匹配成功，操作数据库</span></span><br><span class="line">			SQLiteDatabase db = myOpenHelper.getReadableDatabase();</span><br><span class="line">			<span class="keyword">int</span> upd = db.delete(<span class="string">"info"</span>, values, selection, selectionArgs); <span class="comment">// 返回影响的行数</span></span><br><span class="line"></span><br><span class="line">			<span class="keyword">return</span> upd; <span class="comment">// 返回的类型就是 int</span></span><br><span class="line">		} <span class="keyword">else</span> { <span class="comment">// 路径不匹配</span></span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> IlleagalArgumentException(<span class="string">"路径不匹配"</span>);</span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>app2</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">toInsert</span><span class="params">()</span> </span>{</span><br><span class="line">	Uri uri = Uri.parse(<span class="string">"cintent://mystr/insert"</span>);</span><br><span class="line">	ContentValues values = <span class="keyword">new</span> ContentValues();</span><br><span class="line">	values.put(<span class="string">"name"</span>, <span class="string">"123"</span>);</span><br><span class="line">	values.put(<span class="string">"money"</span>, <span class="string">"100"</span>);</span><br><span class="line">	Uri ins = getContentResolver().insert(uri, values);</span><br><span class="line">	System.out.println(<span class="string">"insert:"</span>+ins);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">toDelete</span><span class="params">()</span> </span>{</span><br><span class="line">	Uri uri = Uri.parse(<span class="string">"cintent://mystr/delete"</span>);</span><br><span class="line">	<span class="keyword">int</span> del = getContentResolver().insert(uri, <span class="string">"name=?"</span>, <span class="keyword">new</span> String[]{<span class="string">"asd"</span>});</span><br><span class="line">	Toast.makeText(getApplicationContext(), <span class="string">"delete:"</span>+del, <span class="number">1</span>).show();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">toUpdate</span><span class="params">()</span> </span>{</span><br><span class="line">	Uri uri = Uri.parse(<span class="string">"cintent://mystr/insert"</span>);</span><br><span class="line">	ContentValues values = <span class="keyword">new</span> ContentValues();</span><br><span class="line">	values.put(<span class="string">"money"</span>, <span class="string">"100"</span>);</span><br><span class="line">	<span class="keyword">int</span> upd = getContentResolver().update(uri, values, <span class="string">"nname=?"</span>, <span class="keyword">new</span> String[]{<span class="string">"asd"</span>});</span><br><span class="line">	Toast.makeText(getApplicationContext(), <span class="string">"update:"</span>+upd, <span class="number">1</span>).show();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="备份短信"><a href="#备份短信" class="headerlink" title="备份短信"></a>备份短信</h3><p>权限：<code>WRITE_SMS</code> <code>READ_SMS</code> <code>READ_EXTERNAL_STORAGE</code></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 短信数据库已经通过内容提供者暴露出来了</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">sms_backup</span><span class="params">()</span> </span>{</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 获取 xml 序列化实例</span></span><br><span class="line">	XmlSerializer serializer = Xml.newSerializer();</span><br><span class="line">	<span class="comment">// 设置序列化参数</span></span><br><span class="line">	File file = <span class="keyword">new</span> File(Environment.getExternalStorageDirectory().getPath(), <span class="string">"smsBackup.xml"</span>);</span><br><span class="line">	FileOutputStream fos = <span class="keyword">new</span> FileOutputStream（file);</span><br><span class="line">	serializer.setOutput(fos, <span class="string">"utf-8"</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 开始写 xml 文档的开头</span></span><br><span class="line">	serializer.startDocument(<span class="string">"utf-8"</span>, <span class="keyword">true</span>);</span><br><span class="line">	{</span><br><span class="line">		<span class="comment">// 开始写根节点</span></span><br><span class="line">		serializer.startTag(<span class="keyword">null</span>, <span class="string">"smss"</span>);</span><br><span class="line">		{</span><br><span class="line">			Uri uri = Uri.parse(<span class="string">"content://sms/"</span>) <span class="comment">// 不写后面的参数表示查询所有</span></span><br><span class="line">			Cursor cursor = getContentResolver().query(uri, <span class="keyword">new</span> String[]{<span class="string">"address"</span>, <span class="string">"date"</span>, <span class="string">"body"</span>}, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">			<span class="keyword">while</span> (cursor.moveToNext()) {</span><br><span class="line">				String address = cursor.getString(<span class="number">0</span>);</span><br><span class="line">				String date = cursor.getString(<span class="number">1</span>);</span><br><span class="line">				String body = cursor.getString(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">				<span class="comment">// 写 sms 节点</span></span><br><span class="line">				serializer.startTag(<span class="keyword">null</span>, <span class="string">"sms"</span>);</span><br><span class="line">				{</span><br><span class="line">					<span class="comment">// 写 address 节点</span></span><br><span class="line">					serializer.startTag(<span class="keyword">null</span>, <span class="string">"address"</span>);</span><br><span class="line">					serializer.text(address);</span><br><span class="line">					serializer.endTag(<span class="keyword">null</span>, <span class="string">"address"</span>);</span><br><span class="line"></span><br><span class="line">					<span class="comment">// 写 body 节点</span></span><br><span class="line">					serializer.startTag(<span class="keyword">null</span>, <span class="string">"body"</span>);</span><br><span class="line">					serializer.text(body);</span><br><span class="line">					serializer.endTag(<span class="keyword">null</span>, <span class="string">"body"</span>);</span><br><span class="line"></span><br><span class="line">					<span class="comment">// 写 date 节点</span></span><br><span class="line">					serializer.startTag(<span class="keyword">null</span>, <span class="string">"date"</span>);</span><br><span class="line">					serializer.text(date);</span><br><span class="line">					serializer.endTag(<span class="keyword">null</span>, <span class="string">"date"</span>);</span><br><span class="line">				}</span><br><span class="line">				serializer.endTag(<span class="keyword">null</span>, <span class="string">"sms"</span>);</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">		serializer.endTag(<span class="keyword">null</span>, <span class="string">"smss"</span>);</span><br><span class="line">	}</span><br><span class="line">	serializer.endDocument();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="插入短信"><a href="#插入短信" class="headerlink" title="插入短信"></a>插入短信</h3><p>通过内容提供者在短信的私有数据库中插入一条短信</p>
<p>权限：<code>WRITE_SMS</code> <code>READ_SMS</code></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Uri uri = Uri.parse(<span class="string">"content://sms"</span>);</span><br><span class="line">ContentValues values = <span class="keyword">new</span> ContentValues();</span><br><span class="line">values.put(<span class="string">"address"</span>, <span class="string">"110"</span>);</span><br><span class="line">values.put(<span class="string">"body"</span>, <span class="string">"报警"</span>);</span><br><span class="line">values.put(<span class="string">"date"</span>, System.currentTimeMillis());</span><br><span class="line">getContentResolver().insert(uri, values);</span><br></pre></td></tr></tbody></table></figure>

<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
        </div>

        <blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    最后更新：<time datetime="2019-10-13T02:34:09.949Z" itemprop="dateUpdated">2019-10-13 10:34:09</time>
</span>


        
        原文链接：<a href="/2018/12/19/Android-学习笔记/" target="_blank" rel="external">http://blog.iwxyi.com/2018/12/19/Android-学习笔记/</a>
        
    </div>
    <footer>
        <div onclick="location.href='http://blog.iwxyi.com'">
            <img src="/img/avatar.jpg" alt="小乂">
            <a>小乂</a>
        </div>
    </footer>
</blockquote>

        
    <div class="page-reward">
        <nav class="myreward">
            <a id="rewardBtn" href="javascript:;"><span>打&nbsp;赏</span><span>装成好像很多人打赏的样子</span></a>
        </nav>
    </div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/学习笔记/">学习笔记</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://blog.iwxyi.com/2018/12/19/Android-学习笔记/&title=《Android-学习笔记》 — 云笺&pic=http://blog.iwxyi.com/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.iwxyi.com/2018/12/19/Android-学习笔记/&title=《Android-学习笔记》 — 云笺&source=基础工具adb 命令
adb kill-server 杀死模拟器
adb start-server 启动模拟器
cd desktop 进入桌面文件夹
ad..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.iwxyi.com/2018/12/19/Android-学习笔记/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Android-学习笔记》 — 云笺&url=http://blog.iwxyi.com/2018/12/19/Android-学习笔记/&via=http://blog.iwxyi.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://blog.iwxyi.com/2018/12/19/Android-学习笔记/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2018/12/19/Android漂亮的对话框sweet-alert/" id="post-prev" class="post-nav-link">
        <h4 class="title" >
          上一篇：Android漂亮的对话框sweet-alert
        </h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2018/12/18/PHP-学习笔记/" id="post-next" class="post-nav-link">
        <h4 class="title" data-hover="下一篇：PHP-学习笔记">下一篇：PHP-学习笔记</h4>
      </a>
    </div>
  
</nav>



    
    

    

    
    <!-- Valine Comments -->
    <div class="comments vcomment" id="comments"></div>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script>
    <!-- Valine Comments script -->
    <script>
        var GUEST_INFO = ['nick','mail','link'];
        var guest_info = 'nick,mail,link'.split(',').filter(function(item){
          return GUEST_INFO.indexOf(item) > -1
        });
        new Valine({
            el: '#comments',
            notify: 'true' == 'true',
            verify: 'false' == 'true',
            appId: "sVjY7bBJXEfCtStMqASgnlL6-gzGzoHsz",
            appKey: "8mL43PwxikVMVpiQx4Pq7wwt",
            avatar: "mm",
            placeholder: "留下您宝贵的建议——",
            guest_info: guest_info.length == 0 ? GUEST_INFO : guest_info,
            pageSize: "10"
        })
    </script>
    <!-- Valine Comments end -->



</article>

</div>

        <footer class="footer">
    <div class="footer-content">
        <span class="power">
            <i class="icon icon-lg icon-copyright"></i>
            2019
            <i class="icon icon-lg icon-heart"></i>
            <a href="http://blog.iwxyi.com">http://blog.iwxyi.com</a>
            <br/>
            Power by
            <a href="https://hexo.io/" target="_blank" rel="external nofollow">Hexo</a>&nbsp;·&nbsp;
            Theme
            <a class="tomotoeslink" href="https://github.com/tomotoes/hexo-theme-tomotoes/" target="_blank" rel="external nofollow">tomotoes</a>
        </span>

        <br/>

        <span id="RunTime" style="color:#a7a7a2;"></span>
        <br/>

        <span>
            
	<i class="icon icon-lg icon-user">
<span id="busuanzi_container_site_uv" style='display:none'>
       访问用户：<span id="busuanzi_value_site_uv"></span>
    </span>人</i>
    ·
    <i class="icon icon-lg icon-eye">
    <span id="busuanzi_container_site_pv" style='display:none'>
      访问次数：<span id="busuanzi_value_site_pv"></span>
    </span>次
    </i>


        </span>
        <br/>

        <span class="license"><a  target="_blank" rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">博客内容遵循 知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
    </div>
</footer>

    </main>
    
        
<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        <span>感谢您的鼓励支持！</span>
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" data-img="/img/dog.png" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.png" data-alipay="/img/alipay.png">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechatPay">&nbsp;&nbsp;微信&nbsp;&nbsp;</span>
                <span class="reward-toggle-item alipayPay">支付宝</span>
            </div>
        </label>
        
        <i class="icon icon-caret-up"></i>
    </div>
</div>


    
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://blog.iwxyi.com/2018/12/19/Android-学习笔记/&title=《Android-学习笔记》 — 云笺&pic=http://blog.iwxyi.com/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.iwxyi.com/2018/12/19/Android-学习笔记/&title=《Android-学习笔记》 — 云笺&source=基础工具adb 命令
adb kill-server 杀死模拟器
adb start-server 启动模拟器
cd desktop 进入桌面文件夹
ad..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.iwxyi.com/2018/12/19/Android-学习笔记/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Android-学习笔记》 — 云笺&url=http://blog.iwxyi.com/2018/12/19/Android-学习笔记/&via=http://blog.iwxyi.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://blog.iwxyi.com/2018/12/19/Android-学习笔记/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p class="wechatshare">扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACLElEQVR42u3a0W6DMAxGYd7/pdntpi30/DZMwjm5qlpK8lHJdewcBx7nYnz/lFz5+/rVLMcTQ4YMGa9lnJdjdc31glbLIgDyUP64jwwZMjZgrG7Nr+mH5s68MmTIkLGantyHh2MZMmTIeJrRWkQplZQhQ8ZuDJ7SdQp2tQdx815chgwZL2TUFvE/rx/pb8iQIeNVjDMcaQBNQ+RZGjJkyJjN4AGuv3Hlm9XiemTIkDGUwQ838ODIC2fXAZqHchkyZOzAIKkef50eTq3N9eMdGTJkjGZ0Gpn8U344gz8UVBeUIUPGIEaaoqVhulaGS9+XIUPGVAZZEC9+1SIhD7vod5AhQ8Y4RuewRecR8O+mD0iGDBnzGP3Eji+OJ52knfmhMSBDhoxBjLQQf1dCWftP+HB/GTJkbMZIF5o2JmsV/rjoJkOGjEEMPjEJgp3DFrUHKkOGjB0YfBtZO9p1TbqtaihDhoyhjBOMWnORLC7+T0hDrQwZMkYwaptYHhw7yWLarpAhQ8YODH78q3PMq9aKQAmoDBkyNmPU0sQ0fPOyXdDfkCFDxmjGXY1G3tpM50UBV4YMGeMYZzg6ySK/Q0yVIUPGaAYftYI+X2I/6ZQhQ8ZsRtpiTAttvAyXBlwZMmTsxuCBj5f7eVKYbp6XAVeGDBkySptMvj1ubVllyJAhA+yDecCt3RltYmXIkDGaQUJhp9FYazDwWWTIkDGbkeZdtU1vrc3QmUWGDBkjGF9JtEupN+OYlgAAAABJRU5ErkJggg==" alt="微信分享二维码">
</div>




    <!-- waves按钮特效 -->
<script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>

<!-- 主题配置脚本 -->
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };
</script>

<!-- jquery -->
<script src="/js/jquery.min.js?v=3.0"></script>

<!-- 搜索 -->

<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item waves-block waves-effect" onclick="location.href='{path}'">
    <div class="title ellipsis" title="{title}">{title}</div>
</li>
</template>


<!-- main博客脚本 -->
<script src="/js/main.min.js?v=3.0" ></script>

<!-- 动画&配置 -->
<script src="/js/script.min.js?v=3.0" ></script>

<!-- 脚本管理 -->
<script>

if(window.innerWidth > 800){
	/* 3D标题 */
	$(".content-header").on("mousemove", threedee);

	/* 底部追随鼠标 */
	$(".footer").hover(2);

	/* gotop键的涟漪 */
	$("#gotop").hover(1);

	/* 赞赏的粒子雨 */
	$("#reward").hover(3);

	/* 微信公众号的底部渲染 */
	$("#wechat").hover(4);

    /* 标题跳动 */
    $(".archivestitle").bumpyText();

	/* 图片点击放大 */
	const postimg = jQuery(".post-content img:not(.github-emoji)");
	postimg.on("click",function(){

		mask.classList.add("in");
		main.classList.add("Mask");
		menu.classList.add("Mask");
		var myimg = this.cloneNode(true);
		myimg.classList.add("imgShow");

		setTimeout(function(){
			jQuery(myimg).animate({
				opacity:"1"
			},1000);
		},0);

		document.body.appendChild(myimg);

		myimg.onclick=function(){
			document.body.removeChild(myimg);
			mask.classList.remove("in");
			main.classList.remove("Mask");
			menu.classList.remove("Mask");
		};

	});

}

/* 名字跳动 */
$("#name").bumpyText();


/* 网站运行时间 */
setInterval(function () {
	setTime("2019/10/11");
}, 1000);

/* 文章块的淡出 */
postshow();

/* 座右铭 */

   getHitokoto();



/* 粘贴提示 */
G($(".post-content"), location.href, "小乂");


/* 控制台 */
if (window.console && window.console.log) {
	setTimeout(function () {
		console.log("\n %c 一个坏掉的番茄 %c  © Simon Ma  http://tomotoes.com \n\n", "color:#FFFFFB;background:#1abc9c;padding:5px 0;border-radius:.5rem 0 0 .5rem;", "color:#FFFFFB;background:#080808;padding:5px 0;border-radius:0 .5rem .5rem 0;");
	}, 0);
}

</script>




<!-- 公式渲染 -->



<!-- 不蒜子 -->

<script defer src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>


<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/z16.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":false}});</script></body>
</html>
