<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
    <meta http-equiv="Content-Language" content="zh-cn">
    <meta charset="utf-8">
    
    
    <link rel="canonical" href="http://blog.iwxyi.com/2018/11/04/ThinkPHP5-学习笔记/">
    
    
    <title>ThinkPHP5-学习笔记 | 云笺 | 一些技术摘要和写作技巧</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
    
    <meta name="theme-color" content="#77AAFF">
    
    
    <meta name="keywords" content="PHP,学习笔记,ThinkPHP">
    
    

    

    <!-- Baidu Push -->
<script>
	(function(){
		var bp = document.createElement('script');
		var curProtocol = window.location.protocol.split(':')[0];
		if (curProtocol === 'https') {
			bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
		}
		else {
			bp.src = 'http://push.zhanzhang.baidu.com/push.js';
		}
		var s = document.getElementsByTagName("script")[0];
		s.parentNode.insertBefore(bp, s);
	})();

	var _hmt = _hmt || [];
</script>



    
    <meta name="description" content="运行单一入口：index.php12345&amp;lt;?phpdefine(&apos;APP_DEBUG&apos;, true);define(&apos;APP_NAME&apos;, &apos;App&apos;);         // 定义应用名称define(&apos;APP_PATH&apos;, &apos;./App2&apos;);      // 应用路径，生成目录下 /App/ 文件夹，注意别忘了最后的斜线require &apos;./ThinkPHP/ThinkPHP.php">
<meta name="keywords" content="PHP,学习笔记,ThinkPHP">
<meta property="og:type" content="article">
<meta property="og:title" content="ThinkPHP5-学习笔记">
<meta property="og:url" content="http://blog.iwxyi.com/2018/11/04/ThinkPHP5-学习笔记/index.html">
<meta property="og:site_name" content="云笺">
<meta property="og:description" content="运行单一入口：index.php12345&amp;lt;?phpdefine(&apos;APP_DEBUG&apos;, true);define(&apos;APP_NAME&apos;, &apos;App&apos;);         // 定义应用名称define(&apos;APP_PATH&apos;, &apos;./App2&apos;);      // 应用路径，生成目录下 /App/ 文件夹，注意别忘了最后的斜线require &apos;./ThinkPHP/ThinkPHP.php">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-10-13T08:43:59.864Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ThinkPHP5-学习笔记">
<meta name="twitter:description" content="运行单一入口：index.php12345&amp;lt;?phpdefine(&apos;APP_DEBUG&apos;, true);define(&apos;APP_NAME&apos;, &apos;App&apos;);         // 定义应用名称define(&apos;APP_PATH&apos;, &apos;./App2&apos;);      // 应用路径，生成目录下 /App/ 文件夹，注意别忘了最后的斜线require &apos;./ThinkPHP/ThinkPHP.php">
    
        <link rel="alternate" type="application/atom+xml" title="云笺" href="/atom.xml">
    
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link id="style" rel="stylesheet" href="/css/style.css?v=3.0">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    
            
</head>

<body>
    <div id="loading" class="active"></div>
    <aside id="menu"  class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" >
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg" alt="avatar">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname" id="name">命燃芯乂</h5>
          
            <div id="yiyanmotto" class="motto">&nbsp;</div>
          
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
              <li class="waves-block waves-effect">
                  <a href="/"  >
                    <i class="icon icon-lg icon-home"></i>
                    <span>主 页</span><i class="icon icon-lg icon-caret-left"></i>
                  </a>
              </li>
            
              <li class="waves-block waves-effect">
                  <a href="/archives"  >
                    <i class="icon icon-lg icon-archives"></i>
                    <span>归 档</span><i class="icon icon-lg icon-caret-left"></i>
                  </a>
              </li>
            
              <li class="waves-block waves-effect">
                  <a href="/categories"  >
                    <i class="icon icon-lg icon-th-list"></i>
                    <span>分 类</span><i class="icon icon-lg icon-caret-left"></i>
                  </a>
              </li>
            
              <li class="waves-block waves-effect">
                  <a href="/tags"  >
                    <i class="icon icon-lg icon-tags"></i>
                    <span>标 签</span><i class="icon icon-lg icon-caret-left"></i>
                  </a>
              </li>
            
              <li class="waves-block waves-effect">
                  <a href="/about"  >
                    <i class="icon icon-lg icon-smile-o"></i>
                    <span>关 于</span><i class="icon icon-lg icon-caret-left"></i>
                  </a>
              </li>
            
      <div class="nav2">
          
              <a class="nav2item" data-title="Email" href="mailto:wxy@iwxyi.com" target="_parent"title="Email" >
                <i class="icon icon-lg icon-envelope-o envelope-o"></i>
              </a>
          
              <a class="nav2item" data-title="Github" href="https://github.com/mrxy001" target="_blank"title="Github" >
                <i class="icon icon-lg icon-github github"></i>
              </a>
          
              <a class="nav2item" data-title="微博" href="https://weibo.com/u/6065548594" target="_blank"title="微博" >
                <i class="icon icon-lg icon-weibo weibo"></i>
              </a>
          

            </div>
        
      </ul>
        
    </div>
  </div>
 
</aside>


    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">ThinkPHP5-学习笔记</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        <a href="../../atom.xml" target="_blank" class="header-icon waves-effect waves-circle waves-light" id="Rss">
            <i class="icon icon-lg icon-rss"></i>
        </a>
    </div>
</header>
<header class="content-header post-header">
    
    
    <div class="container fade-scale">
        <div id="myheader">
            <h1 class="title">
                
            </h1>
            <h5 class="subtitle">
                
                
            </h5>
        </div>
    </div>

</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#运行"><span class="post-toc-number">1.</span> <span class="post-toc-text">运行</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#单一入口：index-php"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">单一入口：index.php</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#运行流程：索引控制器"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">运行流程：索引控制器</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#目录结构解析"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">目录结构解析</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#ThinkPHP-配置文件"><span class="post-toc-number">2.</span> <span class="post-toc-text">ThinkPHP 配置文件</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#全局设置"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">全局设置</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#每个程序的设置"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">每个程序的设置</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#用户自定义配置文件"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">用户自定义配置文件</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#URL-模式"><span class="post-toc-number">3.</span> <span class="post-toc-text">URL 模式</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#U-方法"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">U() 方法</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#示例"><span class="post-toc-number">3.1.1.</span> <span class="post-toc-text">示例</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#修改URL模式"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">修改URL模式</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#模式说明"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">模式说明</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#隐藏-index-php"><span class="post-toc-number">3.4.</span> <span class="post-toc-text">隐藏 index.php</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#URL-伪静态"><span class="post-toc-number">3.5.</span> <span class="post-toc-text">URL 伪静态</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#自定义函数库"><span class="post-toc-number">3.6.</span> <span class="post-toc-text">自定义函数库</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#模板技术"><span class="post-toc-number">4.</span> <span class="post-toc-text">模板技术</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#建立项目模板"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">建立项目模板</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#使用模板"><span class="post-toc-number">4.1.1.</span> <span class="post-toc-text">使用模板</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#模板的赋值和输出"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">模板的赋值和输出</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#方法一：display"><span class="post-toc-number">4.2.1.</span> <span class="post-toc-text">方法一：display()</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#方法二：assign"><span class="post-toc-number">4.2.2.</span> <span class="post-toc-text">方法二：assign()</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#模板引擎"><span class="post-toc-number">4.3.</span> <span class="post-toc-text">模板引擎</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#变量运算和输出"><span class="post-toc-number">4.3.1.</span> <span class="post-toc-text">变量运算和输出</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#调用函数和系统参数"><span class="post-toc-number">4.3.2.</span> <span class="post-toc-text">调用函数和系统参数</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#volist和foreach循环"><span class="post-toc-number">4.3.3.</span> <span class="post-toc-text">volist和foreach循环</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#for循环"><span class="post-toc-number">4.3.4.</span> <span class="post-toc-text">for循环</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#if-判断"><span class="post-toc-number">4.3.5.</span> <span class="post-toc-text">if 判断</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#switch-判断"><span class="post-toc-number">4.3.6.</span> <span class="post-toc-text">switch 判断</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#比较标签"><span class="post-toc-number">4.3.7.</span> <span class="post-toc-text">比较标签</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#区间标签"><span class="post-toc-number">4.3.8.</span> <span class="post-toc-text">区间标签</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#三元运算符"><span class="post-toc-number">4.3.9.</span> <span class="post-toc-text">三元运算符</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#案例实战"><span class="post-toc-number">4.3.10.</span> <span class="post-toc-text">案例实战</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#原生态PHP标签"><span class="post-toc-number">4.3.11.</span> <span class="post-toc-text">原生态PHP标签</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#ThinkPHP调试方法"><span class="post-toc-number">4.4.</span> <span class="post-toc-text">ThinkPHP调试方法</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#数据库"><span class="post-toc-number">5.</span> <span class="post-toc-text">数据库</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#连接数据库"><span class="post-toc-number">5.1.</span> <span class="post-toc-text">连接数据库</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#实例化模型"><span class="post-toc-number">5.2.</span> <span class="post-toc-text">实例化模型</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1、实例化基础模型"><span class="post-toc-number">5.2.1.</span> <span class="post-toc-text">1、实例化基础模型</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2、实例化用户自定义模型"><span class="post-toc-number">5.2.2.</span> <span class="post-toc-text">2、实例化用户自定义模型</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3、实例化公共模型"><span class="post-toc-number">5.2.3.</span> <span class="post-toc-text">3、实例化公共模型</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#用户自定义公共模型"><span class="post-toc-number">5.2.3.1.</span> <span class="post-toc-text">用户自定义公共模型</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4、实例化空模型"><span class="post-toc-number">5.2.4.</span> <span class="post-toc-text">4、实例化空模型</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#CURD操作"><span class="post-toc-number">5.3.</span> <span class="post-toc-text">CURD操作</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#插入数据"><span class="post-toc-number">5.3.1.</span> <span class="post-toc-text">插入数据</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#插入多条数据"><span class="post-toc-number">5.3.1.1.</span> <span class="post-toc-text">插入多条数据</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#查询数据"><span class="post-toc-number">5.3.2.</span> <span class="post-toc-text">查询数据</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#更新数据"><span class="post-toc-number">5.3.3.</span> <span class="post-toc-text">更新数据</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#删除数据"><span class="post-toc-number">5.3.4.</span> <span class="post-toc-text">删除数据</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#连贯操作"><span class="post-toc-number">5.4.</span> <span class="post-toc-text">连贯操作</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#排序-order"><span class="post-toc-number">5.4.1.</span> <span class="post-toc-text">排序 order</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#筛选数据-field"><span class="post-toc-number">5.4.2.</span> <span class="post-toc-text">筛选数据 field</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#限制数据量-limit-和-page"><span class="post-toc-number">5.4.3.</span> <span class="post-toc-text">限制数据量 limit 和 page</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#分组-group-和-having"><span class="post-toc-number">5.4.4.</span> <span class="post-toc-text">分组 group 和 having</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#多表查询"><span class="post-toc-number">5.5.</span> <span class="post-toc-text">多表查询</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#table-方法"><span class="post-toc-number">5.5.1.</span> <span class="post-toc-text">table 方法</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#join-方法"><span class="post-toc-number">5.5.2.</span> <span class="post-toc-text">join 方法</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#union-方法"><span class="post-toc-number">5.5.3.</span> <span class="post-toc-text">union 方法</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#过滤查询-distinct"><span class="post-toc-number">5.5.4.</span> <span class="post-toc-text">过滤查询 distinct</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#关于命名范围的使用"><span class="post-toc-number">6.</span> <span class="post-toc-text">关于命名范围的使用</span></a></li></ol>
        </nav>
    </aside>
   
<article id="post-ThinkPHP5-学习笔记"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">ThinkPHP5-学习笔记</h1>
        <div class="post-meta">
            <i class="icon icon-lg icon-calendar-o"></i>
            发表于
            <time class="post-time" title="2018-11-04 16:36:00" datetime="2018-11-04T08:36:00.000Z"  itemprop="datePublished">2018-11-04</time>

            <br id="mybreak"/>
            
	<i class="icon icon-lg icon-folder-o"></i>
	分类：<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Code/">Code</a></li></ul>


            <i>·</i>
            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>次浏览
</span>


        </div>
        <div class="post-count-custom">
            <i class="icon icon-lg icon-comment-o"></i>
            阅读本文可能花费您&nbsp;<span class="post-count">22</span>&nbsp;分钟
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h1 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h1><h2 id="单一入口：index-php"><a href="#单一入口：index-php" class="headerlink" title="单一入口：index.php"></a>单一入口：index.php</h2><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">define(<span class="string">'APP_DEBUG'</span>, <span class="keyword">true</span>);</span><br><span class="line">define(<span class="string">'APP_NAME'</span>, <span class="string">'App'</span>);         <span class="comment">// 定义应用名称</span></span><br><span class="line">define(<span class="string">'APP_PATH'</span>, <span class="string">'./App2'</span>);      <span class="comment">// 应用路径，生成目录下 /App/ 文件夹，注意别忘了最后的斜线</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'./ThinkPHP/ThinkPHP.php'</span>; <span class="comment">// 加载 ThinkPHP</span></span><br></pre></td></tr></tbody></table></figure>

<a id="more"></a>

<h2 id="运行流程：索引控制器"><a href="#运行流程：索引控制器" class="headerlink" title="运行流程：索引控制器"></a>运行流程：索引控制器</h2><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$module = <span class="keyword">isset</span>($_GET[<span class="string">'m'</span>]) ? $_GET[<span class="string">'m'</span>] : <span class="string">'Index'</span>;</span><br><span class="line">$action = <span class="keyword">isset</span>($_GET[<span class="string">'a'</span>]) ? $_GET[<span class="string">'a'</span>] : <span class="string">'Index'</span>;</span><br><span class="line"></span><br><span class="line">$mooc = <span class="keyword">new</span> $module();</span><br><span class="line">$mooc-&gt;$action();</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">index</span></span></span><br><span class="line"><span class="class"></span>{</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>{<span class="keyword">echo</span> <span class="string">"I'm index controler&lt;br /&gt;"</span>; }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Index</span><span class="params">()</span> </span>{<span class="keyword">echo</span> <span class="string">"这是 index 控制器的 index 方法&lt;br /&gt;"</span>; }</span><br><span class="line">    </span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">test</span><span class="params">()</span> </span>{<span class="keyword">echo</span> <span class="string">"这是 index 控制器的 test 方法&lt;br /&gt;"</span>; }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>在浏览器地址栏输入： <code>网站地址/?m=index&amp;a=index</code> 来访问 index 的 index 方法<br>使用 <code>?m=index&amp;a=test</code> 来访问 index 的 test 方法</p>
<p>也可以多建几个 class 和 function，达到不同的 module 和 function</p>
<h2 id="目录结构解析"><a href="#目录结构解析" class="headerlink" title="目录结构解析"></a>目录结构解析</h2><ul>
<li>Common 存放当前项目的公共函数</li>
<li>Conf         存放当前项目的配置文件</li>
<li>Lang         存放当前项目的语言包</li>
<li>Lib            存放当前项目的控制器和模型 （存放MVC中的M、C）</li>
<li>Runtime   存放当前显示的运行时的文件：\Cache\、\Date\、\Logs\、\Temp\、~runtime.php</li>
<li>Tpl             存放当前项目的模板文件 （存放MVC中的V）</li>
</ul>
<h1 id="ThinkPHP-配置文件"><a href="#ThinkPHP-配置文件" class="headerlink" title="ThinkPHP 配置文件"></a>ThinkPHP 配置文件</h1><h2 id="全局设置"><a href="#全局设置" class="headerlink" title="全局设置"></a>全局设置</h2><p>总的文件路径：<code>\ThinkPHP\Conf\convention.php</code></p>
<h2 id="每个程序的设置"><a href="#每个程序的设置" class="headerlink" title="每个程序的设置"></a>每个程序的设置</h2><p>应用配置路径：<code>\[应用名]\Common\Conf\config.php</code></p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">array</span>(</span><br><span class="line">	<span class="comment">//'配置项'=&gt;'配置值'</span></span><br><span class="line">	<span class="string">'name'</span>=&gt;<span class="string">'Hello'</span></span><br><span class="line">);</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>如果有自定义配置文件，而且入口的 <code>APP_DEBUG</code> 不是为 true 的话，修改了默认的配置文件后，程序不会重新编译，需要重启才能生效。</p>
</blockquote>
<p>控制配置路径：<code>[应用名]\Home\Controller\IndexController.class.php</code></p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// 本类由系统自动生成，仅供测试用途</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Home</span>\<span class="title">Controller</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Think</span>\<span class="title">Controller</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexController</span> <span class="keyword">extends</span> <span class="title">Controller</span> </span>{</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">()</span></span>{</span><br><span class="line">    	<span class="keyword">echo</span> C(<span class="string">'name'</span>); <span class="comment">// 根据上面的配置项，输出 Hello</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>针对每个程序的配置，不会和其他程序公用</p>
</blockquote>
<h2 id="用户自定义配置文件"><a href="#用户自定义配置文件" class="headerlink" title="用户自定义配置文件"></a>用户自定义配置文件</h2><p>配置文件：<code>\[应用名]\Common\Conf\config.php</code></p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">array</span>(</span><br><span class="line">	<span class="comment">//'配置项'=&gt;'配置值'</span></span><br><span class="line">	<span class="string">'name'</span>=&gt;<span class="string">'Hello'</span>,</span><br><span class="line">	<span class="string">'LOAD_EXT_CONFIG'</span>=&gt;<span class="string">'user'</span> <span class="comment">// 加上这一句</span></span><br><span class="line">);</span><br></pre></td></tr></tbody></table></figure>

<p><strong>新建</strong>：<code>\[应用名]\Common\Conf\user.php</code></p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">array</span>(</span><br><span class="line">	<span class="comment">//'配置项'=&gt;'配置值'</span></span><br><span class="line">	<span class="string">'user'</span>=&gt;<span class="string">'UUU'</span></span><br><span class="line">);</span><br></pre></td></tr></tbody></table></figure>

<p>可以直接用 <code>echo C('user');</code> 来输出配置值</p>
<h1 id="URL-模式"><a href="#URL-模式" class="headerlink" title="URL 模式"></a>URL 模式</h1><p><strong>URL_MODEL</strong></p>
<ul>
<li>1 默认模式    pathinfo 模式</li>
<li>0 普通模式</li>
<li>2 重写模式</li>
<li>3 兼容模式</li>
</ul>
<p>在配置文件：<code>[应用名]\Home\Controller\IndexController.class.php</code> 的 index 方法中加上：</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> C(<span class="string">'URL_MODEL'</span>);</span><br></pre></td></tr></tbody></table></figure>

<p>来显示当前的URL模式。</p>
<h2 id="U-方法"><a href="#U-方法" class="headerlink" title="U() 方法"></a>U() 方法</h2><p>U(‘模块/方法’, array(‘id’=&gt;1), ‘xxx html htm sthml’, true/false, ‘localhost’);</p>
<ul>
<li>参数2：URL后面传的值</li>
<li>参数3：后缀</li>
<li>参数4：是否需要跳转，true的话会加上 <a href="http://127.0.0.1前缀，（并直接跳转？）" target="_blank" rel="noopener">http://127.0.0.1前缀，（并直接跳转？）</a></li>
<li>参数5：域名</li>
</ul>
<p>用来显示对应的完整的URL</p>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><p>编辑配置文件：<code>[应用名]\Home\Controller\IndexController.class.php</code></p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// 本类由系统自动生成，仅供测试用途</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Home</span>\<span class="title">Controller</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Think</span>\<span class="title">Controller</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexController</span> <span class="keyword">extends</span> <span class="title">Controller</span> </span>{</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">()</span></span>{</span><br><span class="line">    	<span class="keyword">echo</span> C(<span class="string">'URL_MODEL'</span>) . <span class="string">"&lt;br /&gt;"</span>;</span><br><span class="line">    	<span class="keyword">echo</span> U(<span class="string">'Index/user'</span>, <span class="keyword">array</span>(<span class="string">'id'</span>=&gt;<span class="number">1</span>), <span class="string">'html'</span>, <span class="keyword">false</span>, <span class="string">'localhost'</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">user</span><span class="params">()</span> </span>{</span><br><span class="line">    	<span class="keyword">echo</span> <span class="string">'id:'</span> . $_GET[<span class="string">'id'</span>] . <span class="string">'&lt;br /&gt;'</span>;</span><br><span class="line">    	<span class="keyword">echo</span> <span class="string">"这是 Index 模块的 user 方法"</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>打开网站首页，运行结果：</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">/ThinkPHP/index.php/Home/Index/user/id/1.html</span><br></pre></td></tr></tbody></table></figure>

<p>访问网址<code>localhost/ThinkPHP/index.php/Home/Index/user/id/1.html</code>，出现结果：</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">id:1</span><br><span class="line">这是 Index 模块的 user 方法</span><br></pre></td></tr></tbody></table></figure>

<h2 id="修改URL模式"><a href="#修改URL模式" class="headerlink" title="修改URL模式"></a>修改URL模式</h2><p>程序配置文件 <code>\[应用名]\Common\Conf\config.php</code> 加上配置项：</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'URL_MODEL'</span>=&gt;<span class="number">0</span></span><br></pre></td></tr></tbody></table></figure>

<p>或者可以在全局配置文件 <code>\ThinkPHP\Conf\convention.php</code> 中修改</p>
<h2 id="模式说明"><a href="#模式说明" class="headerlink" title="模式说明"></a>模式说明</h2><p>网站路径为：<a href="http://localhost/ThinkPHP/" target="_blank" rel="noopener">http://localhost/ThinkPHP/</a></p>
<ul>
<li>1 默认模式：<a href="http://localhost/ThinkPHP/index.php/Home/Index/user/id/1.html" target="_blank" rel="noopener">http://localhost/ThinkPHP/index.php/Home/Index/user/id/1.html</a></li>
<li>0 普通模式：<a href="http://localhost/ThinkPHP/index.php?m=Index&amp;a=user&amp;id=1" target="_blank" rel="noopener">http://localhost/ThinkPHP/index.php?m=Index&amp;a=user&amp;id=1</a></li>
<li>2 重写模式：<a href="http://localhost/ThinkPHP/Index/user/id/1.html" target="_blank" rel="noopener">http://localhost/ThinkPHP/Index/user/id/1.html</a>  需要开启Apache的重写</li>
<li>3 兼容模式：<a href="http://localhost/ThinkPHP/index.php?s=/Home/Index/user/id/1.html" target="_blank" rel="noopener">http://localhost/ThinkPHP/index.php?s=/Home/Index/user/id/1.html</a> </li>
</ul>
<h2 id="隐藏-index-php"><a href="#隐藏-index-php" class="headerlink" title="隐藏 index.php"></a>隐藏 index.php</h2><p>即<strong>重写模式</strong></p>
<p>打开 Apache 的配置文件 <code>httpd.conf</code>，搜索 <code>rewrite.so</code> ，去除前面的 “#” 号</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#LoadModule rewrite_module modules/mod_rewrite.so // 去除前面的 # 号</span><br></pre></td></tr></tbody></table></figure>

<p>重启 Apache</p>
<p>项目目录下建立一个文件：<code>.htaccess</code>，写入以下内容：</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;Ifmodule mod_rewrite.c&gt;</span><br><span class="line">RewriteEngine on</span><br><span class="line">RewriteCond %{REQUEST_FILENAME} !-d</span><br><span class="line">RewriteCond %{REQUEST_FILENAME} !-f</span><br><span class="line">RewriteRule ^(.*)$ index.php/$1 [QSA,PT,L]</span><br><span class="line">&lt;/Ifmodule&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>分别是：开启重写引擎、重写判断条件、重写规则（正则）</p>
<blockquote>
<p><strong>404 Not Found : No input file specified</strong></p>
<p>在Fastcgi模式下，php不支持rewrite的目标网址的PATH_INFO的解析，当我们的 ThinkPHP运行在URL_MODEL=2时，就会出现 No input file specified.的情况。<br>这时可以修改网站目录的.htaccess文件：  将 <code>RewriteRule ^(.*)$ index.php/$1 [QSA,PT,L]</code>  改为 <code>RewriteRule ^(.*)$ index.php?s=$1 [QSA,PT,L]</code></p>
</blockquote>
<h2 id="URL-伪静态"><a href="#URL-伪静态" class="headerlink" title="URL 伪静态"></a>URL 伪静态</h2><p>把 shtml 改成和 html 一样作为后缀名来识别</p>
<p>全局配置文件，<code>‘URL_HTML_SUFFIX' =&gt; ‘html’</code></p>
<p>在单个项目配置文件中（不建议改全局）改为：</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">return array(</span><br><span class="line">	// ... =&gt; ...,</span><br><span class="line">	'URL_HTML_SUFFIX' =&gt; ‘html|shtml’</span><br><span class="line">);</span><br></pre></td></tr></tbody></table></figure>

<p>伪静态有益于搜索引擎的抓取</p>
<h2 id="自定义函数库"><a href="#自定义函数库" class="headerlink" title="自定义函数库"></a>自定义函数库</h2><ol>
<li><strong>自动加载自定义函数文件</strong><br>函数文件放在项目公共目录<strong>Common</strong>下。<br>项目目录下，需要在配置文件<code>Conf/config.php</code>配置自动加载的函数文件的文件名。配置项为<code>"LOAD_EXT_FILE"</code>，如<code>"LOAD_EXT_FILE"=&gt;"user,mysqldb"</code>表示在项目目录下<code>Common/user.php</code>和<code>Common/mysqldb.php</code>两个文件会自动加载。自动加载多项用逗号隔开。</li>
<li><strong>手动加载函数文件</strong><br>使用load函数，如<code>load('@.myfunction');</code>表示系统会加载<code>Common/myfunction.php</code>这个文件。</li>
<li><strong>自动加载自定义类文件</strong><br>类文件放在项目类库<strong>Lib</strong>下。<br>项目目录下，需要在配置文件<code>Conf/conf.php</code>配置自动加载的函数文件的文件夹。配置项为<code>'APP_AUTOLOAD_PATH' =&gt;'‘,</code> ，如<code>'APP_AUTOLOAD_PATH' =&gt;'@.Common'</code>,表示在项目目录下<code>Lib/Common</code>文件夹下的类文件都会被自动加载，当然，类文件名要以<code>***.class.php</code>文件命名。 自动加载多项用逗号隔开。</li>
<li><strong>手动加载类文件</strong><br>使用<code>import()</code>函数。如 <code>import('@.Common.mysqldb');</code>则系统会加载<code>Lib/Common/mysqldb.class.php</code>文件</li>
</ol>
<h1 id="模板技术"><a href="#模板技术" class="headerlink" title="模板技术"></a>模板技术</h1><h2 id="建立项目模板"><a href="#建立项目模板" class="headerlink" title="建立项目模板"></a>建立项目模板</h2><p><strong>模板路径</strong>： <code>\[应用名]\Home\View\模块名\方法名.html</code></p>
<p>例如 Index 模块的 index 方法：<code>\Application\Home\View\Index\index.html</code></p>
<h3 id="使用模板"><a href="#使用模板" class="headerlink" title="使用模板"></a>使用模板</h3><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">$this</span>-&gt;display();              <span class="comment">// 默认 Index/index</span></span><br><span class="line"><span class="keyword">$this</span>-&gt;display(<span class="string">""</span>);            <span class="comment">// 等同于上一个</span></span><br><span class="line"><span class="keyword">$this</span>-&gt;display(<span class="string">"Index/test"</span>);  <span class="comment">// 非默认模块方法</span></span><br><span class="line"><span class="keyword">$this</span>-&gt;display(<span class="string">"test"</span>);        <span class="comment">// 默认的模块 Index 可省略</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="模板的赋值和输出"><a href="#模板的赋值和输出" class="headerlink" title="模板的赋值和输出"></a>模板的赋值和输出</h2><h3 id="方法一：display"><a href="#方法一：display" class="headerlink" title="方法一：display()"></a>方法一：display()</h3><p><code>\[应用名]\Home\Controller\IndexController.class.php</code>：</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Home</span>\<span class="title">Controller</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Think</span>\<span class="title">Controller</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexController</span> <span class="keyword">extends</span> <span class="title">Controller</span> </span>{</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">()</span></span>{</span><br><span class="line">    	$name = <span class="string">'WXY'</span>;</span><br><span class="line">    	<span class="keyword">$this</span>-&gt;myname = $name;</span><br><span class="line">    	<span class="keyword">$this</span>-&gt;display();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><code>\[应用名]\Home\View\Index\index.html</code>：</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">    Hello World~</span><br><span class="line">    <span class="meta">&lt;?php</span></span><br><span class="line">        <span class="keyword">echo</span> $myname;</span><br><span class="line">    <span class="meta">?&gt;</span></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>结果：</p>
<p>Hello World~WXY</p>
<h3 id="方法二：assign"><a href="#方法二：assign" class="headerlink" title="方法二：assign()"></a>方法二：assign()</h3><p><code>$this-&gt;assign('变量名', 变量值);</code></p>
<p>\Home\Controller\IndexController.class.php：</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$date = date(<span class="string">"Y-m-d"</span>);</span><br><span class="line"><span class="keyword">$this</span>-&gt;assign(<span class="string">'today'</span>, $date)-&gt;assign(<span class="string">'weather'</span>, <span class="string">'sun'</span>); <span class="comment">// 可连起来</span></span><br><span class="line"><span class="keyword">$this</span>-&gt;display();</span><br></pre></td></tr></tbody></table></figure>

<p>与直接赋值的区别在于，可以多次<strong>连续赋值</strong></p>
<h2 id="模板引擎"><a href="#模板引擎" class="headerlink" title="模板引擎"></a>模板引擎</h2><p><code>ThinkTemplate.class.php</code> ：<em>（文件位置未找到）</em></p>
<h3 id="变量运算和输出"><a href="#变量运算和输出" class="headerlink" title="变量运算和输出"></a>变量运算和输出</h3><p>控制  <code>\Home\Controller\IndexController.class.php</code>：</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Home</span>\<span class="title">Controller</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Think</span>\<span class="title">Controller</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexController</span> <span class="keyword">extends</span> <span class="title">Controller</span> </span>{</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">()</span></span>{</span><br><span class="line">    	$me[<span class="string">'name'</span>] = <span class="string">'WXY'</span>;</span><br><span class="line">        $me[<span class="string">'age'</span>] = <span class="string">'20'</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;assign(<span class="string">'me'</span>, $me);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;display();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>模板  <code>\[应用名]\Home\View\Index\index.html</code>：</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Hello World~ &lt;br /&gt;</span><br><span class="line">{$me['name']} &lt;br /&gt;</span><br><span class="line">{$me.name} &lt;br /&gt;</span><br><span class="line">{//$me.sex 空的是输出不了的} &lt;br /&gt;</span><br><span class="line">{$me.sex|default='man'} &lt;br /&gt;</span><br><span class="line"></span><br><span class="line">{// $me.age+1 这种是输出不了的} &lt;br /&gt;</span><br><span class="line">{$me['age']+1} &lt;br /&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>注释是前面加两个斜杠。（也可以在中间加，但是可能会出错）</p>
<p><code>$me.sex|default='man'</code> 如果 sex 没有定义，那么就能输出默认值。</p>
<hr>
<p>算术运算可以使用<code>+</code>、<code>-</code>、<code>*</code>、<code>/</code>、<code>++</code>、<code>–-</code>，此时必须使用<code>$me['age']</code>这种方式。</p>
<h3 id="调用函数和系统参数"><a href="#调用函数和系统参数" class="headerlink" title="调用函数和系统参数"></a>调用函数和系统参数</h3><p>控制  <code>\Home\Controller\IndexController.class.php</code>：</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Home</span>\<span class="title">Controller</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Think</span>\<span class="title">Controller</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexController</span> <span class="keyword">extends</span> <span class="title">Controller</span> </span>{</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">()</span></span>{</span><br><span class="line">    	$me[<span class="string">'name'</span>] = <span class="string">'WXY'</span>;</span><br><span class="line">        $me[<span class="string">'age'</span>] = <span class="string">'20'</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;now = time();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;assign(<span class="string">'me'</span>, $me);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;display();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>模板  <code>\[应用名]\Home\View\Index\index.html</code>：</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MD5加密：{$me['name']|md5}</span><br><span class="line">加密后并截取前五位：{$me['name']|md5|substr=0,5}</span><br><span class="line">输出时间：{$now}</span><br><span class="line">指定格式的时间：{$now|date='Y-m-d H:i:s',###} 三个#表示传时间戳(即$now)的值</span><br></pre></td></tr></tbody></table></figure>

<p>函数等同于在控制文件中执行：</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> substr(md5($me[<span class="string">'name'</span>]), <span class="number">0</span>, <span class="number">5</span>);</span><br></pre></td></tr></tbody></table></figure>

<hr>
<p>系统变量：</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">系统时间：{$Think.now} 输出格式化后的时间</span><br><span class="line">系统版本：{$Think.version}</span><br><span class="line">系统版本：{$Think.server.http_host} 输出 localhost</span><br></pre></td></tr></tbody></table></figure>

<h3 id="volist和foreach循环"><a href="#volist和foreach循环" class="headerlink" title="volist和foreach循环"></a>volist和foreach循环</h3><p>控制  <code>\[应用名]\Home\Controller\IndexController.class.php</code>：</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 套在外面的class等已略写</span></span><br><span class="line">$person = <span class="keyword">array</span>(</span><br><span class="line">    <span class="number">1</span> =&gt; <span class="keyword">array</span>(<span class="string">'name'</span>=&gt;<span class="string">'Jack'</span>,<span class="string">'age'</span>=&gt;<span class="string">'18'</span>),</span><br><span class="line">    <span class="number">2</span> =&gt; <span class="keyword">array</span>(<span class="string">'name'</span>=&gt;<span class="string">'Tom'</span>,<span class="string">'age'</span>=&gt;<span class="string">'19'</span>),</span><br><span class="line">    <span class="number">3</span> =&gt; <span class="keyword">array</span>(<span class="string">'name'</span>=&gt;<span class="string">'Peter'</span>,<span class="string">'age'</span>=&gt;<span class="string">'20'</span>),</span><br><span class="line">    <span class="number">4</span> =&gt; <span class="keyword">array</span>(<span class="string">'name'</span>=&gt;<span class="string">'Mary'</span>,<span class="string">'age'</span>=&gt;<span class="string">'21'</span>),</span><br><span class="line">);</span><br><span class="line"><span class="keyword">$this</span>-&gt;assign(<span class="string">'person'</span>, $person);</span><br><span class="line"><span class="keyword">$this</span>-&gt;display();</span><br></pre></td></tr></tbody></table></figure>

<p>模板文件  <code>\[应用名]\Home\View\Index\index.html</code>：</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">name='原变量名' id='循环中的变量名'</span><br><span class="line">&lt;volist name='person' id='data'&gt;</span><br><span class="line">	{$data['name']}-----{$data['age']} &lt;br/&gt;</span><br><span class="line">&lt;/volist&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>截取一部分：</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">从第二个到第三个</span><br><span class="line">&lt;volist name='person' id='data' offset='1' length='2'&gt;</span><br><span class="line">&lt;/volist&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>如果没有数据：</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">变量不存在时，输出empty中的内容</span><br><span class="line">&lt;volist name='person' id='data' empty='我没数据'&gt;</span><br><span class="line">&lt;/volist&gt;</span><br></pre></td></tr></tbody></table></figure>

<hr>
<p>模板文件  <code>\[应用名]\Home\View\Index\index.html</code>：</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">name='原变量名' item='循环中的变量名'</span><br><span class="line">&lt;foreach name='person' item='data'&gt;</span><br><span class="line">	{$data['name']}-----{$data['age']} &lt;br/&gt;</span><br><span class="line">&lt;/volist&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>foreach 循环没有截取功能</p>
<h3 id="for循环"><a href="#for循环" class="headerlink" title="for循环"></a>for循环</h3><ul>
<li>eq =    neq !=</li>
<li>gt &gt;    egt &gt;=</li>
<li>lt &lt;    elt &lt;=</li>
<li>heq ===    nheq !===</li>
</ul>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;for start='1' end='10' comparison='elt' name='k'&gt;</span><br><span class="line">	{$k}</span><br><span class="line">&lt;/for&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>等同于：</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; <span class="number">10</span>; $i++){</span><br><span class="line">    <span class="keyword">echo</span> $i;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="if-判断"><a href="#if-判断" class="headerlink" title="if 判断"></a>if 判断</h3><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;if condition='$num gt 10'&gt; num 大于 10</span><br><span class="line">&lt;elseif condition='$num lt 10' /&gt; num 小于 10</span><br><span class="line">&lt;else /&gt; num 等于 10</span><br><span class="line">&lt;/if&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>别忘了 <code>&lt;elseif /&gt;</code> 和 <code>&lt;else /&gt;</code> 后面结束的<code>/</code>符号，如果没有则会继续运行到下一句（类似于break没写）。</p>
<h3 id="switch-判断"><a href="#switch-判断" class="headerlink" title="switch 判断"></a>switch 判断</h3><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;switch name='peopleName'&gt;</span><br><span class="line">	&lt;case value='laoshi'&gt;老师&lt;/case&gt;</span><br><span class="line">    &lt;case value='xiaoming|xiaohong'&gt;学生&lt;/case&gt;</span><br><span class="line">    &lt;default /&gt;谁都不是</span><br><span class="line">&lt;/switch&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>同样别忘了 <code>&lt;default /&gt;</code> 后面结束的<code>/</code>符号</p>
<h3 id="比较标签"><a href="#比较标签" class="headerlink" title="比较标签"></a>比较标签</h3><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;比较标签 name='变量名' value='比较的值' &gt; &lt;/比较标签&gt;</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;eq name='num' value='10'&gt; num = 10 </span><br><span class="line">&lt;else /&gt; num != 10</span><br><span class="line">&lt;/eq&gt;</span><br><span class="line"></span><br><span class="line">&lt;neq name='num' value='12'&gt; num != 12 &lt;/neq&gt;</span><br><span class="line"></span><br><span class="line">&lt;compare name='num' value='12' type='eq'&gt; num = 12</span><br><span class="line">&lt;else /&gt; num != 12</span><br><span class="line">&lt;/compare&gt;</span><br></pre></td></tr></tbody></table></figure>

<h3 id="区间标签"><a href="#区间标签" class="headerlink" title="区间标签"></a>区间标签</h3><ul>
<li>in 在区间里</li>
<li>notin 不在区间里</li>
<li>between 连续区间</li>
<li>notbetween 不在连续区间</li>
<li>range 只能替换 in 和 notin，不能替换 between</li>
</ul>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;in name='num' value='1,2,3'&gt; 在这个区间</span><br><span class="line">&lt;else /&gt; 不在这个区间</span><br><span class="line">&lt;/in&gt;</span><br><span class="line"></span><br><span class="line">&lt;notin name='num' value='1,2,3'&gt; 不在这个区间 &lt;/notin&gt;</span><br><span class="line"></span><br><span class="line">&lt;between name='num' value='1,10'&gt; 在这个区间</span><br><span class="line">&lt;/between&gt;</span><br><span class="line"></span><br><span class="line">&lt;notbetween name='num' value='1,10'&gt; 不在这个区间</span><br><span class="line">&lt;else /&gt; 居然在这个区间</span><br><span class="line">&lt;/notbetween&gt;</span><br><span class="line"></span><br><span class="line">&lt;range name='num' value='1,11,12' type='in'&gt; 有11这个数</span><br><span class="line">&lt;else /&gt; 没有11这个数</span><br><span class="line">&lt;/range&gt;</span><br></pre></td></tr></tbody></table></figure>

<h3 id="三元运算符"><a href="#三元运算符" class="headerlink" title="三元运算符"></a>三元运算符</h3><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">{$num &gt; <span class="number">10</span> ? <span class="string">'大于10'</span> : <span class="string">'不大于10'</span>}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="案例实战"><a href="#案例实战" class="headerlink" title="案例实战"></a>案例实战</h3><p>判断人物有没有成年</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;foreach name='person' item='data'&gt;</span><br><span class="line">	&lt;egt name='data.age' value='18'&gt;{$data.name}已经成年了</span><br><span class="line">	&lt;else/&gt;{$data.name}还是个孩子</span><br><span class="line">	&lt;/egt&gt; &lt;br/&gt;</span><br><span class="line">&lt;/foreach&gt;</span><br></pre></td></tr></tbody></table></figure>

<h3 id="原生态PHP标签"><a href="#原生态PHP标签" class="headerlink" title="原生态PHP标签"></a>原生态PHP标签</h3><p>官方推荐使用<code>&lt;php&gt;</code>而非<code>&lt;?php</code>，因为后者可能会被屏蔽掉。</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;php&gt;</span><br><span class="line">    echo "Hello!";</span><br><span class="line">&lt;/php&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></tbody></table></figure>

<h2 id="ThinkPHP调试方法"><a href="#ThinkPHP调试方法" class="headerlink" title="ThinkPHP调试方法"></a>ThinkPHP调试方法</h2><p>开启调试模式 <code>define('APP_DEBUG', true);</code></p>
<p>创建文件 <code>\[应用名]\Conf\debug.php</code> ：</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">array</span>(</span><br><span class="line">		<span class="string">'name'</span>=&gt;<span class="string">'WXY_Debug'</span>,</span><br><span class="line">    	<span class="string">'SHOW_PAGE_TRACE'</span>=&gt;<span class="keyword">true</span>, <span class="comment">// 显示页面 trace 信息</span></span><br><span class="line">	);</span><br></pre></td></tr></tbody></table></figure>

<p>控制  <code>\Home\Controller\IndexController.class.php</code>：</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Home</span>\<span class="title">Controller</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Think</span>\<span class="title">Controller</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexController</span> <span class="keyword">extends</span> <span class="title">Controller</span> </span>{</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">()</span></span>{</span><br><span class="line">    	</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">user</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">echo</span> C(<span class="string">'name'</span>);    <span class="comment">// 方法一：输出调试配置中的变量</span></span><br><span class="line">        trace(<span class="string">'name'</span>, C(<span class="string">'name'</span>)); <span class="comment">// 方法三：trace中的调试 监视变量</span></span><br><span class="line">        dump($_SERVER); <span class="comment">// 方法四：输出变量信息</span></span><br><span class="line">        { <span class="comment">// 方法五：输出运行时间（毫秒）</span></span><br><span class="line">            G(<span class="string">'run'</span>);</span><br><span class="line">            <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; <span class="number">100000</span>; $i++) {</span><br><span class="line">                $count += $i;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">echo</span> G(<span class="string">'run'</span>,<span class="string">'end'</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">$this</span>-&gt;displace(); <span class="comment">// 方法二：开启trace后右下角会出现信息框</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>访问路径：<code>ThinkPHP路径/index.php/Index/user</code></p>
<p>输出：<code>WXY_Debug</code></p>
<p>把<code>define('APP_DEBUG', true);</code>取消后，就不会输出了</p>
<p>同名变量会覆盖普通配置的变量</p>
<h1 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h1><h2 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h2><p>配置文件：<code>\[应用名]\Common\Conf\config.php</code></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">return array(</span><br><span class="line">	/* ...... */</span><br><span class="line">	'DB_TYPE'   =&gt; 'mysql',     // 数据类型</span><br><span class="line">	'DB_HOST'   =&gt; 'localhost', // 数据服务地址</span><br><span class="line">	'DB_NAME'   =&gt; 'test',      // 数据库名</span><br><span class="line">	'DB_USER'   =&gt; 'root',      // 数据库用户名</span><br><span class="line">	'DB_PWD'    =&gt; 'root',      // 数据库用户密码</span><br><span class="line">	'DB_PORT'   =&gt; '3306',      // 数据库端口</span><br><span class="line">	'DB_PREFIX' =&gt; 't_',        // 数据库表前缀</span><br><span class="line">	</span><br><span class="line">	// 开启主从读写分离</span><br><span class="line">	'DB_RW_SEPARATE' =&gt; true,</span><br><span class="line">	// 多个主数据库服务器</span><br><span class="line">	'DB_MASTER_NUM'  =&gt; 2,</span><br><span class="line">);</span><br></pre></td></tr></tbody></table></figure>

<h2 id="实例化模型"><a href="#实例化模型" class="headerlink" title="实例化模型"></a>实例化模型</h2><h3 id="1、实例化基础模型"><a href="#1、实例化基础模型" class="headerlink" title="1、实例化基础模型"></a>1、实例化基础模型</h3><p>控制文件：<code>[应用名]/Home/Controller/IndexController.class.php</code></p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Home</span>\<span class="title">Controller</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Think</span>\<span class="title">Controller</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexController</span> <span class="keyword">extends</span> <span class="title">Controller</span> </span>{</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="comment">// $user = new Model('notes'); // 这句不知道为什么会导致崩溃，只能用下面的M方法</span></span><br><span class="line">    	$user = M(<span class="string">'notes'</span>);</span><br><span class="line">        $data = $user-&gt;select();</span><br><span class="line">        dump($data); <span class="comment">// 输出所有的信息（数组+映射格式）</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="2、实例化用户自定义模型"><a href="#2、实例化用户自定义模型" class="headerlink" title="2、实例化用户自定义模型"></a>2、实例化用户自定义模型</h3><p><strong>新建 Model 文件</strong>：<code>[应用名]/Home/Model/[名字]Model.class.php</code><br>格式要规范，例如：UserModel.class.php</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Home</span>\<span class="title">Model</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Think</span>\<span class="title">Model</span>; <span class="comment">// 加上这两行，D('Model/User') 可以省略 'Model/'，否则必须全路径</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserModel</span> <span class="keyword">extends</span> <span class="title">Model</span> </span>{</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span><span class="params">()</span> </span>{</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"Hello World"</span>;</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>Think/Model 方法不存在 解决方法：</p>
<p>需要继承<code>RelationModel</code>，引入<code>use Think\Model\RelationModel ;</code></p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">use</span> <span class="title">Think</span>\<span class="title">Model</span>\<span class="title">RelationModel</span> ;</span><br><span class="line">&gt; <span class="class"><span class="keyword">class</span> <span class="title">UserModel</span> <span class="keyword">extends</span> <span class="title">RelationModel</span> </span>{ <span class="comment">/*...*/</span> }</span><br><span class="line">&gt; </span><br><span class="line">&gt;</span><br></pre></td></tr></tbody></table></figure>
</blockquote>
<p><strong>Controller 文件</strong>：</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// $user = new UserModel(); // 要放到 Home\Controller 下才能用</span></span><br><span class="line">$user = D(<span class="string">'User'</span>);</span><br><span class="line">$data = $user-&gt;select(); <span class="comment">// 需要表存在</span></span><br><span class="line">dump($data);</span><br></pre></td></tr></tbody></table></figure>

<p>如果 Model 文件不存在，<code>D()</code>方法会自动执行<code>M()</code>方法，即构建<code>基础Model</code></p>
<h3 id="3、实例化公共模型"><a href="#3、实例化公共模型" class="headerlink" title="3、实例化公共模型"></a>3、实例化公共模型</h3><p>能进行一些通用的方法</p>
<p><strong>新建 Model 文件</strong>：<code>[应用名]/Home/Model/CommonModel.class.php</code></p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Home</span>\<span class="title">Model</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Think</span>\<span class="title">Model</span>\<span class="title">RelationModel</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CommonModel</span> <span class="keyword">extends</span> <span class="title">RelationModel</span> </span>{</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">strMake</span><span class="params">($str)</span> </span>{</span><br><span class="line">		<span class="keyword">return</span> md5(sha1(md5($str))); <span class="comment">// 统一的字符串加密</span></span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>Controller 文件</strong>：</p>
<blockquote>
<p>如果提示找不到 CommonModel，顶部加上声明：<code>use Home\Model\CommonModel;</code></p>
</blockquote>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">()</span></span>{</span><br><span class="line">    $user = <span class="keyword">new</span> CommonModel();</span><br><span class="line">    <span class="keyword">echo</span> $user-&gt;strMake(<span class="string">'aaa'</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="用户自定义公共模型"><a href="#用户自定义公共模型" class="headerlink" title="用户自定义公共模型"></a>用户自定义公共模型</h4><p>自定义的<code>XxxModel</code>不要继承<code>Model</code>，继承<code>CommonModel</code>，<code>CommonModel</code>再继承自<code>RelationModel</code></p>
<h3 id="4、实例化空模型"><a href="#4、实例化空模型" class="headerlink" title="4、实例化空模型"></a>4、实例化空模型</h3><p>Controller 文件：</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$model = M();</span><br><span class="line">$model-&gt;query($sql); <span class="comment">// 日常读取 select</span></span><br><span class="line">$model-&gt;execute($sql); <span class="comment">// 写入 update insert，返回修改行数（int）</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="CURD操作"><a href="#CURD操作" class="headerlink" title="CURD操作"></a>CURD操作</h2><h3 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h3><p><strong>controller 文件</strong>：</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$data = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">'username'</span> =&gt; <span class="string">''</span>,</span><br><span class="line">    <span class="string">'password'</span> =&gt; <span class="string">''</span>,</span><br><span class="line">);</span><br><span class="line"><span class="keyword">echo</span> M(<span class="string">'User'</span>)-&gt;add($data); <span class="comment">// 返回所在行值</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="插入多条数据"><a href="#插入多条数据" class="headerlink" title="插入多条数据"></a>插入多条数据</h4><p>addAll() 方法 （只适合MySQL）</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$data = <span class="keyword">array</span>(</span><br><span class="line">    <span class="number">0</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">        <span class="string">'username'</span> =&gt; <span class="string">'000'</span>,</span><br><span class="line">        <span class="string">'password'</span> =&gt; <span class="string">'00'</span>,</span><br><span class="line">    ),</span><br><span class="line">    <span class="number">1</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">        <span class="string">'username'</span> =&gt; <span class="string">'111'</span>,</span><br><span class="line">        <span class="string">'password'</span> =&gt; <span class="string">'11'</span>,</span><br><span class="line">    ),</span><br><span class="line">    <span class="number">2</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">        <span class="string">'username'</span> =&gt; <span class="string">'222'</span>,</span><br><span class="line">        <span class="string">'password'</span> =&gt; <span class="string">'22'</span>,</span><br><span class="line">    ),</span><br><span class="line">);</span><br><span class="line"><span class="keyword">echo</span> M(<span class="string">'User'</span>)-&gt;addAll($data); <span class="comment">// 返回第一次添加的行数（int）</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h3><p>M(‘User’)-&gt;select() 会查询两次：</p>
<ul>
<li>Show columns from `user`</li>
<li>SELECT * from `user`</li>
</ul>
<p>如果 <code>debug</code> 开启，那么每次 <code>SELECT</code> 前都会查询字段，并缓存起来。</p>
<p><strong>1、带条件查询</strong>：</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$data = M(<span class="string">'User'</span>)-&gt;where(<span class="string">'id=1'</span>)-&gt;select();</span><br></pre></td></tr></tbody></table></figure>

<p><strong>2、多个条件查询</strong>：</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$where[<span class="string">'id'</span>] = <span class="number">1</span>;</span><br><span class="line">$where[<span class="string">'name'</span>] = <span class="string">'a'</span>;</span><br><span class="line">$where[<span class="string">'_logic'</span>] = <span class="string">'or'</span>; <span class="comment">// 默认where逻辑是 AND</span></span><br><span class="line">$data = M(<span class="string">'User'</span>)-&gt;where($where)-&gt;select();</span><br></pre></td></tr></tbody></table></figure>

<p><strong>3、表达式查询</strong>：</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$where[<span class="string">'id'</span>] = <span class="keyword">array</span>(<span class="string">'gt'</span>, <span class="number">1</span>); <span class="comment">// id &gt; 1</span></span><br><span class="line">$data = M(<span class="string">'User'</span>)-&gt;where($where)-&gt;select();</span><br><span class="line"></span><br><span class="line">$where[<span class="string">'id'</span>] = <span class="keyword">array</span>(<span class="string">'not between'</span>, <span class="string">'1,8'</span>); <span class="comment">// id &lt; 1 || id &gt; 8</span></span><br><span class="line"></span><br><span class="line">$where[<span class="string">'username'</span>] = <span class="keyword">array</span>(<span class="string">'like'</span>, <span class="string">'%a'</span>); <span class="comment">// name 以 a 结尾</span></span><br><span class="line"></span><br><span class="line">$where[<span class="string">'username'</span>] = <span class="keyword">array</span>(<span class="string">'like'</span>, <span class="keyword">array</span>(<span class="string">'%e'</span>, <span class="string">'s%'</span>)); <span class="comment">// e结尾 OR s开头</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>4、区间查询</strong></p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$where[<span class="string">'id'</span>] = <span class="keyword">array</span>(<span class="keyword">array</span>(<span class="string">'gt'</span>,<span class="number">1</span>), <span class="keyword">array</span>(<span class="string">'lt'</span>,<span class="number">10</span>)); <span class="comment">// 1&lt;id&lt;10，默认 AND 运算</span></span><br><span class="line">$where[<span class="string">'id'</span>] = <span class="keyword">array</span>(<span class="keyword">array</span>(<span class="string">'lt'</span>,<span class="number">3</span>), <span class="keyword">array</span>(<span class="string">'gt'</span>,<span class="number">100</span>), <span class="string">'or'</span>); <span class="comment">// id&lt;3 OR id&gt;100</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>5、混合用法</strong></p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$where[<span class="string">'id'</span>] = <span class="keyword">array</span>(<span class="string">'gt'</span>, <span class="number">10</span>);</span><br><span class="line">$where[<span class="string">'_string'</span>] = <span class="string">'score &gt; 10'</span>; <span class="comment">// 字符串方式（不建议用，容易被SQL注入）</span></span><br><span class="line">$data = M(<span class="string">'User'</span>)-&gt;where($where)-&gt;select();</span><br></pre></td></tr></tbody></table></figure>

<p>尽量不要用字符串方式，表达式查询会进行字符串格式化，安全</p>
<p><strong>6、统计用法</strong></p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$data = M(<span class="string">'User'</span>)-&gt;count();</span><br><span class="line">dump($data); <span class="comment">// 例如 100条结果 会输出： string(3) "100"</span></span><br><span class="line"></span><br><span class="line">$data = M(<span class="string">'User'</span>)-&gt;max(<span class="string">'score'</span>); <span class="comment">// max  min  avg  sum  都需要带一个参数</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="更新数据"><a href="#更新数据" class="headerlink" title="更新数据"></a>更新数据</h3><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$where[<span class="string">'id'</span>] = <span class="number">1</span>;</span><br><span class="line">$data = M(<span class="string">'User'</span>)-&gt;where($where)-&gt;select();</span><br><span class="line">dump($data);</span><br><span class="line"></span><br><span class="line">$update[<span class="string">'score'</span>] = <span class="number">60</span>;</span><br><span class="line">$where[<span class="string">'id'</span>] = <span class="number">1</span>;</span><br><span class="line">$data = M(<span class="string">'User'</span>)-&gt;where($where)-&gt;save($update); <span class="comment">// 千万不要写成 update()方法</span></span><br><span class="line">dump($data); <span class="comment">// 返回影响的行数</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h3><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$where[<span class="string">'id'</span>] = <span class="number">1</span>;</span><br><span class="line"><span class="comment">//$data = M('User')-&gt;where($where)-&gt;select();</span></span><br><span class="line"><span class="keyword">echo</span> M(<span class="string">'User'</span>)-&gt;where($where)-&gt;delete(); <span class="comment">// 输出1</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> M(<span class="string">'User'</span>)-&gt;delete(<span class="number">3</span>); <span class="comment">// 主要传入主键值（也只能传主键值）</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="连贯操作"><a href="#连贯操作" class="headerlink" title="连贯操作"></a>连贯操作</h2><h3 id="排序-order"><a href="#排序-order" class="headerlink" title="排序 order"></a>排序 order</h3><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$data = M(<span class="string">'User'</span>)-&gt;order(<span class="string">'score desc, id asc'</span>)-&gt;select(); <span class="comment">// score从大到小，ID、从小到大</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="筛选数据-field"><a href="#筛选数据-field" class="headerlink" title="筛选数据 field"></a>筛选数据 field</h3><p><code>field($string, false);</code> </p>
<ul>
<li>参数一 string 传入多个字段用英文逗号分开</li>
<li>参数二默认为false，即只显示string中的字段；为true时只有string中的字段不显示</li>
</ul>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$data = M(<span class="string">'User'</span>)-&gt;field(<span class="string">'id, username'</span>)-&gt;select(); <span class="comment">// 只显示 id 和 username</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="限制数据量-limit-和-page"><a href="#限制数据量-limit-和-page" class="headerlink" title="限制数据量 limit 和 page"></a>限制数据量 limit 和 page</h3><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$data = M(<span class="string">'User'</span>)-&gt;limit(<span class="number">5</span>)-&gt;select(); <span class="comment">// 0 ~ 5，序号从0开始</span></span><br><span class="line">$data = M(<span class="string">'User'</span>)-&gt;limit(<span class="number">2</span>, <span class="number">5</span>)-&gt;select(); <span class="comment">// 2（第三条） ~ 5</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$data = M(<span class="string">'User'</span>)-&gt;page(<span class="number">1</span>)-&gt;select(); <span class="comment">// 第一页，参数二默认每页20条</span></span><br><span class="line">$data = M(<span class="string">'User'</span>)-&gt;page(<span class="number">1</span>, <span class="number">5</span>)-&gt;select(); <span class="comment">// 第一页，每页5条</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="分组-group-和-having"><a href="#分组-group-和-having" class="headerlink" title="分组 group 和 having"></a>分组 group 和 having</h3><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">M(<span class="string">'User'</span>)-&gt;field(<span class="string">'score, count(*) as total'</span>)-&gt;group(<span class="string">'score'</span>)-&gt;select(); <span class="comment">// 每个成绩的数据数量</span></span><br></pre></td></tr></tbody></table></figure>

<p>输出结果示例：</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">arrar(<span class="number">10</span>) {</span><br><span class="line">    [<span class="number">0</span>] =&gt; <span class="keyword">array</span>(<span class="number">2</span>) {</span><br><span class="line">        [<span class="string">"score"</span>] =&gt; string(<span class="number">2</span>) <span class="string">"15"</span></span><br><span class="line">        [<span class="string">"total"</span>] =&gt; string(<span class="number">1</span>) <span class="string">"6"</span></span><br><span class="line">    }</span><br><span class="line">    [<span class="number">1</span>] =&gt; <span class="keyword">array</span>(<span class="number">2</span>) {</span><br><span class="line">        [<span class="string">"score"</span>] =&gt; string(<span class="number">2</span>) <span class="string">"16"</span></span><br><span class="line">        [<span class="string">"total"</span>] =&gt; string(<span class="number">1</span>) <span class="string">"3"</span></span><br><span class="line">    }</span><br><span class="line">    [<span class="number">2</span>]...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>having</strong></p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">M(<span class="string">'User'</span>)</span><br><span class="line">    -&gt;field(<span class="string">'score, count(*) as total'</span>)</span><br><span class="line">    -&gt;having(<span class="string">'score &gt;= 20'</span>)</span><br><span class="line">    -&gt;group(<span class="string">'score'</span>)</span><br><span class="line">    -&gt;select(); <span class="comment">// 超过20分的成绩的数据数量</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="多表查询"><a href="#多表查询" class="headerlink" title="多表查询"></a>多表查询</h2><h3 id="table-方法"><a href="#table-方法" class="headerlink" title="table 方法"></a>table 方法</h3><p><code>table(array('完整表名'=&gt;'别名'))</code></p>
<p>如果有前缀，表名一定要加前缀（M方法中的表名参数不用加config中设置的前缀）</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">M()-&gt;table(<span class="keyword">array</span>(<span class="string">'tb_user'</span>=&gt;<span class="string">'user'</span>, <span class="string">'tb_info'</span>=&gt;<span class="string">'info'</span>))</span><br><span class="line">    -&gt;where(<span class="string">'user.id=info.userid'</span>)</span><br><span class="line">    -&gt;select(); <span class="comment">// tb_ 为表前缀</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="join-方法"><a href="#join-方法" class="headerlink" title="join 方法"></a>join 方法</h3><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">M(<span class="string">'User'</span>)</span><br><span class="line">    -&gt;join(<span class="string">'tb_info on tb_info.userid=tb_user.id'</span>)</span><br><span class="line">    -&gt;select(); <span class="comment">// 默认是左关联，即tb_info中有但tb_user中没有这条信息，也会查出来，此时相当于tb_user中的内容为空</span></span><br><span class="line"></span><br><span class="line">M(<span class="string">'User'</span>)</span><br><span class="line">    -&gt;join(<span class="string">'Right join tb_info on tb_info.userid=tb_user.id'</span>)</span><br><span class="line">    -&gt;select(); <span class="comment">// 右关联</span></span><br><span class="line"></span><br><span class="line">M(<span class="string">'User'</span>)</span><br><span class="line">    -&gt;join(<span class="comment">/**/</span>)</span><br><span class="line">    -&gt;join(<span class="comment">/**/</span>)</span><br><span class="line">    -&gt;select(); <span class="comment">// 使用多个join关联</span></span><br><span class="line"></span><br><span class="line">M(<span class="string">'User'</span>)</span><br><span class="line">    -&gt;join(<span class="keyword">array</span>(<span class="string">'tb_info on tb_info.userid=tb_user.id'</span>, <span class="string">'/**/'</span>, <span class="string">'/**/'</span>))</span><br><span class="line">    -&gt;select(); <span class="comment">// 使用join数组关联</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="union-方法"><a href="#union-方法" class="headerlink" title="union 方法"></a>union 方法</h3><p><code>union(string/array, false/true)</code> </p>
<ul>
<li>参数二默认false，使用union查询；true 为uni查询（去掉重复结果）</li>
</ul>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">M(<span class="string">'User'</span>)</span><br><span class="line">    -&gt;field(<span class="string">'username'</span>, <span class="string">'id'</span>)</span><br><span class="line">    -&gt;union(<span class="string">'select username, id from tb_user2'</span>)</span><br><span class="line">    -&gt;select(); <span class="comment">// 查询 tb_user 和 tb_user2 中的 username 和 id</span></span><br><span class="line"></span><br><span class="line">M(<span class="string">'User'</span>)</span><br><span class="line">    -&gt;field(<span class="string">'username'</span>)</span><br><span class="line">    -&gt;union(<span class="keyword">array</span>(<span class="string">'field'</span>=&gt;<span class="string">'username'</span>, <span class="string">'table'</span>=&gt;<span class="string">'tb_user2'</span>))</span><br><span class="line">    -&gt;union(<span class="keyword">array</span>(<span class="string">'field'</span>=&gt;<span class="string">'username'</span>, <span class="string">'table'</span>=&gt;<span class="string">'tb_user3'</span>))</span><br><span class="line">    -&gt;select();</span><br></pre></td></tr></tbody></table></figure>

<p>查询字段的类型（包括field和union中的顺序）必须是一样的</p>
<h3 id="过滤查询-distinct"><a href="#过滤查询-distinct" class="headerlink" title="过滤查询 distinct"></a>过滤查询 distinct</h3><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$data = M(<span class="string">'User'</span>)-&gt;distinct(<span class="keyword">true</span>)-&gt;field(<span class="string">'score'</span>)-&gt;order(<span class="string">'score asc'</span>)-&gt;select(); <span class="comment">// 参数 true 为过滤</span></span><br></pre></td></tr></tbody></table></figure>

<h1 id="关于命名范围的使用"><a href="#关于命名范围的使用" class="headerlink" title="关于命名范围的使用"></a>关于命名范围的使用</h1><p>查询分数超过60的</p>
<p><code>[应用名]/Home/Model/UserModel.class.php</code></p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Home</span>\<span class="title">Model</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Think</span>\<span class="title">Model</span>\<span class="title">RelationModel</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserModel</span> <span class="keyword">extends</span> <span class="title">CommonModel</span> </span>{</span><br><span class="line">	<span class="keyword">protected</span> $_scope = <span class="keyword">array</span>(</span><br><span class="line">		<span class="comment">/*'命名范围的标识名' =&gt; array(</span></span><br><span class="line"><span class="comment">			'属性' =&gt; '值',</span></span><br><span class="line"><span class="comment">			支持的方法有：where limit field order table page having group distinct</span></span><br><span class="line"><span class="comment">		)*/</span></span><br><span class="line">        </span><br><span class="line">		<span class="string">'jige'</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">			<span class="string">'where'</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">				<span class="string">'score'</span>=&gt;<span class="keyword">array</span>(<span class="string">'egt'</span>, <span class="number">60</span>),</span><br><span class="line">			),</span><br><span class="line">			<span class="string">'order'</span> =&gt; <span class="string">'id asc'</span>,</span><br><span class="line">		),</span><br><span class="line">        </span><br><span class="line">		<span class="string">'ziduan'</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">			<span class="string">'field'</span> =&gt; <span class="string">'nickname, score'</span></span><br><span class="line">		)</span><br><span class="line">	);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><code>[应用名]/Home/Controller/IndexController.class.php</code></p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">fanwei</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	$user = D(<span class="string">'User'</span>);</span><br><span class="line">	$data = $user-&gt;scope(<span class="string">'jige'</span>, <span class="string">'ziduan'</span>)-&gt;select();</span><br><span class="line">	<span class="keyword">echo</span> M()-&gt;getLastSql();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>如果两个命名范围冲突（如一个 limit 10，另一个 limit 5，则后面的会覆盖前面的），没冲突（例如 where 条件）则会用 AND 连接</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
        </div>

        <blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    最后更新：<time datetime="2019-10-13T08:43:59.864Z" itemprop="dateUpdated">2019-10-13 16:43:59</time>
</span>


        
        原文链接：<a href="/2018/11/04/ThinkPHP5-学习笔记/" target="_blank" rel="external">http://blog.iwxyi.com/2018/11/04/ThinkPHP5-学习笔记/</a>
        
    </div>
    <footer>
        <div onclick="location.href='http://blog.iwxyi.com'">
            <img src="/img/avatar.jpg" alt="命燃芯乂">
            <a>命燃芯乂</a>
        </div>
    </footer>
</blockquote>

        
    <div class="page-reward">
        <nav class="myreward">
            <a id="rewardBtn" href="javascript:;"><span>打&nbsp;赏</span><span>装成好像很多人打赏的样子</span></a>
        </nav>
    </div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PHP/">PHP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ThinkPHP/">ThinkPHP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/学习笔记/">学习笔记</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://blog.iwxyi.com/2018/11/04/ThinkPHP5-学习笔记/&title=《ThinkPHP5-学习笔记》 — 云笺&pic=http://blog.iwxyi.com/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.iwxyi.com/2018/11/04/ThinkPHP5-学习笔记/&title=《ThinkPHP5-学习笔记》 — 云笺&source=运行单一入口：index.php12345&lt;?phpdefine('APP_DEBUG', true);define('APP_NAME', 'Ap..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.iwxyi.com/2018/11/04/ThinkPHP5-学习笔记/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《ThinkPHP5-学习笔记》 — 云笺&url=http://blog.iwxyi.com/2018/11/04/ThinkPHP5-学习笔记/&via=http://blog.iwxyi.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://blog.iwxyi.com/2018/11/04/ThinkPHP5-学习笔记/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2018/11/04/贪心算法/" id="post-prev" class="post-nav-link">
        <h4 class="title" >
          上一篇：贪心算法-讲解
        </h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2018/11/04/Python解析网络JSON/" id="post-next" class="post-nav-link">
        <h4 class="title" data-hover="下一篇：Python解析网络JSON">下一篇：Python解析网络JSON</h4>
      </a>
    </div>
  
</nav>



    
    

    

    
    <!-- Valine Comments -->
    <div class="comments vcomment" id="comments"></div>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script>
    <!-- Valine Comments script -->
    <script>
        var GUEST_INFO = ['nick','mail','link'];
        var guest_info = 'nick,mail,link'.split(',').filter(function(item){
          return GUEST_INFO.indexOf(item) > -1
        });
        new Valine({
            el: '#comments',
            notify: 'true' == 'true',
            verify: 'false' == 'true',
            appId: "sVjY7bBJXEfCtStMqASgnlL6-gzGzoHsz",
            appKey: "8mL43PwxikVMVpiQx4Pq7wwt",
            avatar: "mm",
            placeholder: "留下您宝贵的建议——",
            guest_info: guest_info.length == 0 ? GUEST_INFO : guest_info,
            pageSize: "10"
        })
    </script>
    <!-- Valine Comments end -->



</article>

</div>

        <footer class="footer">
    <div class="footer-content">
        <span class="power">
            <i class="icon icon-lg icon-copyright"></i>
            2019
            <i class="icon icon-lg icon-heart"></i>
            <a href="http://blog.iwxyi.com">http://blog.iwxyi.com</a>
            <br/>
            Power by
            <a href="https://hexo.io/" target="_blank" rel="external nofollow">Hexo</a>&nbsp;·&nbsp;
            Theme
            <a class="tomotoeslink" href="https://github.com/tomotoes/hexo-theme-tomotoes/" target="_blank" rel="external nofollow">tomotoes</a>
        </span>

        <br/>

        <span id="RunTime" style="color:#a7a7a2;"></span>
        <br/>

        <span>
            
	<i class="icon icon-lg icon-user">
<span id="busuanzi_container_site_uv" style='display:none'>
       访问用户：<span id="busuanzi_value_site_uv"></span>
    </span>人</i>
    ·
    <i class="icon icon-lg icon-eye">
    <span id="busuanzi_container_site_pv" style='display:none'>
      访问次数：<span id="busuanzi_value_site_pv"></span>
    </span>次
    </i>


        </span>
        <br/>

        <span class="license"><a  target="_blank" rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">博客内容遵循 知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
    </div>
</footer>

    </main>
    
        
<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        <span>感谢您的鼓励支持！</span>
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" data-img="/img/dog.png" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.png" data-alipay="/img/alipay.png">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechatPay">&nbsp;&nbsp;微信&nbsp;&nbsp;</span>
                <span class="reward-toggle-item alipayPay">支付宝</span>
            </div>
        </label>
        
        <i class="icon icon-caret-up"></i>
    </div>
</div>


    
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://blog.iwxyi.com/2018/11/04/ThinkPHP5-学习笔记/&title=《ThinkPHP5-学习笔记》 — 云笺&pic=http://blog.iwxyi.com/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.iwxyi.com/2018/11/04/ThinkPHP5-学习笔记/&title=《ThinkPHP5-学习笔记》 — 云笺&source=运行单一入口：index.php12345&lt;?phpdefine('APP_DEBUG', true);define('APP_NAME', 'Ap..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.iwxyi.com/2018/11/04/ThinkPHP5-学习笔记/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《ThinkPHP5-学习笔记》 — 云笺&url=http://blog.iwxyi.com/2018/11/04/ThinkPHP5-学习笔记/&via=http://blog.iwxyi.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://blog.iwxyi.com/2018/11/04/ThinkPHP5-学习笔记/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p class="wechatshare">扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACHklEQVR42u3aS26EMBAFwLn/pScHiIa812YiYZdXCCFwsWi5P69XvN4fVvLk9TPJ/dsWBgbGYxnvy7X+4d/vyfHJ3jAwMM5hzD5//eQn9uz6jz1jYGBgBBvKj3TXoRMDAwPjXsanw1wSptugjIGBgZEksSuhdpYSfyUXx8DAeCAjP8z9//VX+hsYGBiPYrzLlYTFuxqfxa4wMDC2ZrSpZr6httA2S30xMDBOYLRjEOt32n8c/TIMDIxjGO1QxcrhLy/hRW1UDAyMIxlt8zIZm2jDa9EAwMDAOJIxazq2x8H1dBcDA+M0RhL+6g/ERf+l0QoMDIytGdfbykcuov5DGdaLJBYDA2NrxkrAbQP3esGuaGFiYGBsx2jLZG29qw3HOfiVZNgYGBgPZySvTqi3JaLxT8HAwDiHMSuEtQe7WUmuaFRgYGBszZgdxWZFtPzNsyEzDAyMXRkryWcdCsuDY/GzMDAwtmasDITNmgRtua1OiTEwMDZlJCnrLCCuBPH6zRgYGAcwkhJ/e8ibDU8Mc3EMDIyDGSthcb2EV4RmDAyMTRnvcq2U9VfaA8WcCAYGxnaMfOVbbEN2PpwxO3RiYGDswciD7OzDsyZl3SjFwMA4gDFrauZluPaZYSqLgYGBsZCsJsX9POmNOpwYGBgHM2YFu5URtIiEgYFxAKNtBrRFt3aEImmUYmBgnMPIU8dZmeyuYbIbmpoYGBjPY/wA3O8ZBnjop2kAAAAASUVORK5CYII=" alt="微信分享二维码">
</div>




    <!-- waves按钮特效 -->
<script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>

<!-- 主题配置脚本 -->
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };
</script>

<!-- jquery -->
<script src="/js/jquery.min.js?v=3.0"></script>

<!-- 搜索 -->

<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item waves-block waves-effect" onclick="location.href='{path}'">
    <div class="title ellipsis" title="{title}">{title}</div>
</li>
</template>


<!-- main博客脚本 -->
<script src="/js/main.min.js?v=3.0" ></script>

<!-- 动画&配置 -->
<script src="/js/script.min.js?v=3.0" ></script>

<!-- 脚本管理 -->
<script>

if(window.innerWidth > 800){
	/* 3D标题 */
	$(".content-header").on("mousemove", threedee);

	/* 底部追随鼠标 */
	$(".footer").hover(2);

	/* gotop键的涟漪 */
	$("#gotop").hover(1);

	/* 赞赏的粒子雨 */
	$("#reward").hover(3);

	/* 微信公众号的底部渲染 */
	$("#wechat").hover(4);

    /* 标题跳动 */
    $(".archivestitle").bumpyText();

	/* 图片点击放大 */
	const postimg = jQuery(".post-content img:not(.github-emoji)");
	postimg.on("click",function(){

		mask.classList.add("in");
		main.classList.add("Mask");
		menu.classList.add("Mask");
		var myimg = this.cloneNode(true);
		myimg.classList.add("imgShow");

		setTimeout(function(){
			jQuery(myimg).animate({
				opacity:"1"
			},1000);
		},0);

		document.body.appendChild(myimg);

		myimg.onclick=function(){
			document.body.removeChild(myimg);
			mask.classList.remove("in");
			main.classList.remove("Mask");
			menu.classList.remove("Mask");
		};

	});

}

/* 名字跳动 */
$("#name").bumpyText();


/* 网站运行时间 */
setInterval(function () {
	setTime("2019/10/11");
}, 1000);

/* 文章块的淡出 */
postshow();

/* 座右铭 */

   getHitokoto();



/* 粘贴提示 */
G($(".post-content"), location.href, "命燃芯乂");


/* 控制台 */
if (window.console && window.console.log) {
	setTimeout(function () {
		console.log("\n %c 一个坏掉的番茄 %c  © Simon Ma  http://tomotoes.com \n\n", "color:#FFFFFB;background:#1abc9c;padding:5px 0;border-radius:.5rem 0 0 .5rem;", "color:#FFFFFB;background:#080808;padding:5px 0;border-radius:0 .5rem .5rem 0;");
	}, 0);
}

</script>




<!-- 公式渲染 -->



<!-- 不蒜子 -->

<script defer src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>


<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/z16.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":false}});</script></body>
</html>
